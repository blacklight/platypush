"use strict";(self["webpackChunkplatypush"]=self["webpackChunkplatypush"]||[]).push([[8224,6966],{5071:function(e,t,r){r.r(t),r.d(t,{default:function(){return C}});var s=r(641),i=r(33);const a=e=>((0,s.Qi)("data-v-1b764fc6"),e=e(),(0,s.jt)(),e),n={key:1,class:"login-container"},o=a((()=>(0,s.Lk)("div",{class:"header"},[(0,s.Lk)("span",{class:"logo"},[(0,s.Lk)("img",{src:"/logo.svg",alt:"logo"})]),(0,s.Lk)("span",{class:"text"},"Platypush")],-1))),u={class:"row"},d=["type","disabled"],l={class:"row"},c=["type","disabled"],h={key:0,class:"row"},p=["disabled"],g={key:1,class:"row"},k=["disabled"],m={class:"row buttons"},f=["disabled"],b=a((()=>(0,s.Lk)("div",{class:"row pull-right"},[(0,s.Lk)("label",{class:"checkbox"},[(0,s.Lk)("input",{type:"checkbox",name:"remember"}),(0,s.eW)("  Keep me logged in on this device   ")])],-1))),y={key:2,class:"auth-error"};function v(e,t,r,a,v,w){const L=(0,s.g2)("Loading");return v.initialized?((0,s.uX)(),(0,s.CE)("div",n,[v.isAuthenticated?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("form",{key:0,class:"login",method:"POST",onSubmit:t[0]||(t[0]=(...e)=>w.submitForm&&w.submitForm(...e))},[o,(0,s.Lk)("div",u,[(0,s.Lk)("label",null,[(0,s.Lk)("input",{type:v.requires2fa?"hidden":"text",name:"username",disabled:v.authenticating,placeholder:"Username",ref:"username"},null,8,d)])]),(0,s.Lk)("div",l,[(0,s.Lk)("label",null,[(0,s.Lk)("input",{type:v.requires2fa?"hidden":"password",name:"password",disabled:v.authenticating,placeholder:"Password"},null,8,c)])]),v.requires2fa?((0,s.uX)(),(0,s.CE)("div",h,[(0,s.Lk)("label",null,[(0,s.Lk)("input",{type:"text",name:"code",disabled:v.authenticating,placeholder:"2FA code",ref:"code"},null,8,p)])])):(0,s.Q3)("",!0),r.register?((0,s.uX)(),(0,s.CE)("div",g,[(0,s.Lk)("label",null,[(0,s.Lk)("input",{type:"password",name:"confirm_password",disabled:v.authenticating,placeholder:"Confirm password"},null,8,k)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",m,[(0,s.Lk)("button",{type:"submit",class:(0,i.C4)(["btn btn-primary",{loading:v.authenticating}]),disabled:v.authenticating},[v.authenticating?((0,s.uX)(),(0,s.Wv)(L,{key:0})):(0,s.Q3)("",!0),(0,s.eW)(" "+(0,i.v_)(r.register?"Register":"Login"),1)],10,f)]),b,v.authError?((0,s.uX)(),(0,s.CE)("div",y,(0,i.v_)(v.authError),1)):(0,s.Q3)("",!0)],32))])):((0,s.uX)(),(0,s.Wv)(L,{key:0}))}var w=r(9828),L=r(2002),E=r(4335),A={name:"Login",mixins:[L.A],components:{Loading:w.A},props:{register:{type:Boolean,required:!1,default:!1}},computed:{redirect(){return this.$route.query.redirect?.length?this.$route.query.redirect:"/"}},data(){return{authError:null,authenticating:!1,isAuthenticated:!1,initialized:!1,requires2fa:!1}},methods:{async submitForm(e){e.preventDefault();const t=e.target,r=new FormData(t),s="/auth?type="+(this.register?"register":"login");if(this.register&&r.get("password")!==r.get("confirm_password"))this.authError="Passwords don't match";else{this.authError=null;try{const e=await E.A.post(s,r),t=e?.data?.session_token;if(t){const r=e.expires_at?Date.parse(e.expires_at):null;this.isAuthenticated=!0,this.setCookie("session_token",t,{expires:r}),window.location.href=e.redirect||this.redirect}else this.authError="Invalid credentials"}catch(e){"MISSING_OTP_CODE"===e.response?.data?.error?(this.requires2fa=!0,this.$nextTick((()=>{this.$refs.code?.focus()}))):(this.authError=e.response.data.message||e.response.data.error,401===e.response?.status?this.authError=this.authError||"Invalid credentials":(this.authError=this.authError||"An error occurred while processing the request",e.response?console.error(e.response.status,e.response.data):console.error(e)))}}},async checkAuth(){try{const e=await E.A.get("/auth");e.data.session_token&&(this.isAuthenticated=!0,window.location.href=e.redirect||this.redirect)}catch(e){this.isAuthenticated=!1}finally{this.initialized=!0}}},async created(){await this.checkAuth()},async mounted(){this.$nextTick((()=>{this.$refs.username?.focus()}))}},_=r(6262);const x=(0,_.A)(A,[["render",v],["__scopeId","data-v-1b764fc6"]]);var C=x},3036:function(e,t,r){r.r(t),r.d(t,{default:function(){return d}});var s=r(641);function i(e,t,r,i,a,n){const o=(0,s.g2)("Login");return(0,s.uX)(),(0,s.Wv)(o,{register:!0})}var a=r(5071),n={name:"Register",mixins:[a["default"]],components:{Login:a["default"]},props:{register:{type:Boolean,required:!1,default:!0}}},o=r(6262);const u=(0,o.A)(n,[["render",i]]);var d=u}}]);
//# sourceMappingURL=register.37a90704.js.map