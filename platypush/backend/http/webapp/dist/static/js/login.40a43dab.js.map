{"version":3,"file":"static/js/login.40a43dab.js","mappings":"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","sources":["webpack://platypush/./src/views/Login.vue","webpack://platypush/./src/views/Login.vue?240b"],"sourcesContent":["<template>\n  <Loading v-if=\"!initialized\" />\n\n  <div class=\"login-container\" v-else>\n    <form class=\"login\" method=\"POST\" @submit=\"submitForm\" v-if=\"!isAuthenticated\">\n      <div class=\"header\">\n        <span class=\"logo\">\n          <img src=\"/logo.svg\" alt=\"logo\" />\n        </span>\n        <span class=\"text\">Platypush</span>\n      </div>\n\n      <div class=\"row\">\n        <label>\n          <input :type=\"requires2fa ? 'hidden' : 'text'\"\n                 name=\"username\"\n                 :disabled=\"authenticating\"\n                 placeholder=\"Username\"\n                 ref=\"username\">\n        </label>\n      </div>\n\n      <div class=\"row\">\n        <label>\n          <input :type=\"requires2fa ? 'hidden' : 'password'\"\n                 name=\"password\"\n                 :disabled=\"authenticating\"\n                 placeholder=\"Password\">\n        </label>\n      </div>\n\n      <div class=\"row\" v-if=\"requires2fa\">\n        <label>\n          <input type=\"text\"\n                 name=\"code\"\n                 :disabled=\"authenticating\"\n                 placeholder=\"2FA code\"\n                 ref=\"code\">\n        </label>\n      </div>\n\n      <div class=\"row\" v-if=\"register\">\n        <label>\n          <input type=\"password\"\n                 name=\"confirm_password\"\n                 :disabled=\"authenticating\"\n                 placeholder=\"Confirm password\">\n        </label>\n      </div>\n\n      <div class=\"row buttons\">\n        <button type=\"submit\"\n                class=\"btn btn-primary\"\n                :class=\"{loading: authenticating}\"\n                :disabled=\"authenticating\">\n          <Loading v-if=\"authenticating\" />\n          {{ register ? 'Register' : 'Login' }}\n        </button>\n      </div>\n\n      <div class=\"row pull-right\">\n        <label class=\"checkbox\">\n          <input type=\"checkbox\" name=\"remember\">&nbsp;\n          Keep me logged in on this device &nbsp;\n        </label>\n      </div>\n\n      <div class=\"auth-error\" v-if=\"authError\">\n        {{ authError }}\n      </div>\n    </form>\n  </div>\n</template>\n\n<script>\nimport Loading from \"@/components/Loading\";\nimport Utils from \"@/Utils\";\nimport axios from 'axios'\n\nexport default {\n  name: \"Login\",\n  mixins: [Utils],\n  components: {\n    Loading,\n  },\n\n  props: {\n    // Set to true for a registration form, false for a login form\n    register: {\n      type: Boolean,\n      required: false,\n      default: false,\n    },\n  },\n\n  computed: {\n    redirect() {\n      return this.$route.query.redirect?.length ? this.$route.query.redirect : '/'\n    },\n  },\n\n  data() {\n    return {\n      authError: null,\n      authenticating: false,\n      isAuthenticated: false,\n      initialized: false,\n      requires2fa: false,\n    }\n  },\n\n  methods: {\n    async submitForm(e) {\n      e.preventDefault();\n      const form = e.target\n      const data = new FormData(form)\n      const url = `/auth?type=${this.register ? 'register' : 'login'}`\n\n      if (this.register && data.get('password') !== data.get('confirm_password')) {\n        this.authError = \"Passwords don't match\"\n        return\n      }\n\n      this.authError = null\n\n      try {\n        const authStatus = await axios.post(url, data)\n        const sessionToken = authStatus?.data?.session_token\n        if (sessionToken) {\n          const expiresAt = authStatus?.data?.expires_at ? new Date(authStatus.data.expires_at) : null\n          this.isAuthenticated = true\n          this.setCookie('session_token', sessionToken, {\n            expires: expiresAt,\n          })\n          window.location.href = authStatus.redirect || this.redirect\n        } else {\n          this.authError = \"Invalid credentials\"\n        }\n      } catch (e) {\n        if (e?.response?.data?.error === 'MISSING_OTP_CODE') {\n          this.requires2fa = true\n          this.$nextTick(() => {\n            this.$refs.code?.focus()\n          })\n        } else {\n          this.authError = e?.response?.data?.message || e?.response?.data?.error || e?.message || e?.toString()\n          if (e?.response?.status === 401) {\n            this.authError = this.authError || \"Invalid credentials\"\n          } else {\n            this.authError = this.authError || \"An error occurred while processing the request\"\n            if (e?.response)\n              console.error(e.response.status, e.response.data)\n            else\n              console.error(e)\n          }\n        }\n      }\n    },\n\n    async checkAuth() {\n      try {\n        const authStatus = await axios.get('/auth')\n        if (authStatus.data.session_token) {\n          this.isAuthenticated = true\n          window.location.href = authStatus.redirect || this.redirect\n        }\n      } catch (e) {\n        this.isAuthenticated = false\n      } finally {\n        this.initialized = true\n      }\n    },\n  },\n\n  async created() {\n    await this.checkAuth()\n  },\n\n  async mounted() {\n    this.$nextTick(() => {\n      this.$refs.username?.focus()\n    })\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\nbody {\n  width: 100vw;\n  height: 100vh;\n  margin: 0;\n}\n\n.login-container {\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: $default-bg-6;\n}\n\n.header {\n  font-size: 1.2em;\n  margin-bottom: 2em;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n\n  .logo {\n    width: 3em;\n    height: 3em;\n    display: inline-flex;\n    background-size: cover;\n  }\n\n  .text {\n    font-family: Poppins, sans-serif;\n    margin-left: .5em;\n  }\n}\n\nform {\n  display: flex;\n  flex-direction: column;\n  padding: 4em;\n  border: $default-border-3;\n  border-radius: 3em;\n  box-shadow: 2px 2px 3px 3px $border-color-2;\n  background: $background-color;\n\n  .row {\n    margin: 0.5em 0;\n  }\n\n  input[type=text],\n  input[type=password] {\n    width: 100%;\n  }\n\n  [type=submit],\n  input[type=password] {\n    border-radius: 1em;\n  }\n\n  input[type=password] {\n    padding: .25em .5em;\n  }\n\n  .checkbox {\n    display: flex;\n    font-size: 0.8em;\n  }\n\n  .buttons {\n    text-align: center;\n\n    [type=submit] {\n      position: relative;\n      width: 6em;\n      height: 2.5em;\n      padding: .5em .75em;\n      display: inline-flex;\n      align-items: center;\n      justify-content: center;\n\n      &.loading {\n        background: none;\n        border: none;\n        cursor: not-allowed;\n      }\n    }\n  }\n\n  .auth-error {\n    background: $error-bg;\n    display: flex;\n    margin: 1em 0 -2em 0;\n    padding: .5em;\n    align-items: center;\n    justify-content: center;\n    border: $notification-error-border;\n    border-radius: 1em;\n  }\n}\n\na {\n  color: $default-link-fg;\n}\n</style>\n","import { render } from \"./Login.vue?vue&type=template&id=60300e68&scoped=true\"\nimport script from \"./Login.vue?vue&type=script&lang=js\"\nexport * from \"./Login.vue?vue&type=script&lang=js\"\n\nimport \"./Login.vue?vue&type=style&index=0&id=60300e68&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-60300e68\"]])\n\nexport default __exports__"],"names":["class","$data","initialized","_createElementBlock","_hoisted_1","isAuthenticated","method","onSubmit","_cache","args","$options","submitForm","_createElementVNode","src","alt","_hoisted_2","type","requires2fa","name","disabled","authenticating","placeholder","ref","_hoisted_4","_hoisted_6","$props","register","_hoisted_8","_hoisted_10","_normalizeClass","loading","_createBlock","_component_Loading","key","_toDisplayString","authError","_hoisted_12","mixins","Utils","components","Loading","props","Boolean","required","default","computed","redirect","this","$route","query","length","data","methods","e","preventDefault","form","target","FormData","url","get","authStatus","axios","post","sessionToken","session_token","expiresAt","expires_at","Date","setCookie","expires","window","location","href","response","error","$nextTick","$refs","code","focus","message","toString","status","console","checkAuth","created","mounted","username","__exports__","render"],"sourceRoot":""}