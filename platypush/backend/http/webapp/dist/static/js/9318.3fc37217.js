"use strict";(self["webpackChunkplatypush"]=self["webpackChunkplatypush"]||[]).push([[9318],{9318:function(t,e,i){i.r(e),i.d(e,{default:function(){return m}});var s=i(641);function n(t,e,i,n,o,r){const a=(0,s.g2)("Loading"),g=(0,s.g2)("LightPlugin");return(0,s.uX)(),(0,s.CE)(s.FK,null,[o.loading?((0,s.uX)(),(0,s.Wv)(a,{key:0})):(0,s.Q3)("",!0),(0,s.bF)(g,{"plugin-name":"light.hue",config:i.config,lights:t.lights,groups:t.groups,scenes:t.scenes,animations:t.animations,"initial-group":r.initialGroup,"loading-groups":t.loadingGroups,"color-converter":o.colorConverter,onGroupToggle:r.toggleGroup,onLightChanged:r.onLightChanged,onLightToggle:r.toggleLight,onSetLight:r.setLight,onSetGroup:r.setGroup,onSelectScene:r.setScene,onStartAnimation:r.startAnimation,onStopAnimation:r.stopAnimation,onRefresh:e[0]||(e[0]=t=>r.refresh(!0))},null,8,["config","lights","groups","scenes","animations","initial-group","loading-groups","color-converter","onGroupToggle","onLightChanged","onLightToggle","onSetLight","onSetGroup","onSelectScene","onStartAnimation","onStopAnimation"])],64)}var o=i(6298),r={name:"Utils",data(){return{lights:{},groups:{},scenes:{},animations:{},loadingLights:{},loadingGroups:{}}},computed:{groupsByName(){return this.groups?Object.entries(this.groups).reduce(((t,[e,i])=>(t[i.name||e]={...i,id:e},t)),{}):{}}},methods:{_getGroups(t){const e=t.filter((t=>null!=t));if(!e.length)return Object.values(this.groups);const i=this;return e.map((t=>t instanceof Object?t:i.groups[t]))},_getLights(t){const e=t.filter((t=>null!=t));if(!e.length)return Object.values(this.lights);const i=this;return e.map((t=>t instanceof Object?t:i.lights[t]))},setGroupsLoading(t){const e=this;this._getGroups(t).forEach((t=>{e.loadingGroups[t.id]=!0,t.lights&&e.setLightsLoading(t.lights)}))},unsetGroupsLoading(t){const e=this;this._getGroups(t).forEach((t=>{t.id in e.loadingGroups&&delete e.loadingGroups[t.id],t.lights&&e.setLightsLoading(t.lights)}))},setLightsLoading(t){const e=this;this._getLights(t).forEach((t=>{e.loadingLights[t.id]=!0}))},unsetLightsLoading(t){const e=this;this._getLights(t).forEach((t=>{t.id in e.loadingLights&&delete e.loadingLights[t.id]}))},async groupAction(t,e,...i){this.setGroupsLoading(i);try{return await this.request(t,e)}finally{this.unsetGroupsLoading(i)}},async lightAction(t,e,...i){this.setLightsLoading(i);try{return await this.request(t,e)}finally{this.unsetLightsLoading(i)}}}};const a=r;var g=a,h=i(9002),u=i(2002),l=i(9828),c={name:"LightHue",components:{Loading:l.A,LightPlugin:o["default"]},mixins:[u.A,g],props:{config:{type:Object,default:()=>{}}},data(){return{loading:!1,colorConverter:new h.o({hue:[0,65535],sat:[0,255],bri:[0,255],ct:[150,500]})}},computed:{initialGroup(){if(!this.config.groups||!Object.keys(this.config.groups).length)return null;const t=this.config.groups[0];return t in this.groups?this.groups[t].id:t in this.groupsByName?this.groupsByName[t].id:null}},methods:{async getLights(){return await this.request("light.hue.get_lights")},async getGroups(){return Object.entries(await this.request("light.hue.get_groups")).filter((t=>!t[1].recycle&&"room"===t[1].type.toLowerCase())).reduce(((t,[e,i])=>(t[e]=i,t)),{})},async getScenes(){return Object.entries(await this.request("light.hue.get_scenes")).filter((t=>!t[1].recycle&&"lightscene"===t[1].type.toLowerCase())).reduce(((t,[e,i])=>(t[e]=i,t)),{})},async getAnimations(){return await this.request("light.hue.get_animations")},async toggleGroup(t){let e=Object.values(this.groups),i={groups:e.map((t=>t.name))};null!=t&&(e=[t],i={groups:[t.name]}),await this.groupAction("light.hue.toggle",i,...e),await this.refresh(!0)},async toggleLight(t){const e=[t],i=null!=t?{lights:[t.name]}:{};await this.lightAction("light.hue.toggle",i,...e),await this.refresh(!0)},async setLight(t){let e=Object.keys(this.lights);const i=t.light,s={};i&&(s.lights=[i.name],e=[i]);const n=this,o=Object.entries(t.value).map((([t,i])=>{let o=null;switch(s.value=i,t){case"brightness":o="light.hue.bri";break;case"temperature":o="light.hue.ct";break;case"xy":o="light.hue.xy";break}if(o)return n.lightAction(o,s,...e)})).filter((t=>null!=t));await Promise.all(o),await this.refresh(!0)},async setGroup(t){if(!t.groupId)return this.setLight(t);const e=this.groups[t.groupId],i={groups:[e.name]},s=this,n=Object.entries(t.value).map((([t,n])=>{let o=null;switch(i.value=n,t){case"brightness":o="light.hue.bri";break;case"temperature":o="light.hue.ct";break;case"xy":o="light.hue.xy";break}if(o)return s.groupAction(o,i,e)})).filter((t=>null!=t));await Promise.all(n),await this.refresh(!0)},async setScene(t){await this.groupAction("light.hue.scene",{name:this.scenes[t.sceneId].name,groups:[this.groups[t.groupId].name]},this.groups[t.groupId]),await this.refresh(!0)},async refresh(t){t||(this.loading=!0);try{[this.lights,this.groups,this.scenes,this.animations]=await Promise.all([this.getLights(),this.getGroups(),this.getScenes(),this.getAnimations()])}finally{t||(this.loading=!1)}},async startAnimation(t){await this.request("light.hue.animate",{lights:t.lights,...t.animation}),await this.refresh(!0)},async stopAnimation(){await this.request("light.hue.stop_animation"),await this.refresh(!0)},onLightChanged(t){this.lights[t.id].state={...this.lights[t.id].state,...t.state}}},mounted(){this.refresh()}},p=i(6262);const d=(0,p.A)(c,[["render",n],["__scopeId","data-v-1b32374c"]]);var m=d}}]);
//# sourceMappingURL=9318.3fc37217.js.map