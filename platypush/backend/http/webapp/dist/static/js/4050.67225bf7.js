"use strict";(self["webpackChunkplatypush"]=self["webpackChunkplatypush"]||[]).push([[4050],{7998:function(e,t,s){s.d(t,{A:function(){return u}});var n=s(641),a=s(33);const o=["disabled","title"];function i(e,t,s,i,r,l){const c=(0,n.g2)("Icon");return(0,n.uX)(),(0,n.CE)("div",{class:(0,a.C4)(["floating-btn",l.classes])},[(0,n.Lk)("button",{type:"button",class:(0,a.C4)(["btn btn-primary",s.glow?"with-glow":""]),disabled:s.disabled,title:s.title,onClick:t[0]||(t[0]=t=>e.$emit("click",t))},[(0,n.bF)(c,{class:(0,a.C4)(s.iconClass),url:s.iconUrl},null,8,["class","url"])],10,o)],2)}var r=s(3778),l={components:{Icon:r.A},emits:["click"],props:{disabled:{type:Boolean,default:!1},iconClass:{type:String},iconUrl:{type:String},class:{type:String},title:{type:String},left:{type:Boolean,default:!1},right:{type:Boolean,default:!0},top:{type:Boolean,default:!1},bottom:{type:Boolean,default:!0},glow:{type:Boolean,default:!1}},computed:{classes(){const e={};return this.left?e.left=!0:e.right=!0,this.top?e.top=!0:e.bottom=!0,this.class?.length&&(e[this.class]=!0),e}}},c=s(6262);const d=(0,c.A)(l,[["render",i],["__scopeId","data-v-544409fc"]]);var u=d},1968:function(e,t,s){s.d(t,{A:function(){return u}});var n=s(641);const a={class:"restart-btn-container"};function o(e,t,s,o,i,r){const l=(0,n.g2)("ConfirmDialog");return(0,n.uX)(),(0,n.CE)("div",a,[(0,n.bF)(l,{ref:"modal",onInput:r.restart},{default:(0,n.k6)((()=>t[2]||(t[2]=[(0,n.eW)(" Are you sure that you want to restart the application? ")]))),_:1},8,["onInput"]),(0,n.Lk)("button",{class:"btn btn-default restart-btn",onClick:t[0]||(t[0]=(...e)=>r.showDialog&&r.showDialog(...e)),onTouch:t[1]||(t[1]=(...e)=>r.showDialog&&r.showDialog(...e))},t[3]||(t[3]=[(0,n.Lk)("i",{class:"fas fa-redo-alt"},null,-1),(0,n.eW)("   Restart Application ")]),32)])}var i=s(3538),r=s(2002),l={name:"RestartButton",components:{ConfirmDialog:i.A},mixins:[r.A],methods:{showDialog(){this.$refs.modal.show()},async restart(){await this.request("application.restart")}}},c=s(6262);const d=(0,c.A)(l,[["render",o],["__scopeId","data-v-2edff8b7"]]);var u=d},11:function(e,t,s){s.d(t,{A:function(){return p}});var n=s(641),a=s(33),o=s(3751);const i=["checked","id"],r={class:"label"};function l(e,t,s,l,c,d){return(0,n.uX)(),(0,n.CE)("div",{class:(0,a.C4)(["power-switch",{disabled:s.disabled}]),onClick:t[0]||(t[0]=(0,o.D$)(((...e)=>d.onInput&&d.onInput(...e)),["stop"]))},[(0,n.Lk)("input",{type:"checkbox",checked:s.value,id:s.id},null,8,i),(0,n.Lk)("label",null,[t[1]||(t[1]=(0,n.Lk)("div",{class:"switch"},[(0,n.Lk)("div",{class:"dot"})],-1)),(0,n.Lk)("span",r,[(0,n.RG)(e.$slots,"default",{},void 0,!0)])])],2)}var c={name:"ToggleSwitch",emits:["input"],props:{id:{type:String},value:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},methods:{onInput(e){if(this.disabled)return!1;this.$emit("input",e)}}},d=s(6262);const u=(0,d.A)(c,[["render",l],["__scopeId","data-v-eff375b6"]]);var p=u},4050:function(e,t,s){s.r(t),s.d(t,{default:function(){return Ue}});var n=s(641);const a={class:"settings-container"};function o(e,t,s,o,i,r){const l=(0,n.g2)("Application"),c=(0,n.g2)("Users"),d=(0,n.g2)("Tokens");return(0,n.uX)(),(0,n.CE)("div",a,[(0,n.Lk)("main",null,["application"===s.selectedPanel?((0,n.uX)(),(0,n.Wv)(l,{key:0})):(0,n.Q3)("",!0),"users"===s.selectedPanel&&i.currentUser?((0,n.uX)(),(0,n.Wv)(c,{key:1,"session-token":i.sessionToken,"current-user":i.currentUser},null,8,["session-token","current-user"])):"tokens"===s.selectedPanel&&i.currentUser?((0,n.uX)(),(0,n.Wv)(d,{key:2,"current-user":i.currentUser},null,8,["current-user"])):(0,n.Q3)("",!0)])])}const i={class:"app-container"},r={class:"btn-container"},l={class:"btn-container"};function c(e,t,s,a,o,c){const d=(0,n.g2)("RestartButton"),u=(0,n.g2)("StopButton");return(0,n.uX)(),(0,n.CE)("div",i,[(0,n.Lk)("div",r,[(0,n.bF)(d)]),(0,n.Lk)("div",l,[(0,n.bF)(u)])])}var d=s(1968);const u={class:"stop-btn-container"};function p(e,t,s,a,o,i){const r=(0,n.g2)("ConfirmDialog");return(0,n.uX)(),(0,n.CE)("div",u,[(0,n.bF)(r,{ref:"modal",onInput:i.stop},{default:(0,n.k6)((()=>t[2]||(t[2]=[(0,n.eW)(" Are you sure that you want to stop the application? "),(0,n.Lk)("br",null,null,-1),(0,n.Lk)("br",null,null,-1),(0,n.Lk)("span",{class:"text-danger"}," This will stop the application and you will not be able to restart it through the Web interface! ",-1)]))),_:1},8,["onInput"]),(0,n.Lk)("button",{class:"btn btn-default stop-btn",onClick:t[0]||(t[0]=(...e)=>i.showDialog&&i.showDialog(...e)),onTouch:t[1]||(t[1]=(...e)=>i.showDialog&&i.showDialog(...e))},t[3]||(t[3]=[(0,n.Lk)("i",{class:"fas fa-stop"},null,-1),(0,n.eW)("   Stop Application ")]),32)])}var h=s(3538),f=s(2002),g={name:"StopButton",components:{ConfirmDialog:h.A},mixins:[f.A],methods:{showDialog(){this.$refs.modal.show()},async stop(){await this.request("application.stop")}}},m=s(6262);const b=(0,m.A)(g,[["render",p],["__scopeId","data-v-1eab04fa"]]);var y=b,k={name:"Application",components:{RestartButton:d.A,StopButton:y}};const w=(0,m.A)(k,[["render",c],["__scopeId","data-v-40365cea"]]);var C=w,v=s(806),L=s(33);const A=["disabled"],_=["disabled"],O=["disabled"],U=["disabled"],E=["value"],F=["disabled"],T=["disabled"],P=["disabled"],$=["disabled"],x={class:"body"},D={class:"users-list"},M=["onClick"],R=["textContent"],I={class:"actions pull-right col-4"};function S(e,t,s,a,o,i){const r=(0,n.g2)("Loading"),l=(0,n.g2)("Modal"),c=(0,n.g2)("Otp"),d=(0,n.g2)("DropdownItem"),u=(0,n.g2)("Dropdown"),p=(0,n.g2)("FloatingButton"),h=(0,n.g2)("ConfirmDialog");return(0,n.uX)(),(0,n.CE)(n.FK,null,[o.loading?((0,n.uX)(),(0,n.Wv)(r,{key:0})):(0,n.Q3)("",!0),(0,n.bF)(l,{ref:"addUserModal",title:"Add User"},{default:(0,n.k6)((()=>[(0,n.Lk)("form",{action:"#",method:"POST",ref:"addUserForm",onSubmit:t[0]||(t[0]=(...e)=>i.createUser&&i.createUser(...e))},[(0,n.Lk)("label",null,[(0,n.Lk)("input",{type:"text",name:"username",placeholder:"Username",disabled:o.commandRunning},null,8,A)]),(0,n.Lk)("label",null,[(0,n.Lk)("input",{type:"password",name:"password",placeholder:"Password",disabled:o.commandRunning},null,8,_)]),(0,n.Lk)("label",null,[(0,n.Lk)("input",{type:"password",name:"confirm_password",placeholder:"Confirm password",disabled:o.commandRunning},null,8,O)]),(0,n.Lk)("label",null,[(0,n.Lk)("input",{type:"submit",class:"btn btn-primary",value:"Create User",disabled:o.commandRunning},null,8,U)])],544)])),_:1},512),(0,n.bF)(l,{ref:"changePasswordModal",title:"Change Password"},{default:(0,n.k6)((()=>[(0,n.Lk)("form",{action:"#",method:"POST",ref:"changePasswordForm",onSubmit:t[1]||(t[1]=(...e)=>i.changePassword&&i.changePassword(...e))},[(0,n.Lk)("label",null,[(0,n.Lk)("input",{type:"text",name:"username",placeholder:"Username",value:o.selectedUser,disabled:"disabled"},null,8,E)]),(0,n.Lk)("label",null,[(0,n.Lk)("input",{type:"password",name:"password",placeholder:"Current password",disabled:o.commandRunning},null,8,F)]),(0,n.Lk)("label",null,[(0,n.Lk)("input",{type:"password",name:"new_password",placeholder:"New password",disabled:o.commandRunning},null,8,T)]),(0,n.Lk)("label",null,[(0,n.Lk)("input",{type:"password",name:"confirm_new_password",placeholder:"Confirm new password",disabled:o.commandRunning},null,8,P)]),(0,n.Lk)("label",null,[(0,n.Lk)("input",{type:"submit",class:"btn btn-primary",value:"Change Password",disabled:o.commandRunning},null,8,$)])],544)])),_:1},512),(0,n.bF)(l,{title:"Two-factor Authentication",visible:o.showOtpModal,onClose:t[2]||(t[2]=e=>o.showOtpModal=!1)},{default:(0,n.k6)((()=>[o.showOtpModal?((0,n.uX)(),(0,n.Wv)(c,{key:0})):(0,n.Q3)("",!0)])),_:1},8,["visible"]),(0,n.Lk)("div",x,[(0,n.Lk)("ul",D,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(o.users,(s=>((0,n.uX)(),(0,n.CE)("li",{key:s.user_id,class:"item user",onClick:e=>o.selectedUser=s.username},[(0,n.Lk)("div",{class:"name col-8",textContent:(0,L.v_)(s.username)},null,8,R),(0,n.Lk)("div",I,[(0,n.bF)(u,{title:"User Actions","icon-class":"fa fa-ellipsis"},{default:(0,n.k6)((()=>[(0,n.bF)(d,{text:"Change Password",disabled:o.commandRunning,"icon-class":"fa fa-key",onInput:e=>i.showChangePasswordModal(s)},null,8,["disabled","onInput"]),(0,n.bF)(d,{text:"Set Up 2FA",disabled:o.commandRunning||!i.supports2fa,"icon-class":"fa fa-lock",title:i.mfaTitle,onInput:t[3]||(t[3]=e=>o.showOtpModal=!0)},null,8,["disabled","title"]),(0,n.bF)(d,{text:"Delete User",disabled:o.commandRunning,"icon-class":"fa fa-trash","item-class":"text-danger",onInput:t=>{o.selectedUser=s.username,e.$refs.deleteUserDialog.show()}},null,8,["disabled","onInput"])])),_:2},1024)])],8,M)))),128))]),(0,n.bF)(p,{"icon-class":"fa fa-plus",text:"Add User",onClick:i.showAddUserModal},null,8,["onClick"]),(0,n.bF)(h,{ref:"deleteUserDialog",onInput:t[4]||(t[4]=e=>i.deleteUser(o.selectedUser))},{default:(0,n.k6)((()=>[(0,n.eW)(" Are you sure that you want to remove the user "+(0,L.v_)(o.selectedUser)+"? ",1)])),_:1},512)])],64)}s(4114);var X=s(9265),Q=s(9513),q=s(9828),W=s(3751);const B={class:"otp-config-container"},j={key:1,class:"otp-config"},z={class:"title"},Y={key:0,class:"current-otp-config"},N={class:"header"},K=["disabled"],G={key:0,class:"section qrcode-container"},H=["src"],J={key:1,class:"section secret-container"},V=["value"],Z={key:2,class:"section uri-container"},ee=["value"],te={key:3,class:"section backup-codes"},se={class:"header"},ne=["disabled"],ae={key:0,class:"description"},oe=["value"],ie={class:"confirm-modal"},re={key:0,class:"dialog"},le={key:1,class:"dialog"},ce=["disabled"],de=["disabled"],ue=["disabled"],pe={class:"buttons"},he=["disabled"];function fe(e,t,s,a,o,i){const r=(0,n.g2)("Loading"),l=(0,n.g2)("ToggleSwitch"),c=(0,n.g2)("ConfirmDialog"),d=(0,n.g2)("Modal");return(0,n.uX)(),(0,n.CE)("div",B,[o.initializing?((0,n.uX)(),(0,n.Wv)(r,{key:0})):((0,n.uX)(),(0,n.CE)("div",j,[(0,n.Lk)("div",z,[(0,n.Lk)("h3",null,"Two-Factor Authentication "+(0,L.v_)(i.otpEnabled?"Enabled":"Disabled"),1),(0,n.bF)(l,{value:i.toggleOn,disabled:o.refreshing,onInput:t[0]||(t[0]=e=>i.currentOtpConfig?.otp_secret?.length?i.startOtpDisable():i.startOtpSetup())},null,8,["value","disabled"])]),t[16]||(t[16]=(0,n.Lk)("p",{class:"description"}," Two-factor authentication adds an extra layer of security to your account. When enabled, you will need to enter a code from your authenticator app in addition to your password. ",-1)),i.currentOtpConfig?.otp_secret?.length?((0,n.uX)(),(0,n.CE)("div",Y,[(0,n.Lk)("div",N,[t[9]||(t[9]=(0,n.Lk)("h4",null,"2FA Configuration",-1)),i.hasChanges&&i.temporaryOtpEnabled?((0,n.uX)(),(0,n.CE)("button",{key:0,class:"btn btn-primary",disabled:o.refreshing,onClick:t[1]||(t[1]=(...t)=>e.$refs.confirmModal.open&&e.$refs.confirmModal.open(...t))},t[8]||(t[8]=[(0,n.Lk)("i",{class:"fas fa-save"},null,-1),(0,n.eW)(" Save ")]),8,K)):(0,n.Q3)("",!0)]),t[15]||(t[15]=(0,n.Lk)("div",{class:"description"},[(0,n.Lk)("p",null,"Scan the QR code with your authenticator app to add this account."),(0,n.Lk)("p",null,"Alternatively, you can add either the secret or the provisioning URL to your password manager or authenticator app.")],-1)),i.currentOtpConfig.qrcode?((0,n.uX)(),(0,n.CE)("div",G,[(0,n.Lk)("img",{class:"qrcode",src:`data:image/png;base64,${i.currentOtpConfig.qrcode}`,alt:"QR Code"},null,8,H)])):(0,n.Q3)("",!0),i.currentOtpConfig.otp_secret?((0,n.uX)(),(0,n.CE)("div",J,[t[10]||(t[10]=(0,n.Lk)("h4",null,"Secret",-1)),(0,n.Lk)("input",{type:"text",value:i.currentOtpConfig.otp_secret,readonly:"",onFocus:t[2]||(t[2]=t=>e.copyToClipboard(t.target.value))},null,40,V)])):(0,n.Q3)("",!0),i.currentOtpConfig.otp_uri?((0,n.uX)(),(0,n.CE)("div",Z,[t[11]||(t[11]=(0,n.Lk)("h4",null,"Provisioning URL",-1)),(0,n.Lk)("input",{type:"text",value:i.currentOtpConfig.otp_uri,readonly:"",onFocus:t[3]||(t[3]=t=>e.copyToClipboard(t.target.value))},null,40,ee)])):(0,n.Q3)("",!0),i.otpEnabled?((0,n.uX)(),(0,n.CE)("div",te,[(0,n.Lk)("div",se,[t[13]||(t[13]=(0,n.Lk)("h4",null,"Backup Codes",-1)),(0,n.Lk)("button",{class:"btn btn-primary",disabled:o.refreshing,onClick:t[4]||(t[4]=(...t)=>e.$refs.confirmRefreshCodes.open&&e.$refs.confirmRefreshCodes.open(...t))},t[12]||(t[12]=[(0,n.Lk)("i",{class:"fas fa-sync"},null,-1),(0,n.eW)(" Regenerate ")]),8,ne)]),o.backupCodes?.length?((0,n.uX)(),(0,n.CE)("div",ae,t[14]||(t[14]=[(0,n.Lk)("p",null," Backup Codes are one-time use codes that can be used to access your account in case you lose access to your authenticator app. ",-1),(0,n.Lk)("p",null,"Make sure to store them in a safe place.",-1),(0,n.Lk)("p",null,[(0,n.Lk)("b",null," Take note of these codes NOW! You will not be able to see them again! ")],-1)]))):(0,n.Q3)("",!0),o.backupCodes?.length?((0,n.uX)(),(0,n.CE)("textarea",{key:1,value:o.backupCodes.join("\n"),readonly:"",onFocus:t[5]||(t[5]=t=>e.copyToClipboard(t.target.value))},null,40,oe)):(0,n.Q3)("",!0)])):(0,n.Q3)("",!0)])):(0,n.Q3)("",!0)])),o.refreshing?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(c,{key:2,ref:"confirmRefreshCodes",onInput:i.refreshCodes},{default:(0,n.k6)((()=>t[17]||(t[17]=[(0,n.eW)(" Are you sure you want to regenerate the backup codes? ")]))),_:1},8,["onInput"])),(0,n.bF)(d,{title:"Confirm 2FA Setup",ref:"confirmModal",onOpen:i.onConfirmModalOpen},{default:(0,n.k6)((()=>[(0,n.Lk)("div",ie,[i.temporaryOtpEnabled?((0,n.uX)(),(0,n.CE)("div",re,t[18]||(t[18]=[(0,n.Lk)("p",null,"Are you sure you want to enable Two-Factor Authentication?",-1),(0,n.Lk)("p",null,"Make sure to save the secret and backup codes in a safe place.",-1),(0,n.Lk)("p",null," In order to enable Two-Factor Authentication, you will need to enter your password and a code from your authenticator app. ",-1)]))):((0,n.uX)(),(0,n.CE)("div",le,t[19]||(t[19]=[(0,n.Lk)("p",null,"Are you sure you want to disable Two-Factor Authentication?",-1),(0,n.Lk)("p",null," You will no longer need to enter a code from your authenticator app. You will still need to enter your password to log in, but your account may be less secure. ",-1),(0,n.Lk)("p",null," In order to disable Two-Factor Authentication, you will need to enter your password. ",-1)]))),(0,n.Lk)("form",{disabled:o.refreshing,onSubmit:t[7]||(t[7]=(0,W.D$)((e=>i.otpEnabled?i.disableOtp():i.enableOtp()),["prevent"]))},[(0,n.Lk)("input",{type:"password",placeholder:"Password",required:"",disabled:o.refreshing,ref:"password"},null,8,de),i.temporaryOtpEnabled?((0,n.uX)(),(0,n.CE)("input",{key:0,type:"text",placeholder:"Authenticator Code",required:"",disabled:o.refreshing,ref:"code"},null,8,ue)):(0,n.Q3)("",!0),(0,n.Lk)("div",pe,[(0,n.Lk)("button",{class:"btn btn-primary",disabled:o.refreshing,type:"submit"},[t[20]||(t[20]=(0,n.Lk)("i",{class:"fas fa-check"},null,-1)),t[21]||(t[21]=(0,n.eW)(" Confirm ")),o.refreshing?((0,n.uX)(),(0,n.Wv)(r,{key:0})):(0,n.Q3)("",!0)],8,he),(0,n.Lk)("button",{class:"btn btn-default",onClick:t[6]||(t[6]=(...t)=>e.$refs.confirmModal.close&&e.$refs.confirmModal.close(...t))},t[22]||(t[22]=[(0,n.Lk)("i",{class:"fas fa-times"},null,-1),(0,n.eW)(" Cancel ")]))])],40,ce)])])),_:1},8,["onOpen"])])}var ge=s(11),me=s(4335),be={mixins:[f.A],components:{ConfirmDialog:h.A,Loading:q.A,Modal:Q.A,ToggleSwitch:ge.A},data(){return{backupCodes:[],initializing:!1,otpConfig:null,refreshing:!1,temporaryOtpConfig:null}},computed:{currentOtpConfig(){return this.otpEnabled?this.otpConfig:this.temporaryOtpConfig},hasChanges(){return!this.otpEnabled&&null!=this.temporaryOtpConfig||this.otpEnabled&&(null==this.temporaryOtpConfig||this.temporaryOtpConfig?.otp_secret!=this.otpConfig?.otp_secret)},otpEnabled(){return!!this?.otpConfig?.otp_secret?.length},temporaryOtpDisabled(){return this.hasChanges&&null==this.temporaryOtpConfig?.otp_secret},temporaryOtpEnabled(){return this.hasChanges&&null!=this.temporaryOtpConfig?.otp_secret},toggleOn(){return this.otpEnabled||this.temporaryOtpEnabled}},methods:{getErrorMessage(e){return e.response?.data?.message||e.response?.data?.error||e.message||e.response?.statusText||e.toString()},onError(e){console.error(e),e=this.getErrorMessage(e),this.notify({error:!0,title:"Error while setting up Two-Factor Authentication",text:e,image:{iconClass:"fas fa-exclamation-triangle"}})},async getOtpConfig(){this.initializing=!0;try{this.otpConfig=(await me.A.get("/otp/config")).data,this.temporaryOtpConfig=this.otpConfig}catch(e){this.onError(e)}finally{this.initializing=!1}},async startOtpSetup(){this.refreshing=!0;try{this.temporaryOtpConfig=(await me.A.post("/otp/config",{dry_run:!0})).data}finally{this.refreshing=!1}},async enableOtp(){this.refreshing=!0;try{const e=await me.A.post("/otp/config",{otp_secret:this.temporaryOtpConfig.otp_secret,password:this.$refs.password.value,code:this.$refs.code.value});this.backupCodes=e.data?.backup_codes||[],await this.getOtpConfig(),this.$refs.confirmModal.close(),this.notify({title:"Two-Factor Authentication enabled",text:"Two-Factor Authentication has been enabled for your account",image:{iconClass:"fas fa-shield-alt"}})}catch(e){this.onError(e)}finally{this.refreshing=!1}},async startOtpDisable(){this.temporaryOtpConfig=null,this.$refs.confirmModal.open()},async disableOtp(){this.refreshing=!0;try{await me.A.delete("/otp/config",{headers:{"Content-Type":"application/json"},data:{password:this.$refs.password.value}}),await this.getOtpConfig(),this.$refs.confirmModal.close(),this.notify({title:"Two-Factor Authentication disabled",text:"Two-Factor Authentication has been disabled for your account",image:{iconClass:"fas fa-shield-alt"}})}catch(e){this.onError(e)}finally{this.refreshing=!1}},async refreshCodes(){this.refreshing=!0;try{const e=await me.A.post("/otp/refresh-codes");this.backupCodes=e.data?.backup_codes||[],this.notify({title:"Backup codes regenerated",text:"Take note of these codes NOW! You will not be able to see them again!",image:{iconClass:"fas fa-shield-alt"}})}catch(e){this.onError(e)}finally{this.refreshing=!1}},onConfirmModalOpen(){this.$nextTick((()=>{this.$refs.password.value="",this.$refs.code&&(this.$refs.code.value=""),this.$refs.password.focus()}))}},async mounted(){await this.getOtpConfig()}};const ye=(0,m.A)(be,[["render",fe],["__scopeId","data-v-24d32b46"]]);var ke=ye,we=s(9612),Ce=s(7998),ve={name:"Users",components:{ConfirmDialog:h.A,Dropdown:X.A,DropdownItem:we.A,FloatingButton:Ce.A,Loading:q.A,Modal:Q.A,Otp:ke},mixins:[f.A],props:{sessionToken:{type:String,required:!0},currentUser:{type:Object,required:!0}},data(){return{users:[],commandRunning:!1,loading:!1,selectedUser:null,hasOtpPlugin:!1,hasQrcodePlugin:!1,showOtpModal:!1}},computed:{supports2fa(){return this.hasOtpPlugin&&this.hasQrcodePlugin},mfaTitle(){if(this.supports2fa)return"";const e=[];return this.hasOtpPlugin||e.push("otp"),this.hasQrcodePlugin||e.push("qrcode"),"The following plugin(s) are missing: "+e.join(", ")}},methods:{async testOtp(){this.commandRunning=!0,this.hasOtpPlugin=!1,this.hasQrcodePlugin=!1;try{this.hasOtpPlugin=!0;const e=await this.request("otp.generate_secret",{},1e4,!1);if("string"===typeof e&&e.length){const e=await this.request("qrcode.generate",{content:"test"},1e4,!1);e?.data?.length&&(this.hasQrcodePlugin=!0)}}catch(e){this.hasOtpPlugin||console.info("otp plugin not found. Enable/configure it to use 2FA"),this.hasQrcodePlugin||console.info("qrcode plugin not found. Enable/configure it to use 2FA")}finally{this.commandRunning=!1}},async refresh(){this.loading=!0;try{this.users=await this.request("user.get_users")}finally{this.loading=!1}},async createUser(e){e.preventDefault();const t=[...this.$refs.addUserForm.querySelectorAll("input[name]")].reduce(((e,t)=>(e[t.name]=t.value,e)),{});if(t.password===t.confirm_password){this.commandRunning=!0;try{await this.request("user.create_user",{username:t.username,password:t.password,session_token:this.sessionToken})}finally{this.commandRunning=!1}this.notify({text:"User "+t.username+" created",image:{iconClass:"fas fa-check"}}),this.$refs.addUserModal.close(),await this.refresh()}else this.notify({title:"Unable to create user",text:"Please check that the passwords match",error:!0,image:{iconClass:"fas fa-times"}})},async changePassword(e){e.preventDefault();const t=[...this.$refs.changePasswordForm.querySelectorAll("input[name]")].reduce(((e,t)=>(e[t.name]=t.value,e)),{});if(t.new_password!==t.confirm_new_password)return void this.notify({title:"Unable to update password",text:"Please check that the passwords match",error:!0,image:{iconClass:"fas fa-times"}});this.commandRunning=!0;let s=!1;try{s=await this.request("user.update_password",{username:t.username,old_password:t.password,new_password:t.new_password})}finally{this.commandRunning=!1}s?(this.$refs.changePasswordModal.close(),this.notify({text:"Password successfully updated",image:{iconClass:"fas fa-check"}})):this.notify({title:"Unable to update password",text:"The current password is incorrect",error:!0,image:{iconClass:"fas fa-times"}})},async deleteUser(e){this.commandRunning=!0;try{await this.request("user.delete_user",{username:e,session_token:this.sessionToken})}finally{this.commandRunning=!1}this.notify({text:`User ${e} removed`,image:{iconClass:"fas fa-check"}}),this.selectedUser=null,await this.refresh()},showAddUserModal(){this.$refs.addUserModal.show(),this.$nextTick((()=>{this.$refs.addUserForm.reset(),this.$refs.addUserForm.username.focus()}))},showChangePasswordModal(e){this.$refs.changePasswordModal.show(),this.$nextTick((()=>{this.$refs.changePasswordForm.password.focus(),this.selectedUser=e.username}))}},async mounted(){await this.refresh(),await this.testOtp(),this.supports2fa||this.notify({title:"Two-factor Authentication not available",text:this.mfaTitle,error:!0,image:{iconClass:"fas fa-exclamation-triangle"}})}};const Le=(0,m.A)(ve,[["render",S],["__scopeId","data-v-dbc28730"]]);var Ae=Le,_e={name:"Settings",components:{Application:C,Users:Ae,Tokens:v["default"]},mixins:[f.A],emits:["change-page"],props:{selectedPanel:{type:String}},data(){return{currentUser:null,sessionToken:null}},methods:{async refresh(){this.sessionToken=this.getCookies()["session_token"],this.currentUser=await this.request("user.get_user_by_session",{session_token:this.sessionToken})},updatePage(){const e=this.getUrlArgs();let t=null;t=e.page?.length?e.page:this.selectedPanel?.length?this.selectedPanel:"users",this.$emit("change-page",t)}},watch:{selectedPanel(e){this.setUrlArgs({page:e})},$route(){this.updatePage()}},async mounted(){this.updatePage(),await this.refresh()}};const Oe=(0,m.A)(_e,[["render",o],["__scopeId","data-v-7c14160a"]]);var Ue=Oe}}]);
//# sourceMappingURL=4050.67225bf7.js.map