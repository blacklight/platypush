"use strict";(self["webpackChunkplatypush"]=self["webpackChunkplatypush"]||[]).push([[8297],{9002:function(e,t,n){n.d(t,{o:function(){return o}});class o{constructor(e){if(this.ranges={hue:[0,360],sat:[0,100],bri:[0,100],ct:[154,500]},e)for(const t of Object.keys(this.ranges))e[t]&&(this.ranges[t]=e[t])}normalize(e,t,n){return n[0]+(e-t[0])*(n[1]-n[0])/(t[1]-t[0])}hslToRgb(e,t,n){[e,t,n]=[this.normalize(e,this.ranges.hue,[0,360]),this.normalize(t,this.ranges.sat,[0,100]),this.normalize(n,this.ranges.bri,[0,100])],n/=100;const o=t*Math.min(n,1-n)/100,s=t=>{const s=(t+e/30)%12,l=n-o*Math.max(Math.min(s-3,9-s,1),-1);return Math.round(255*l)};return[s(0),s(8),s(4)]}rgbToHsl(e,t,n){e/=255,t/=255,n/=255;const o=Math.max(e,t,n),s=Math.min(e,t,n);let l,i,a=(o+s)/2;if(o===s)l=i=0;else{const r=o-s;switch(i=a>.5?r/(2-o-s):r/(o+s),o){case e:l=(t-n)/r+(t<n?6:0);break;case t:l=(n-e)/r+2;break;case n:l=(e-t)/r+4;break}l/=6}return[parseInt(this.normalize(l,[0,1],this.ranges.hue)),parseInt(this.normalize(i,[0,1],this.ranges.sat)),parseInt(this.normalize(a,[0,1],this.ranges.bri))]}xyToRgb(e,t,n){null==n&&(n=this.ranges.bri[1]);const o=1-e-t,s=(n/(this.ranges.bri[1]-1)).toFixed(2),l=s/t*e,i=s/t*o;let a=1.656492*l-.354851*s-.255038*i,r=.707196*-l+1.655397*s+.036152*i,c=.051713*l-.121364*s+1.01153*i;return a>c&&a>r&&a>1?(r/=a,c/=a,a=1):r>c&&r>a&&r>1?(a/=r,c/=r,r=1):c>a&&c>r&&c>1&&(a/=c,r/=c,c=1),a=a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055,r=r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055,c=c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055,a=Math.round(255*a),r=Math.round(255*r),c=Math.round(255*c),isNaN(a)&&(a=0),isNaN(r)&&(r=0),isNaN(c)&&(c=0),[a,r,c].map((e=>Math.min(Math.max(0,e),255)))}rgbToXY(e,t,n){e>1&&(e/=255),t>1&&(t/=255),n>1&&(n/=255),e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92;const o=.664511*e+.154324*t+.162028*n,s=.283881*e+.668433*t+.047685*n,l=88e-6*e+.07231*t+.986039*n;let i=parseFloat((o/(o+s+l)).toFixed(4)),a=parseFloat((s/(o+s+l)).toFixed(4));return isNaN(i)&&(i=0),isNaN(a)&&(a=0),[i,a]}rgbToBri(e,t,n){return Math.min(2*this.rgbToHsl(e,t,n)[2],this.ranges.bri[1])}getRGB(e){return null!=e.red&&null!=e.green&&null!=e.blue?[e.red,e.green,e.blue]:null!=e.r&&null!=e.g&&null!=e.b?[e.r,e.g,e.b]:e.rgb?e.rgb:void 0}getXY(e){return null!=e.x&&null!=e.y?[e.x,e.y]:e.xy?e.xy:void 0}toRGB(e){const t=this.getRGB(e);if(t)return t;const n=this.getXY(e);return n&&e.bri?this.xyToRgb(...n,e.bri):e.hue&&e.sat&&e.bri?this.hslToRgb(e.hue,e.sat,e.bri):(console.debug("Could not determine color space"),void console.debug(e))}toXY(e){const t=this.getXY(e);if(t&&e.bri)return[t[0],t[1],e.bri];const n=this.getRGB(e);if(n)return this.rgbToXY(...n);if(e.hue&&e.sat&&e.bri){const t=this.hslToRgb(e.hue,e.sat,e.bri);return this.rgbToXY(...t)}console.debug("Could not determine color space"),console.debug(e)}toHSL(e){if(e.hue&&e.sat&&e.bri)return[e.hue,e.sat,e.bri];const t=this.getRGB(e);if(t)return this.rgbToHsl(...t);const n=this.getXY(e);if(n&&e.bri){const t=this.xyToRgb(...n,e.bri);return this.rgbToHsl(...t)}console.debug("Could not determine color space"),console.debug(e)}hexToRgb(e){return[e.slice(1,3),e.slice(3,5),e.slice(5,7)].map((e=>parseInt(e,16)))}rgbToHex(e){return"#"+e.map((e=>{let t=e.toString(16);return t.length<2&&(t="0"+t),t})).join("")}}},1808:function(e,t,n){n.d(t,{A:function(){return m}});var o=n(641),s=n(33),l=n(3751);const i={class:"slider-wrapper"},a=["textContent"],r=["textContent"],c={class:"slider-container"},u=["min","max","step","disabled","value"],g=["textContent"];function d(e,t,n,d,p,h){return(0,o.uX)(),(0,o.CE)("label",i,[n.withRange?((0,o.uX)(),(0,o.CE)("span",{key:0,class:(0,s.C4)(["range-labels",{"with-label":n.withLabel}])},[n.withRange?((0,o.uX)(),(0,o.CE)("span",{key:0,class:"label left",textContent:(0,s.v_)(n.range[0])},null,8,a)):(0,o.Q3)("",!0),n.withRange?((0,o.uX)(),(0,o.CE)("span",{key:1,class:"label right",textContent:(0,s.v_)(n.range[1])},null,8,r)):(0,o.Q3)("",!0)],2)):(0,o.Q3)("",!0),(0,o.Lk)("span",c,[(0,o.Lk)("input",{class:(0,s.C4)(["slider",{"with-label":n.withLabel}]),type:"range",min:n.range[0],max:n.range[1],step:n.step,disabled:n.disabled,value:n.value,ref:"range",onInput:t[0]||(t[0]=(0,l.D$)((t=>e.$emit("input",t)),["stop"])),onChange:t[1]||(t[1]=(0,l.D$)((t=>e.$emit("change",t)),["stop"]))},null,42,u),n.withLabel?((0,o.uX)(),(0,o.CE)("span",{key:0,class:"label",textContent:(0,s.v_)(n.value),ref:"label"},null,8,g)):(0,o.Q3)("",!0)])])}var p={emits:["input","change"],props:{value:{type:Number},disabled:{type:Boolean,default:!1},range:{type:Array,default:()=>[0,100]},step:{type:Number,default:1},withLabel:{type:Boolean,default:!1},withRange:{type:Boolean,default:!1}}},h=n(6262);const v=(0,h.A)(p,[["render",d],["__scopeId","data-v-d90e850c"]]);var m=v},11:function(e,t,n){n.d(t,{A:function(){return d}});var o=n(641),s=n(33),l=n(3751);const i=["checked","id"],a={class:"label"};function r(e,t,n,r,c,u){return(0,o.uX)(),(0,o.CE)("div",{class:(0,s.C4)(["power-switch",{disabled:n.disabled}]),onClick:t[0]||(t[0]=(0,l.D$)(((...e)=>u.onInput&&u.onInput(...e)),["stop"]))},[(0,o.Lk)("input",{type:"checkbox",checked:n.value,id:n.id},null,8,i),(0,o.Lk)("label",null,[t[1]||(t[1]=(0,o.Lk)("div",{class:"switch"},[(0,o.Lk)("div",{class:"dot"})],-1)),(0,o.Lk)("span",a,[(0,o.RG)(e.$slots,"default",{},void 0,!0)])])],2)}var c={name:"ToggleSwitch",emits:["input"],props:{id:{type:String},value:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},methods:{onInput(e){if(this.disabled)return!1;this.$emit("input",e)}}},u=n(6262);const g=(0,u.A)(c,[["render",r],["__scopeId","data-v-eff375b6"]]);var d=g},8297:function(e,t,n){n.r(t),n.d(t,{default:function(){return gt}});var o=n(641);const s={class:"plugin lights-plugin"},l={class:"panel"},i={key:0,class:"groups lights-container"},a={key:1,class:"lights-container ungrouped-lights"},r={key:2,class:"group"};function c(e,t,n,c,u,g){const d=(0,o.g2)("Groups"),p=(0,o.g2)("Group");return(0,o.uX)(),(0,o.CE)("div",s,[(0,o.Lk)("div",l,[null==u.selectedGroup&&Object.keys(n.groups||{}).length?((0,o.uX)(),(0,o.CE)("div",i,[(0,o.bF)(d,{groups:n.groups,"loading-groups":n.loadingGroups,"color-converter":n.colorConverter,onSelect:t[0]||(t[0]=e=>u.selectedGroup=e),onToggle:t[1]||(t[1]=t=>e.$emit("group-toggle",t))},null,8,["groups","loading-groups","color-converter"])])):(0,o.Q3)("",!0),Object.keys(g.ungroupedLights||{}).length&&null==u.selectedGroup?((0,o.uX)(),(0,o.CE)("div",a,[(0,o.bF)(p,{group:g.ungroupedLights,lights:g.ungroupedLights,scenes:g.scenesByGroup[u.selectedGroup],"color-converter":n.colorConverter,animations:g.animationsByGroup[u.selectedGroup],"with-back-button":!1,title:"Ungrouped Lights",onClose:t[2]||(t[2]=e=>u.selectedGroup=null),onLightToggle:t[3]||(t[3]=t=>e.$emit("light-toggle",t)),onSelectScene:t[4]||(t[4]=t=>e.$emit("select-scene",{groupId:u.selectedGroup,sceneId:t})),onSetLight:t[5]||(t[5]=t=>e.$emit("set-light",t)),onStartAnimation:t[6]||(t[6]=t=>e.$emit("start-animation",t)),onStopAnimation:t[7]||(t[7]=t=>e.$emit("stop-animation",t))},null,8,["group","lights","scenes","color-converter","animations"])])):(0,o.Q3)("",!0),n.groups?.[u.selectedGroup]?((0,o.uX)(),(0,o.CE)("div",r,[(0,o.bF)(p,{group:n.groups[u.selectedGroup],lights:g.displayedLights,scenes:g.scenesByGroup[u.selectedGroup],"color-converter":n.colorConverter,animations:g.animationsByGroup[u.selectedGroup],onClose:t[8]||(t[8]=e=>u.selectedGroup=null),onGroupToggle:t[9]||(t[9]=t=>e.$emit("group-toggle",t)),onLightToggle:t[10]||(t[10]=t=>e.$emit("light-toggle",t)),onSelectScene:t[11]||(t[11]=t=>e.$emit("select-scene",{groupId:u.selectedGroup,sceneId:t})),onSetGroup:t[12]||(t[12]=t=>e.$emit("set-group",{groupId:u.selectedGroup,value:t})),onSetLight:t[13]||(t[13]=t=>e.$emit("set-light",t)),onStartAnimation:t[14]||(t[14]=t=>e.$emit("start-animation",t)),onStopAnimation:t[15]||(t[15]=t=>e.$emit("stop-animation",t))},null,8,["group","lights","scenes","color-converter","animations"])])):(0,o.Q3)("",!0)])])}var u=n(2002),g={name:"Panel",emits:["mounted"],props:{config:{type:Object,default:()=>{}},pluginName:{type:String,required:!0}},data(){return{loading:!1}},mounted(){this.$emit("mounted",this)}};const d=g;var p=d,h=n(33);const v={class:"light-groups-container"},m={class:"panel-row header"},b={class:"col-3 pull-right"},k=["onClick"],C={class:"name col-9"},y={class:"controls col-3 pull-right"};function L(e,t,n,s,l,i){const a=(0,o.g2)("ToggleSwitch"),r=(0,o.g2)("MenuPanel");return(0,o.uX)(),(0,o.CE)("div",v,[(0,o.bF)(r,null,{default:(0,o.k6)((()=>[(0,o.Lk)("div",m,[t[1]||(t[1]=(0,o.Lk)("div",{class:"col-3"},[(0,o.Lk)("i",{class:"icon fas fa-home"})],-1)),t[2]||(t[2]=(0,o.Lk)("div",{class:"col-6 name"}," Rooms ",-1)),(0,o.Lk)("div",b,[(0,o.bF)(a,{value:i.anyLightsOn,onInput:t[0]||(t[0]=t=>e.$emit("toggle"))},null,8,["value"])])]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.groupsSorted,(t=>((0,o.uX)(),(0,o.CE)("div",{class:"panel-row row group",key:t.id,onClick:n=>e.$emit("select",t.id)},[(0,o.Lk)("span",C,(0,h.v_)(t.name||`[Group ${t.id}]`),1),(0,o.Lk)("span",y,[(0,o.bF)(a,{value:t.state.any_on,disabled:t.id in(n.loadingGroups||{}),onInput:n=>e.$emit("toggle",t)},null,8,["value","disabled","onInput"])])],8,k)))),128))])),_:1})])}const f={class:"menu-panel"},w={class:"content"};function _(e,t,n,s,l,i){return(0,o.uX)(),(0,o.CE)("div",f,[(0,o.Lk)("div",w,[(0,o.RG)(e.$slots,"default")])])}var S={name:"MenuPanel"},X=n(6262);const $=(0,X.A)(S,[["render",_]]);var A=$,O=n(11),j=n(9002),E={name:"Groups",components:{ToggleSwitch:O.A,MenuPanel:A},emits:["select","toggle"],props:{groups:{type:Object,default:()=>{}},loadingGroups:{type:Object,default:()=>{}},colorConverter:{type:Object,default:()=>new j.o}},computed:{groupsSorted(){return Object.entries(this.groups).sort(((e,t)=>e[1].name.localeCompare(t[1].name))).map((([e,t])=>({...t,id:e})))},anyLightsOn(){for(const e of Object.values(this.groups))if(e?.state?.any_on)return!0;return!1}}};const G=(0,X.A)(E,[["render",L],["__scopeId","data-v-5b302176"]]);var I=G;const x={class:"light-group-container"},B={class:"panel-row header"},F={key:0,class:"col-3"},T=["textContent"],R={key:1,class:"col-3 pull-right"},M={key:0,class:"no-lights"},Q={key:1,class:"lights-view"},N={class:"row view-selector"},U=["title"],V={key:0,class:"view fade-in"},D=["onClick"],P={key:1,class:"view fade-in"},H=["onClick"],z={key:2,class:"view group-controls fade-in"},W={key:3,class:"view group-controls fade-in"};function Y(e,t,n,s,l,i){const a=(0,o.g2)("ToggleSwitch"),r=(0,o.g2)("Light"),c=(0,o.g2)("Scene"),u=(0,o.g2)("Controls"),g=(0,o.g2)("Animate"),d=(0,o.g2)("MenuPanel");return(0,o.uX)(),(0,o.CE)("div",x,[(0,o.bF)(d,null,{default:(0,o.k6)((()=>[(0,o.Lk)("div",B,[n.group?((0,o.uX)(),(0,o.CE)("div",F,[n.withBackButton?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"back-btn",title:"Back",onClick:t[0]||(t[0]=(...e)=>i.close&&i.close(...e))},t[9]||(t[9]=[(0,o.Lk)("i",{class:"fas fa-chevron-left"},null,-1)]))):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:(0,h.C4)(["col-6 name",{selected:"group"===l.selectedView}]),textContent:(0,h.v_)(i.groupName),onClick:t[1]||(t[1]=e=>l.selectedView="group"===l.selectedView?null:"group")},null,10,T),n.group?((0,o.uX)(),(0,o.CE)("div",R,[(0,o.bF)(a,{value:i.anyLightsOn,onInput:t[2]||(t[2]=t=>e.$emit("group-toggle",n.group))},null,8,["value"])])):(0,o.Q3)("",!0)]),n.lights&&Object.keys(n.lights).length?((0,o.uX)(),(0,o.CE)("div",Q,[(0,o.Lk)("div",N,[(0,o.Lk)("button",{class:(0,h.C4)({selected:"lights"===l.selectedView}),title:n.title,onClick:t[3]||(t[3]=e=>l.selectedView="lights")},t[10]||(t[10]=[(0,o.Lk)("i",{class:"icon fas fa-lightbulb"},null,-1)]),10,U),(0,o.Lk)("button",{class:(0,h.C4)({selected:"scenes"===l.selectedView}),title:"Scenes",onClick:t[4]||(t[4]=e=>l.selectedView="scenes")},t[11]||(t[11]=[(0,o.Lk)("i",{class:"icon far fa-image"},null,-1)]),2),(0,o.Lk)("button",{class:(0,h.C4)({selected:"animate"===l.selectedView}),title:"Animate",onClick:t[5]||(t[5]=e=>l.selectedView="animate")},t[12]||(t[12]=[(0,o.Lk)("i",{class:"icon fas fa-video"},null,-1)]),2)]),"lights"===l.selectedView?((0,o.uX)(),(0,o.CE)("div",V,[((0,o.uX)(),(0,o.Wv)(o.PR,null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.lightsSorted,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{class:(0,h.C4)(["panel-row row",{expanded:t.id===l.selectedLight}]),key:s,onClick:e=>l.selectedLight=l.selectedLight===t.id?null:t.id},[(0,o.bF)(r,{light:t,group:n.group,collapsed:t.id!==l.selectedLight,"color-converter":n.colorConverter,onToggle:n=>e.$emit("light-toggle",t),onSetLight:n=>e.$emit("set-light",{light:t,value:n})},null,8,["light","group","collapsed","color-converter","onToggle","onSetLight"])],10,D)))),128))],1024))])):"scenes"===l.selectedView?((0,o.uX)(),(0,o.CE)("div",P,[((0,o.uX)(),(0,o.Wv)(o.PR,null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.scenesSorted,((e,t)=>((0,o.uX)(),(0,o.CE)("div",{class:(0,h.C4)(["panel-row row",{selected:e.id===l.selectedScene}]),key:t,onClick:t=>i.onSceneSelected(e.id)},[(0,o.bF)(c,{scene:e,group:n.group},null,8,["scene","group"])],10,H)))),128))],1024))])):"group"===l.selectedView?((0,o.uX)(),(0,o.CE)("div",z,[((0,o.uX)(),(0,o.Wv)(o.PR,null,[(0,o.bF)(u,{group:n.group,lights:n.lights,"color-converter":n.colorConverter,onSetGroup:t[6]||(t[6]=t=>e.$emit("set-group",t))},null,8,["group","lights","color-converter"])],1024))])):"animate"===l.selectedView?((0,o.uX)(),(0,o.CE)("div",W,[((0,o.uX)(),(0,o.Wv)(o.PR,null,[(0,o.bF)(g,{group:n.group,lights:n.lights,"color-converter":n.colorConverter,"running-animations":n.animations,onStart:t[7]||(t[7]=t=>e.$emit("start-animation",t)),onStop:t[8]||(t[8]=t=>e.$emit("stop-animation",t))},null,8,["group","lights","color-converter","running-animations"])],1024))])):(0,o.Q3)("",!0)])):((0,o.uX)(),(0,o.CE)("div",M," No lights found "))])),_:1})])}const K={class:"row"},q={class:"toggle col-3 pull-right"},J={key:0,class:"row fade-in"};function Z(e,t,n,s,l,i){const a=(0,o.g2)("ToggleSwitch"),r=(0,o.g2)("Controls");return(0,o.uX)(),(0,o.CE)("div",{class:(0,h.C4)(["light",{expanded:!n.collapsed}]),ref:"element"},[(0,o.Lk)("div",K,[(0,o.Lk)("span",{class:"name col-9",onClick:t[0]||(t[0]=(...e)=>i.expandToggle&&i.expandToggle(...e))},(0,h.v_)(n.light.name||`[Light ${n.light.id}]`),1),(0,o.Lk)("span",q,[(0,o.bF)(a,{value:n.light.state.on,disabled:n.loading,onInput:t[1]||(t[1]=t=>e.$emit("toggle",n.light))},null,8,["value","disabled"])])]),n.collapsed?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",J,[(0,o.bF)(r,{light:n.light,loading:n.loading,"color-converter":n.colorConverter,onSetLight:t[2]||(t[2]=t=>e.$emit("set-light",t))},null,8,["light","loading","color-converter"])]))],2)}var ee=n(3751);const te={key:1,class:"row"},ne={class:"col-11 control"},oe={key:2,class:"row"},se={class:"col-11 control"},le={key:3,class:"row"},ie={class:"col-11 control"},ae=["value"];function re(e,t,n,s,l,i){const a=(0,o.g2)("Loading"),r=(0,o.g2)("Slider");return(0,o.uX)(),(0,o.CE)("div",{class:"controls light-controls",onClick:t[3]||(t[3]=e=>e.stopPropagation())},[n.loading?((0,o.uX)(),(0,o.Wv)(a,{key:0})):(0,o.Q3)("",!0),null!=i.state.bri?((0,o.uX)(),(0,o.CE)("div",te,[t[4]||(t[4]=(0,o.Lk)("div",{class:"col-1 icon"},[(0,o.Lk)("i",{class:"fas fa-sun"})],-1)),(0,o.Lk)("div",ne,[(0,o.bF)(r,{range:n.colorConverter.ranges.bri,disabled:n.loading,value:i.state.bri,onChange:t[0]||(t[0]=(0,ee.D$)((t=>e.$emit(n.light?"set-light":"set-group",{brightness:parseInt(t.target.value)})),["stop"]))},null,8,["range","disabled","value"])])])):(0,o.Q3)("",!0),null!=i.state.ct?((0,o.uX)(),(0,o.CE)("div",oe,[t[5]||(t[5]=(0,o.Lk)("div",{class:"col-1 icon"},[(0,o.Lk)("i",{class:"fas fa-thermometer-half"})],-1)),(0,o.Lk)("div",se,[(0,o.bF)(r,{range:n.colorConverter.ranges.ct,disabled:n.loading,value:i.state.ct,onChange:t[1]||(t[1]=(0,ee.D$)((t=>e.$emit(n.light?"set-light":"set-group",{temperature:parseInt(t.target.value)})),["stop"]))},null,8,["range","disabled","value"])])])):(0,o.Q3)("",!0),i.rgbColor?((0,o.uX)(),(0,o.CE)("label",le,[t[6]||(t[6]=(0,o.Lk)("span",{class:"col-1 icon"},[(0,o.Lk)("i",{class:"fas fa-palette"})],-1)),(0,o.Lk)("span",ie,[(0,o.Lk)("input",{type:"color",value:i.rgbColor,onChange:t[2]||(t[2]=(0,ee.D$)(((...e)=>i.onColorSelect&&i.onColorSelect(...e)),["stop"]))},null,40,ae)])])):(0,o.Q3)("",!0)])}var ce=n(1808),ue=n(9828),ge={name:"Controls",components:{Loading:ue.A,Slider:ce.A},emits:["set-light","set-group"],props:{light:{type:Object},lights:{type:Object},group:{type:Object},loading:{type:Boolean,default:!1},colorConverter:{type:Object,default:()=>new j.o}},computed:{state(){if(this.light?.state)return this.light.state;const e=this.group?.state||{};if(!this.lights)return e;const t=e=>e&&e.length?e[0]instanceof Array?[...e[0].keys()].map((n=>t(e.map((e=>e[n]))))):e.reduce(((e,t)=>e+t),0)/e.length:0;return{...e,...Object.entries(Object.values(this.lights).reduce(((e,t)=>(["bri","hue","sat","rgb","xy","red","green","blue","ct"].forEach((n=>{null!=t.state?.[n]&&(e[n]=[...e[n]||[],t.state[n]])})),e)),{})).reduce(((e,[n,o])=>(e[n]=t(o),e)),{})}},color(){return this.getColor(this.state)},rgbColor(){const e=this.colorConverter.toRGB(this.state);return e?"#"+e.map((e=>{let t=e.toString(16);return t.length<2&&(t="0"+t),t})).join(""):null}},methods:{onColorSelect(e){const t=e.target.value.slice(1).split(/(?=(?:..)*$)/).map((e=>parseInt(`0x${e}`)));this.$emit(this.light?"set-light":"set-group",{rgb:t,xy:this.colorConverter.rgbToXY(...t),hsl:this.colorConverter.rgbToHsl(...t),brightness:this.colorConverter.rgbToBri(...t)})},getColor(e){return{rgb:this.colorConverter.toRGB(e),xy:this.colorConverter.toXY(e),hsl:this.colorConverter.toHSL(e)}}}};const de=(0,X.A)(ge,[["render",re],["__scopeId","data-v-9c012c62"]]);var pe=de,he={name:"Light",components:{Controls:pe,ToggleSwitch:O.A},emits:["toggle","set-light","collapsed","expanded"],props:{light:{type:Object,default:()=>{}},group:{type:Object,default:()=>{}},loading:{type:Boolean,default:!1},collapsed:{type:Boolean,default:!0},colorConverter:{type:Object,default:()=>new j.o}},methods:{expandToggle(){this.$emit(this.collapsed?"expanded":"collapsed")}}};const ve=(0,X.A)(he,[["render",Z],["__scopeId","data-v-52168252"]]);var me=ve;function be(e,t,n,s,l,i){const a=(0,o.g2)("Loading");return(0,o.uX)(),(0,o.CE)(o.FK,null,[n.loading?((0,o.uX)(),(0,o.Wv)(a,{key:0})):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"scene row name",onClick:t[0]||(t[0]=(...e)=>i.onSelect&&i.onSelect(...e))},(0,h.v_)(n.scene.name||`[Scene ${n.scene.id}]`),1)],64)}var ke={name:"Light",emits:["select"],props:{scene:{type:Object,default:()=>{}},group:{type:Object,default:()=>{}},loading:{type:Boolean,default:!1}},methods:{onSelect(){if(this.loading)return!1;this.$emit("select")}}};const Ce=(0,X.A)(ke,[["render",be]]);var ye=Ce;const Le={class:"animation-container"},fe={class:"animation-header"},we={class:"row"},_e={class:"col-9"},Se={class:"row"},Xe={class:"col-9"},$e={class:"animation"},Ae={key:0,class:"row"},Oe={class:"col-9"},je={key:1,class:"row"},Ee={class:"col-9"},Ge={key:2,class:"row"},Ie={class:"col-9"},xe={key:3,class:"row"},Be={class:"col-9"},Fe={key:4,class:"row"},Te={class:"col-9"},Re={key:5,class:"row"},Me={class:"col-9"},Qe={class:"row"},Ne={class:"col-9"},Ue=["value"],Ve={class:"row"},De={class:"col-9"},Pe=["value"],He={class:"lights"},ze={class:"row"},We=["checked"],Ye=["onUpdate:modelValue","onInput"];function Ke(e,t,n,s,l,i){const a=(0,o.g2)("Loading"),r=(0,o.g2)("ToggleSwitch"),c=(0,o.g2)("RangeSlider"),u=(0,o.g2)("Slider");return(0,o.uX)(),(0,o.CE)("div",{class:"controls animation-controls",onClick:t[10]||(t[10]=e=>e.stopPropagation())},[n.loading?((0,o.uX)(),(0,o.Wv)(a,{key:0})):(0,o.Q3)("",!0),(0,o.Lk)("div",Le,[(0,o.Lk)("div",fe,[(0,o.Lk)("div",we,[t[11]||(t[11]=(0,o.Lk)("div",{class:"col-3"}," Run Animation ",-1)),(0,o.Lk)("div",_e,[(0,o.bF)(r,{value:i.animationRunning,onInput:i.toggleAnimation},null,8,["value","onInput"])])]),(0,o.Lk)("div",Se,[t[13]||(t[13]=(0,o.Lk)("div",{class:"col-3"},"Animation",-1)),(0,o.Lk)("div",Xe,[(0,o.Lk)("label",null,[(0,o.Lk)("select",{class:"selector",onClick:t[0]||(t[0]=e=>l.selectedAnimation=e.target.value)},t[12]||(t[12]=[(0,o.Lk)("option",{value:"color_transition"},"Color transition",-1),(0,o.Lk)("option",{value:"blink"},"Blink",-1)]))])])])]),(0,o.Lk)("div",$e,["color_transition"===l.selectedAnimation?((0,o.uX)(),(0,o.CE)("div",Ae,[t[14]||(t[14]=(0,o.Lk)("div",{class:"col-3"}," Hue range ",-1)),(0,o.Lk)("div",Oe,[(0,o.bF)(c,{range:n.colorConverter.ranges.hue,disabled:n.loading,value:l.animations.color_transition.hue_range,onMouseup:t[1]||(t[1]=e=>l.animations.color_transition.hue_range=e.target.value)},null,8,["range","disabled","value"])])])):(0,o.Q3)("",!0),"color_transition"===l.selectedAnimation?((0,o.uX)(),(0,o.CE)("div",je,[t[15]||(t[15]=(0,o.Lk)("div",{class:"col-3"}," Sat range ",-1)),(0,o.Lk)("div",Ee,[(0,o.bF)(c,{range:n.colorConverter.ranges.sat,disabled:n.loading,value:l.animations.color_transition.sat_range,onMouseup:t[2]||(t[2]=e=>l.animations.color_transition.sat_range=e.target.value)},null,8,["range","disabled","value"])])])):(0,o.Q3)("",!0),"color_transition"===l.selectedAnimation?((0,o.uX)(),(0,o.CE)("div",Ge,[t[16]||(t[16]=(0,o.Lk)("div",{class:"col-3"}," Bri range ",-1)),(0,o.Lk)("div",Ie,[(0,o.bF)(c,{range:n.colorConverter.ranges.sat,disabled:n.loading,value:l.animations.color_transition.bri_range,onMouseup:t[3]||(t[3]=e=>l.animations.color_transition.bri_range=e.target.value)},null,8,["range","disabled","value"])])])):(0,o.Q3)("",!0),"color_transition"===l.selectedAnimation?((0,o.uX)(),(0,o.CE)("div",xe,[t[17]||(t[17]=(0,o.Lk)("div",{class:"col-3"}," Hue step ",-1)),(0,o.Lk)("div",Be,[(0,o.bF)(u,{range:n.colorConverter.ranges.hue,disabled:n.loading,value:l.animations.color_transition.hue_step,onChange:t[4]||(t[4]=e=>l.animations.color_transition.hue_step=parseFloat(e.target.value))},null,8,["range","disabled","value"])])])):(0,o.Q3)("",!0),"color_transition"===l.selectedAnimation?((0,o.uX)(),(0,o.CE)("div",Fe,[t[18]||(t[18]=(0,o.Lk)("div",{class:"col-3"}," Sat step ",-1)),(0,o.Lk)("div",Te,[(0,o.bF)(u,{range:n.colorConverter.ranges.sat,disabled:n.loading,value:l.animations.color_transition.sat_step,onChange:t[5]||(t[5]=e=>l.animations.color_transition.sat_step=parseFloat(e.target.value))},null,8,["range","disabled","value"])])])):(0,o.Q3)("",!0),"color_transition"===l.selectedAnimation?((0,o.uX)(),(0,o.CE)("div",Re,[t[19]||(t[19]=(0,o.Lk)("div",{class:"col-3"}," Bri step ",-1)),(0,o.Lk)("div",Me,[(0,o.bF)(u,{range:n.colorConverter.ranges.bri,disabled:n.loading,value:l.animations.color_transition.bri_step,onChange:t[6]||(t[6]=e=>l.animations.color_transition.bri_step=parseFloat(e.target.value))},null,8,["range","disabled","value"])])])):(0,o.Q3)("",!0),(0,o.Lk)("div",Qe,[t[20]||(t[20]=(0,o.Lk)("div",{class:"col-3"}," Refresh seconds ",-1)),(0,o.Lk)("div",Ne,[(0,o.Lk)("label",null,[(0,o.Lk)("input",{type:"number",value:l.animations[l.selectedAnimation].transition_seconds,step:"0.1",onInput:t[7]||(t[7]=e=>l.animations[l.selectedAnimation].transition_seconds=parseFloat(e.target.value))},null,40,Ue)])])]),(0,o.Lk)("div",Ve,[t[21]||(t[21]=(0,o.Lk)("div",{class:"col-3"}," Duration (seconds) ",-1)),(0,o.Lk)("div",De,[(0,o.Lk)("label",null,[(0,o.Lk)("input",{type:"number",value:l.animations[l.selectedAnimation].duration,step:"5",onInput:t[8]||(t[8]=e=>l.animations[l.selectedAnimation].duration=e.target.value?.length?parseFloat(e.target.value):null)},null,40,Pe)])])])])]),(0,o.Lk)("div",He,[(0,o.Lk)("div",ze,[(0,o.Lk)("label",null,[(0,o.Lk)("input",{type:"checkbox",checked:Object.keys(n.lights).length===Object.values(l.selectedLights).filter((e=>e)).length,onClick:t[9]||(t[9]=(...e)=>i.toggleSelectAll&&i.toggleSelectAll(...e))},null,8,We),t[22]||(t[22]=(0,o.eW)(" Select all lights "))])]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.lights,((e,t)=>((0,o.uX)(),(0,o.CE)("div",{class:"row",key:t},[(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":e=>l.selectedLights[t]=e,onInput:e=>l.selectedLights[t]=!l.selectedLights[t]},null,40,Ye),[[ee.lH,l.selectedLights[t]]]),(0,o.eW)(" "+(0,h.v_)(e.name),1)])])))),128))])])}const qe={class:"range-wrapper"},Je=["value","min","max","step","disabled"];function Ze(e,t,n,s,l,i){return(0,o.uX)(),(0,o.CE)("div",qe,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.value,((e,s)=>((0,o.uX)(),(0,o.CE)("input",{class:"slider",type:"range",value:e,min:n.range[0],max:n.range[1],step:n.step,disabled:n.disabled,ref_for:!0,ref:"ranges",onInput:t[0]||(t[0]=(0,ee.D$)(((...e)=>i.onUpdate&&i.onUpdate(...e)),["stop"])),onChange:t[1]||(t[1]=(0,ee.D$)(((...e)=>i.onUpdate&&i.onUpdate(...e)),["stop"])),onMouseup:t[2]||(t[2]=(0,ee.D$)(((...e)=>i.onUpdate&&i.onUpdate(...e)),["stop"])),onMousedown:t[3]||(t[3]=(0,ee.D$)(((...e)=>i.onUpdate&&i.onUpdate(...e)),["stop"])),onTouchstart:t[4]||(t[4]=(0,ee.D$)(((...e)=>i.onUpdate&&i.onUpdate(...e)),["stop"])),onTouchend:t[5]||(t[5]=(0,ee.D$)(((...e)=>i.onUpdate&&i.onUpdate(...e)),["stop"])),onKeyup:t[6]||(t[6]=(0,ee.D$)(((...e)=>i.onUpdate&&i.onUpdate(...e)),["stop"])),onKeydown:t[7]||(t[7]=(0,ee.D$)(((...e)=>i.onUpdate&&i.onUpdate(...e)),["stop"])),key:s},null,40,Je)))),128))])}var et={name:"RangeSlider",emits:["input","change","mouseup","mousedown","touchstart","touchend","keyup","keydown"],props:{disabled:{type:Boolean,default:!1},range:{type:Array,default:()=>[0,100]},step:{type:Number,default:1},value:{type:Array,default:()=>[0,100]}},methods:{onUpdate(e){this.$emit(e.type,{...e,target:{...e.target,value:this.$refs.ranges.map((e=>parseFloat(e.value))).sort()}})}}};const tt=(0,X.A)(et,[["render",Ze],["__scopeId","data-v-981c5de0"]]);var nt=tt,ot={name:"Animate",mixins:[u.A],components:{ToggleSwitch:O.A,Slider:ce.A,RangeSlider:nt,Loading:ue.A},emits:["start","stop"],props:{lights:{type:Object},group:{type:Object},loading:{type:Boolean,default:!1},colorConverter:{type:Object,default:()=>new j.o},runningAnimations:{type:Object,default:()=>{}}},data(){return{selectedAnimation:"color_transition",animation:{},selectedLights:Object.keys(this.lights).reduce(((e,t)=>(e[t]=!0,e)),{}),animations:{color_transition:{hue_range:this.colorConverter.ranges.hue,sat_range:[parseInt((this.colorConverter.ranges.sat[1]-this.colorConverter.ranges.sat[0])/2),this.colorConverter.ranges.sat[1]],bri_range:[parseInt(.75*(this.colorConverter.ranges.bri[1]-this.colorConverter.ranges.bri[0])),this.colorConverter.ranges.bri[1]],hue_step:parseInt((this.colorConverter.ranges.hue[1]-this.colorConverter.ranges.hue[0])/25),sat_step:parseInt((this.colorConverter.ranges.sat[1]-this.colorConverter.ranges.sat[0])/50),bri_step:parseInt((this.colorConverter.ranges.bri[1]-this.colorConverter.ranges.bri[0])/50),transition_seconds:1,duration:null},blink:{transition_seconds:1,duration:null}}}},computed:{animationRunning(){return Object.keys(this.runningAnimations).length>0}},methods:{toggleSelectAll(){const e=Object.values(this.selectedLights).filter((e=>e)).length<Object.keys(this.lights).length;Object.keys(this.lights).forEach((t=>{this.selectedLights[t]=e}))},toggleAnimation(){const e=this.animationRunning?"stop":"start",t=Object.entries(this.selectedLights).filter((e=>e[1])).map((e=>e[0]));t.length?this.$emit(e,{lights:t,animation:{...this.animations[this.selectedAnimation],animation:this.selectedAnimation}}):this.notifyWarning("No lights have been selected")}}};const st=(0,X.A)(ot,[["render",Ke],["__scopeId","data-v-44c83513"]]);var lt=st,it={name:"Group",emits:["close","group-toggle","light-toggle","set-light","select-scene","start-animation","stop-animation"],components:{Animate:lt,ToggleSwitch:O.A,MenuPanel:A,Light:me,Scene:ye,Controls:pe},props:{lights:{type:Object},group:{type:Object},scenes:{type:Object},title:{type:String,default:"Lights"},animations:{type:Object,default:()=>{}},colorConverter:{type:Object,default:()=>new j.o},withBackButton:{type:Boolean,default:!0}},data(){return{selectedLight:null,selectedScene:null,selectedView:"lights"}},computed:{anyLightsOn(){return null!=this.group?.state?.any_on?this.group.state.any_on:Object.values(this.lights).some((e=>e.state.on))},lightsSorted(){return this.lights?Object.entries(this.lights).sort(((e,t)=>e[1].name.localeCompare(t[1].name))).map((([e,t])=>({...t,id:e}))):[]},scenesSorted(){return this.scenes?Object.entries(this.scenes).sort(((e,t)=>e[1].name.localeCompare(t[1].name))).map((([e,t])=>({...t,id:e}))):[]},groupName(){return this.group?.name?this.group.name:null!=this.group?.id?`[Group ${this.group.id}]`:this.title}},methods:{close(e){e.stopPropagation(),this.$emit("close")},onSceneSelected(e){this.selectedScene=e,this.$emit("select-scene",e)}}};const at=(0,X.A)(it,[["render",Y],["__scopeId","data-v-39fd4c80"]]);var rt=at,ct={mixins:[u.A,p],components:{Group:rt,Groups:I},emits:["group-toggle","light-changed","light-toggle","refresh","select-scene","set-group","set-light","start-animation","stop-animation"],props:{lights:{type:Object},groups:{type:Object},scenes:{type:Object},animations:{type:Object},colorConverter:{type:Object,default:()=>new j.o},loadingLights:{type:Object,default:()=>{}},loadingGroups:{type:Object,default:()=>{}},initialGroup:{type:[Number,String]}},data(){return{selectedGroup:null,initialized:!1}},computed:{displayedLights(){const e=this.selectedGroup||this.initialGroup;return null==e?this.lights:this.groups[e].lights.reduce(((e,t)=>(e[t]=this.lights[t],e)),{})},groupsByLight(){return this.groups?Object.entries(this.groups).reduce(((e,[t,n])=>(n.lights.forEach((o=>{e[o]||(e[o]={}),e[o][t]=n})),e)),{}):{}},ungroupedLights(){return Object.keys(this.lights||{}).filter((e=>!this.groupsByLight[e])).reduce(((e,t)=>(e[t]=this.lights[t],e)),{})},scenesByGroup(){if(!this.scenes)return{};const e=this;return Object.entries(this.scenes).reduce(((t,[n,o])=>(o.lights.forEach((s=>{if(!e.groupsByLight[s])return t[-1]||(t[-1]={}),void(t[-1][n]=o);Object.keys(e.groupsByLight[s]).forEach((e=>{t[e]||(t[e]={}),t[e][n]=o}))})),t)),{})},animationsByGroup(){const e=this,t=Object.entries(this.animations?.groups||{}).reduce(((e,[t,n])=>(e[t]={},n&&(e[t][null]=n),e)),{});return{...t,...Object.entries(this.animations?.lights||{}).reduce(((t,[n,o])=>{const s=Object.values(e.groupsByLight[n]||{})?.[0];return s?o&&null!=s.id&&(t[s.id]||(t[s.id]={}),t[s.id][n]=o):(t[-1]||(t[-1]={}),t[-1][n]=o),t}),{})}}},methods:{initSelectedGroup(){const e=this,t=this.$watch((()=>e.initialGroup),(n=>{e.initialized||(e.initialized=!0,t(),null==e.selectedGroup&&null!=n&&(e.selectedGroup=e.initialGroup))}))},refresh(){this.$emit("refresh")},onLightChange(e){if(e.plugin_name!==this.pluginName)return;if(!this.lights[e.light_id])return void this.refresh();const t={...e},n=t.light_id;delete t.light_id,delete t.type,delete t.plugin_name,this.$emit("light-changed",{id:n,state:t})},onAnimationChange(e){e.plugin_name===this.pluginName&&this.refresh()}},mounted(){this.subscribe(this.onLightChange,"on-light-change","platypush.message.event.light.LightStatusChangeEvent"),this.subscribe(this.onAnimationChange,"on-animation-change","platypush.message.event.light.LightAnimationStartedEvent","platypush.message.event.light.LightAnimationStoppedEvent"),this.initSelectedGroup()},unmounted(){this.unsubscribe("on-light-change"),this.unsubscribe("on-animation-change")}};const ut=(0,X.A)(ct,[["render",c],["__scopeId","data-v-0c531b7c"]]);var gt=ut}}]);
//# sourceMappingURL=8297.88c144ec.js.map