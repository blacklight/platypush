"use strict";(self["webpackChunkplatypush"]=self["webpackChunkplatypush"]||[]).push([[2981],{2981:function(a,e,t){t.r(e),t.d(e,{default:function(){return M}});var s=t(641),r=t(33);const i=a=>((0,s.Qi)("data-v-1334f746"),a=a(),(0,s.jt)(),a),n={class:"camera"},c={class:"camera-selector"},l={class:"left"},o={key:0,selected:"",disabled:""},d=["value","textContent"],u={class:"right"},m=["disabled"],p=i((()=>(0,s.Lk)("i",{class:"fas fa-sync-alt",title:"Refresh cameras"},null,-1))),g=[p],f={class:"camera-container"},h={class:"frame-container",ref:"frameContainer"},k={key:0,class:"no-frame"},C={class:"frame",ref:"frame",alt:"",src:""},b={class:"controls"},v={class:"left"},y=["disabled"],L=i((()=>(0,s.Lk)("i",{class:"fa fa-play",title:"Start video"},null,-1))),S=[L],_=["disabled"],w=i((()=>(0,s.Lk)("i",{class:"fa fa-stop",title:"Stop video"},null,-1))),E=[w],X=["disabled"],A=i((()=>(0,s.Lk)("i",{class:"fas fa-camera",title:"Take a picture"},null,-1))),Q=[A],$={class:"right"},x=["disabled"],F=i((()=>(0,s.Lk)("i",{class:"fas fa-retweet",title:"Flip camera"},null,-1))),j=[F],I=["disabled"],T=i((()=>(0,s.Lk)("i",{class:"fa fa-volume-mute",title:"Start audio"},null,-1))),W=[T],q=["disabled"],O=i((()=>(0,s.Lk)("i",{class:"fa fa-volume-up",title:"Stop audio"},null,-1))),D=[O],K={class:"sound-container"},N={key:0,autoplay:"",preload:"none",ref:"player"},R=["src"];function Y(a,e,t,i,p,L){const w=(0,s.g2)("Loading");return(0,s.uX)(),(0,s.CE)("div",n,[p.loading?((0,s.uX)(),(0,s.Wv)(w,{key:0})):(0,s.Q3)("",!0),(0,s.Lk)("div",c,[(0,s.Lk)("div",l,[(0,s.Lk)("label",null,[(0,s.Lk)("select",{ref:"cameraSelector",onChange:e[0]||(e[0]=(...a)=>L.onCameraSelected&&L.onCameraSelected(...a))},[Object.keys(p.cameras).length?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("option",o,"-- No cameras available")),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Object.keys(p.cameras),(a=>((0,s.uX)(),(0,s.CE)("option",{key:a,value:a,textContent:(0,r.v_)(a)},null,8,d)))),128))],544)])]),(0,s.Lk)("div",u,[(0,s.Lk)("button",{type:"button",onClick:e[1]||(e[1]=(...a)=>L.updateCameraStatus&&L.updateCameraStatus(...a)),disabled:p.loading},g,8,m)])]),(0,s.Lk)("div",f,[(0,s.Lk)("div",h,[p.streaming||p.capturing||p.captured?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",k,"The camera is not active")),(0,s.Lk)("img",C,null,512)],512),(0,s.Lk)("div",b,[(0,s.Lk)("div",v,[p.streaming?((0,s.uX)(),(0,s.CE)("button",{key:1,type:"button",onClick:e[3]||(e[3]=(...a)=>L.stopStreaming&&L.stopStreaming(...a)),disabled:p.capturing||p.loading},E,8,_)):((0,s.uX)(),(0,s.CE)("button",{key:0,type:"button",onClick:e[2]||(e[2]=(...a)=>L.startStreaming&&L.startStreaming(...a)),disabled:p.capturing||p.loading},S,8,y)),(0,s.Lk)("button",{type:"button",onClick:e[4]||(e[4]=(...a)=>L.capture&&L.capture(...a)),disabled:p.streaming||p.capturing||p.loading},Q,8,X)]),(0,s.Lk)("div",$,[(0,s.Lk)("button",{type:"button",onClick:e[5]||(e[5]=(...a)=>L.flipCamera&&L.flipCamera(...a)),disabled:p.loading},j,8,x),p.recording?((0,s.uX)(),(0,s.CE)("button",{key:1,type:"button",onClick:e[7]||(e[7]=a=>p.recording=!1),disabled:p.loading},D,8,q)):((0,s.uX)(),(0,s.CE)("button",{key:0,type:"button",onClick:e[6]||(e[6]=a=>p.recording=!0),disabled:p.loading},W,8,I))])])]),(0,s.Lk)("div",K,[p.recording?((0,s.uX)(),(0,s.CE)("audio",N,[(0,s.Lk)("source",{src:p.cameras[p.selectedCamera].audio_url,type:"audio/x-wav;codec=pcm"},null,8,R),(0,s.eW)(" Your browser does not support audio elements ")],512)):(0,s.Q3)("",!0)])])}var z=t(2002),B=t(9828),G={name:"CameraAndroidIpcam",components:{Loading:B.A},mixins:[z.A],data(){return{loading:!1,streaming:!1,capturing:!1,recording:!1,captured:!1,cameras:{},selectedCamera:void 0}},computed:{configuredCameras(){const a=this.$root.config["camera.android.ipcam"];let e=a.cameras||[];if(e.length)e=e.reduce(((a,e)=>{const t=e.name||e.host;return a[t]=e,a}),{});else{const t=a.name||a.host;e[t]={name:t,host:a.host,port:a.port,username:a.username,password:a.password,timeout:a.timeout,ssl:a.ssl}}return e}},methods:{startStreaming(){if(this.streaming)return;const a=this.cameras[this.selectedCamera];this.streaming=!0,this.capturing=!1,this.captured=!1,this.$refs.frame.setAttribute("src",a.stream_url)},stopStreaming(){this.streaming&&(this.streaming=!1,this.capturing=!1,this.$refs.frame.removeAttribute("src"))},capture(){if(this.capturing)return;const a=this.cameras[this.selectedCamera];this.streaming=!1,this.capturing=!0,this.captured=!0,this.$refs.frame.setAttribute("src",a.image_url+"?t="+(new Date).getTime())},onFrameLoaded(){this.capturing&&(this.capturing=!1)},onCameraSelected(a){this.selectedCamera=a.target.value},async flipCamera(){const a=this.cameras[this.selectedCamera];this.loading=!0;try{const e=!a.ffc;await this.request("camera.android.ipcam.set_front_facing_camera",{activate:e,camera:a.name}),this.cameras[this.selectedCamera].ffc=e}finally{this.loading=!1}},async updateCameraStatus(){this.loading=!0;try{const a=await this.request("camera.android.ipcam.status");this.cameras=a.reduce(((a,e)=>{for(const t of["stream_url","image_url","audio_url"])e[t].startsWith("https://")&&(e[t]=e[t].replace("https://","http://")),e.name in this.configuredCameras&&this.configuredCameras[e.name].username&&(e[t]="http://"+this.config.cameras[e.name].username+":"+this.config.cameras[e.name].password+"@"+e[t].substr(7));return a[e.name]=e,a}),{}),a.length&&(this.selectedCamera=a[0].name)}finally{this.loading=!1}}},mounted(){this.$refs.frame.addEventListener("load",this.onFrameLoaded),this.updateCameraStatus()}},H=t(6262);const J=(0,H.A)(G,[["render",Y],["__scopeId","data-v-1334f746"]]);var M=J}}]);
//# sourceMappingURL=2981.89707936.js.map