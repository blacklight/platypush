"use strict";(self["webpackChunkplatypush"]=self["webpackChunkplatypush"]||[]).push([[1019],{1080:function(e,t,n){n.r(t),n.d(t,{default:function(){return Gn}});var a=n(6252),i=n(3577),s=n(9963);const o=e=>((0,a.dD)("data-v-74ca2010"),e=e(),(0,a.Cn)(),e),r={class:"actions-list"},l={key:0,class:"indent-spacers"},d=o((()=>(0,a._)("div",{class:"left side"},null,-1))),c=o((()=>(0,a._)("div",{class:"right side"},null,-1))),u=[d,c],p={key:0,class:"row item action add-action-container"},h={key:1,class:"add-buttons-expander"},g={key:2,class:"extra-add-buttons fade-in"},m={key:0,class:"row item action add-return-container"},v={key:1,class:"row item action add-if-container"},y={key:2,class:"row item action add-else-container"},f={key:3,class:"row item action add-for-container"},w={key:4,class:"row item action add-while-container"},b={key:5,class:"row item action add-break-container"},D={key:6,class:"row item action add-continue-container"},k={key:7,class:"row item action add-set-container"};function x(e,t,n,o,d,c){const x=(0,a.up)("ConditionBlock"),C=(0,a.up)("LoopBlock"),_=(0,a.up)("SetVariablesTile"),$=(0,a.up)("BreakTile"),B=(0,a.up)("ContinueTile"),E=(0,a.up)("ReturnTile"),O=(0,a.up)("ActionsListItem"),T=(0,a.up)("ActionTile"),I=(0,a.up)("ListItem"),S=(0,a.up)("AddTile");return(0,a.wg)(),(0,a.iD)("div",r,[n.indent>0?((0,a.wg)(),(0,a.iD)("div",l,[(0,a._)("div",{class:"indent-spacer",onClick:t[0]||(t[0]=(...e)=>c.onCollapse&&c.onCollapse(...e))},u)])):(0,a.kq)("",!0),(0,a._)("div",{class:(0,i.C_)(["actions",{dragging:c.isDragging}])},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(c.visibleActions,((i,s)=>((0,a.wg)(),(0,a.iD)("div",{class:"row item action",key:s},[c.conditions[s]?((0,a.wg)(),(0,a.j4)(x,(0,a.dG)({key:0,ref_for:!0},c.componentsData[s].props,(0,a.mx)(c.componentsData[s].on),{collapsed:c.collapsedBlocks[s],dragging:c.isDragging,onAddElse:c.addElse}),null,16,["collapsed","dragging","onAddElse"])):c.elses[s]?((0,a.wg)(),(0,a.j4)(x,(0,a.dG)({key:1,ref_for:!0},c.componentsData[s].props,(0,a.mx)(c.componentsData[s].on),{collapsed:c.collapsedBlocks[s],dragging:c.isDragging,"is-else":!0}),null,16,["collapsed","dragging"])):c.loops[s]?((0,a.wg)(),(0,a.j4)(C,(0,a.dG)({key:2,ref_for:!0},c.componentsData[s].props,(0,a.mx)(c.componentsData[s].on),{collapsed:c.collapsedBlocks[s],dragging:c.isDragging}),null,16,["collapsed","dragging"])):c.sets[s]?((0,a.wg)(),(0,a.j4)(_,(0,a.dG)({key:3,ref_for:!0},c.componentsData[s].props,(0,a.mx)(c.componentsData[s].on),{collapsed:c.collapsedBlocks[s],dragging:c.isDragging}),null,16,["collapsed","dragging"])):e.isBreak(i)?((0,a.wg)(),(0,a.j4)($,{key:4,active:c.isDragging,readOnly:n.readOnly,spacerTop:c.componentsData[s].props.spacerTop,onDelete:e=>c.deleteAction(s)},null,8,["active","readOnly","spacerTop","onDelete"])):e.isContinue(i)?((0,a.wg)(),(0,a.j4)(B,{key:5,active:c.isDragging,readOnly:n.readOnly,spacerTop:c.componentsData[s].props.spacerTop,onDelete:e=>c.deleteAction(s)},null,8,["active","readOnly","spacerTop","onDelete"])):e.isReturn(i)?((0,a.wg)(),(0,a.j4)(E,(0,a.dG)({key:6,ref_for:!0},c.componentsData[s].props,{value:c.returnValue,onChange:t[1]||(t[1]=e=>c.editReturn(e)),onDelete:e=>c.deleteAction(s)}),null,16,["value","onDelete"])):e.isAction(i)&&!n.collapsed?((0,a.wg)(),(0,a.j4)(O,(0,a.dG)({key:7,ref_for:!0},c.componentsData[s].props,(0,a.mx)(c.componentsData[s].on)),null,16)):(0,a.kq)("",!0)])))),128)),c.visibleAddButtons.action?((0,a.wg)(),(0,a.iD)("div",p,[(0,a.Wm)(I,{active:c.isDragging,readOnly:!1,spacerBottom:!1,spacerTop:!d.newValue.length,value:d.newAction,onDrop:t[2]||(t[2]=e=>c.onDrop(0,e))},{default:(0,a.w5)((()=>[(0,a.Wm)(T,{value:d.newAction,context:c.contexts[Object.keys(c.contexts).length-1],draggable:!1,onInput:c.addAction},null,8,["value","context","onInput"])])),_:1},8,["active","spacerTop","value"])])):(0,a.kq)("",!0),c.showAddButtonsExpander?((0,a.wg)(),(0,a.iD)("div",h,[(0,a._)("button",{onClick:t[3]||(t[3]=(0,s.iM)((e=>d.collapseAddButtons=!d.collapseAddButtons),["stop","prevent"]))},[(0,a._)("i",{class:(0,i.C_)(["fas",d.collapseAddButtons?"fa-angle-down":"fa-angle-up"])},null,2)])])):(0,a.kq)("",!0),c.showAddButtons?((0,a.wg)(),(0,a.iD)("div",g,[c.visibleAddButtons.return?((0,a.wg)(),(0,a.iD)("div",m,[(0,a.Wm)(S,{icon:"fas fa-angle-right",title:"Add Return",onClick:c.addReturn},null,8,["onClick"])])):(0,a.kq)("",!0),c.visibleAddButtons.condition?((0,a.wg)(),(0,a.iD)("div",v,[(0,a.Wm)(S,{icon:"fas fa-question",title:"Add Condition",onClick:c.addCondition},null,8,["onClick"])])):(0,a.kq)("",!0),c.visibleAddButtons.else?((0,a.wg)(),(0,a.iD)("div",y,[(0,a.Wm)(S,{icon:"fas fa-question",title:"Add Else",onClick:t[4]||(t[4]=t=>e.$emit("add-else"))})])):(0,a.kq)("",!0),c.visibleAddButtons.for?((0,a.wg)(),(0,a.iD)("div",f,[(0,a.Wm)(S,{icon:"fas fa-arrow-rotate-left",title:"Add For Loop",onClick:c.addForLoop},null,8,["onClick"])])):(0,a.kq)("",!0),c.visibleAddButtons.while?((0,a.wg)(),(0,a.iD)("div",w,[(0,a.Wm)(S,{icon:"fas fa-arrow-rotate-left",title:"Add While Loop",onClick:c.addWhileLoop},null,8,["onClick"])])):(0,a.kq)("",!0),c.visibleAddButtons.break?((0,a.wg)(),(0,a.iD)("div",b,[(0,a.Wm)(S,{icon:"fas fa-hand",title:"Add Break",onClick:c.addBreak},null,8,["onClick"])])):(0,a.kq)("",!0),c.visibleAddButtons.continue?((0,a.wg)(),(0,a.iD)("div",D,[(0,a.Wm)(S,{icon:"fas fa-rotate",title:"Add Continue",onClick:c.addContinue},null,8,["onClick"])])):(0,a.kq)("",!0),c.visibleAddButtons.set?((0,a.wg)(),(0,a.iD)("div",k,[(0,a.Wm)(S,{icon:"fas fa-square-root-variable",title:"Set Variables",onClick:c.addSet},null,8,["onClick"])])):(0,a.kq)("",!0)])):(0,a.kq)("",!0)],2)])}n(560);function C(e,t,n,i,o,r){const l=(0,a.up)("ActionTile"),d=(0,a.up)("ListItem");return(0,a.wg)(),(0,a.j4)(d,(0,a.dG)({class:"action",active:n.active,dragging:o.dragging,"spacer-bottom":n.spacerBottom,"spacer-top":n.spacerTop,value:n.value},(0,a.mx)(r.componentsData.on)),{default:(0,a.w5)((()=>[(0,a.Wm)(l,(0,a.dG)({value:n.value,context:n.context,draggable:!n.readOnly,"read-only":n.readOnly,"with-delete":!n.readOnly},(0,a.mx)(r.componentsData.on),{onContextmenu:t[0]||(t[0]=t=>e.$emit("contextmenu",t)),onDrag:(0,s.iM)(r.onDragStart,["stop"]),onDelete:t[1]||(t[1]=t=>e.$emit("delete",t))}),null,16,["value","context","draggable","read-only","with-delete","onDrag"])])),_:1},16,["active","dragging","spacer-bottom","spacer-top","value"])}const _=e=>((0,a.dD)("data-v-49487886"),e=e(),(0,a.Cn)(),e),$={class:"action-tile-container"},B=_((()=>(0,a._)("i",{class:"icon fas fa-xmark"},null,-1))),E=[B],O={key:1,class:"action-name"},T={class:"icon"},I={class:"name"},S={key:2,class:"new-action"},V=_((()=>(0,a._)("i",{class:"icon fas fa-plus"},null,-1))),A={key:3,class:"action-args"},L={class:"arg-name"},j={class:"arg-value"},q={class:"action-editor-container"};function M(e,t,n,o,r,l){const d=(0,a.up)("ExtensionIcon"),c=(0,a.up)("Draggable"),u=(0,a.up)("Droppable"),p=(0,a.up)("ActionEditor"),h=(0,a.up)("Modal");return(0,a.wg)(),(0,a.iD)("div",$,[(0,a._)("div",{class:(0,i.C_)(["action-tile",{new:l.isNew}]),ref:"tile",onClick:t[1]||(t[1]=(...t)=>e.$refs.actionEditor.show&&e.$refs.actionEditor.show(...t))},[n.withDelete&&!n.readOnly?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"action-delete",title:"Remove",onClick:t[0]||(t[0]=(0,s.iM)((t=>e.$emit("delete")),["stop"]))},E)):(0,a.kq)("",!0),l.name?.length?((0,a.wg)(),(0,a.iD)("div",O,[(0,a._)("span",T,[(0,a.Wm)(d,{name:l.name.split(".")[0],size:"1.5em"},null,8,["name"])]),(0,a._)("span",I,(0,i.zw)(l.name),1)])):((0,a.wg)(),(0,a.iD)("div",S,[V,(0,a.Uk)("  Add Action ")])),Object.keys(n.value.args||{})?.length?((0,a.wg)(),(0,a.iD)("div",A,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.value.args,((e,t)=>((0,a.wg)(),(0,a.iD)("div",{class:"arg",key:t},[(0,a._)("div",L,(0,i.zw)(t),1),(0,a._)("div",j,(0,i.zw)(e),1)])))),128))])):(0,a.kq)("",!0)],2),n.draggable?((0,a.wg)(),(0,a.j4)(c,{key:0,element:r.tile,disabled:n.readOnly,value:n.value,onDrag:t[2]||(t[2]=t=>e.$emit("drag",t)),onDragend:t[3]||(t[3]=t=>e.$emit("dragend",t)),onDrop:t[4]||(t[4]=t=>e.$emit("drop",t))},null,8,["element","disabled","value"])):(0,a.kq)("",!0),n.draggable?((0,a.wg)(),(0,a.j4)(u,{key:1,element:r.tile,disabled:n.readOnly,onDragenter:t[5]||(t[5]=t=>e.$emit("dragenter",t)),onDragleave:t[6]||(t[6]=t=>e.$emit("dragleave",t)),onDragover:t[7]||(t[7]=t=>e.$emit("dragover",t)),onDrop:t[8]||(t[8]=t=>e.$emit("drop",t))},null,8,["element","disabled"])):(0,a.kq)("",!0),(0,a._)("div",q,[(0,a.Wm)(h,{ref:"actionEditor",title:"Edit Action"},{default:(0,a.w5)((()=>[this.$refs.actionEditor?.$data?.isVisible?((0,a.wg)(),(0,a.j4)(p,{key:0,value:n.value,context:n.context,"with-save":!n.readOnly,onInput:l.onInput},null,8,["value","context","with-save","onInput"])):(0,a.kq)("",!0)])),_:1},512)])])}var W=n(9502);const Z=["innerHTML"];function N(e,t,n,s,o,r){return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["dragged",{hidden:!r.draggingVisible}]),style:(0,i.j5)({top:`${o.top}px`,left:`${o.left}px`})},[r.draggingVisible?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"content",innerHTML:n.element?.outerHTML||"..."},null,8,Z)):(0,a.kq)("",!0)],6)}var H={emits:["contextmenu","drag","dragend","drop"],props:{disabled:{type:Boolean,default:!1},element:{type:Object},touchDragStartThreshold:{type:Number,default:500},touchDragMoveCancelDistance:{type:Number,default:10},value:{type:[Object,String,Number,Boolean,Array],default:()=>({})}},data(){return{dragging:!1,draggingHTML:null,eventsHandlers:{contextmenu:this.onContextMenu,drag:this.onDrag,dragend:this.onDragEnd,dragstart:this.onDragStart,drop:this.onDragEnd,touchcancel:this.onDragEnd,touchend:this.onTouchEnd,touchmove:this.onTouchMove,touchstart:this.onTouchStart},initialCursorOffset:null,left:0,top:0,touchDragStartTimer:null,touchScrollDirection:[0,0],touchScrollSpeed:10,touchScrollTimer:null,touchStart:null,touchOverElement:null}},computed:{draggingVisible(){return this.dragging&&this.touchStart},shouldScroll(){return this.touchScrollDirection[0]||this.touchScrollDirection[1]}},methods:{onContextMenu(e){!this.disabled&&this.touchStart?(e.preventDefault(),e.stopPropagation(),this.onDragStart(e)):this.$emit("contextmenu",e)},onDragStart(e){this.disabled||(this.dragging=!0,this.draggingHTML=this.$slots.default?.()?.el?.outerHTML,e.value=this.value,e.dataTransfer&&(e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("application/json",JSON.stringify(this.value))),this.cancelTouchDragStart(),this.$emit("drag",e))},onDragEnd(e){this.disabled||(this.reset(),this.$emit("dragend",e))},onTouchStart(e){if(this.disabled)return;const t=e.touches?.[0];t&&(this.touchStart=[t.clientX,t.clientY],this.cancelTouchDragStart(),this.touchDragStartTimer=setTimeout((()=>{this.onDragStart(e)}),this.touchDragStartThreshold))},onTouchMove(e){if(this.disabled)return;const t=e.touches?.[0];if(!t||!this.touchStart)return;if(this.touchDragStartTimer){const n=Math.hypot(t.clientX-this.touchStart[0],t.clientY-this.touchStart[1]);if(n>this.touchDragMoveCancelDistance)return void this.reset();this.onDragStart(e)}e.preventDefault();const{clientX:n,clientY:a}=t;this.left=n,this.top=a,this.left=n-this.touchStart[0],this.top=a-this.touchStart[1],this.touchScroll(e);let i=document.elementsFromPoint(n,a).filter((e=>e.dataset?.droppable&&!e.classList.contains("dragged")))?.[0];i?(this.dispatchEvent("dragenter",i),this.touchOverElement=i):this.touchOverElement=null},touchScroll(e){if(this.disabled)return;const t=this.getScrollableParent();if(!t)return;const n=e.touches?.[0];if(!n)return;const{clientX:a,clientY:i}=n,s=t.getBoundingClientRect(),o=[(a-s.left)/s.width,(i-s.top)/s.height],r=[0,0];o[0]<0?r[0]=-1:o[0]>1&&(r[0]=1),o[1]<0?r[1]=-1:o[1]>1&&(r[1]=1),this.handleTouchScroll(r,t)},onTouchEnd(e){if(this.disabled)return;const t=this.touchOverElement;t&&this.dispatchEvent("drop",t),this.onDragEnd(e)},handleTouchScroll(e,t){this.touchScrollDirection=e,e[0]||e[1]?this.touchScrollTimer||(this.touchScrollTimer=setInterval((()=>{if(!t)return;const[n,a]=e;t.scrollBy(n*this.touchScrollSpeed,a*this.touchScrollSpeed)}),1e3/60)):this.cancelScroll()},getScrollableParent(){let e=this.element?.parentElement;while(e){if(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth){const t=window.getComputedStyle(e);if(["scroll","auto"].includes(t.overflowY)||["scroll","auto"].includes(t.overflowX))return e}e=e.parentElement}return null},dispatchEvent(e,t){t.dispatchEvent(new DragEvent(e,{target:{...t,value:this.value}}))},cancelScroll(){this.touchScrollDirection=[0,0],this.touchScrollTimer&&(clearInterval(this.touchScrollTimer),this.touchScrollTimer=null)},cancelTouchDragStart(){this.touchDragStartTimer&&(clearTimeout(this.touchDragStartTimer),this.touchDragStartTimer=null)},reset(){this.cancelTouchDragStart(),this.cancelScroll(),this.dragging=!1,this.touchStart=null,this.touchOverElement=null,this.left=0,this.top=0,this.initialCursorOffset=null},installHandlers(){console.debug("Installing drag handlers on",this.element),this.element?.setAttribute("draggable",!0),Object.entries(this.eventsHandlers).forEach((([e,t])=>{this.element?.addEventListener(e,t)}))},uninstallHandlers(){console.debug("Uninstalling drag handlers from",this.element),this.element?.setAttribute("draggable",!1),Object.entries(this.eventsHandlers).forEach((([e,t])=>{this.element?.removeEventListener(e,t)}))}},watch:{dragging(){this.dragging?(this.element?.classList.add("dragged"),this.$nextTick((()=>{this.touchStart&&(this.initialCursorOffset=[this.element?.offsetLeft-this.touchStart[0],this.element?.offsetTop-this.touchStart[1]])}))):this.element?.classList.remove("dragged")},disabled(e){e?(this.reset(),this.uninstallHandlers()):this.installHandlers()},element(){this.uninstallHandlers(),this.installHandlers()},touchOverElement(e,t){e!==t&&(t&&this.dispatchEvent("dragleave",t),e&&this.dispatchEvent("dragenter",e))}},mounted(){this.installHandlers()},unmounted(){this.uninstallHandlers()}},U=n(3744);const G=(0,U.Z)(H,[["render",N],["__scopeId","data-v-dd2759da"]]);var z=G;const R={class:"droppable"};function P(e,t,n,i,s,o){return(0,a.wg)(),(0,a.iD)("div",R)}var F={emits:["dragenter","dragleave","dragover","drop"],props:{element:{type:Object},active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data(){return{eventsHandlers:{dragenter:this.onDragEnter,dragleave:this.onDragLeave,dragover:this.onDragOver,drop:this.onDrop},selected:!1}},methods:{onDragEnter(e){this.disabled||this.selected||(this.selected=!0,this.$emit("dragenter",e))},onDragLeave(e){if(this.disabled||!this.selected)return;const t=this.element.getBoundingClientRect();e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom||(this.selected=!1,this.$emit("dragleave",e))},onDragOver(e){this.disabled||(e.preventDefault(),this.selected=!0,this.$emit("dragover",e))},onDrop(e){this.disabled||(this.selected=!1,this.$emit("drop",e))},installHandlers(){const e=this.element;e&&(console.debug("Installing drop handlers on",this.element),e.dataset&&(e.dataset.droppable=!0),e.addEventListener&&Object.entries(this.eventsHandlers).forEach((([t,n])=>{e.addEventListener(t,n)})))},uninstallHandlers(){const e=this.element;e&&(console.debug("Uninstalling drop handlers from",this.element),e.dataset?.droppable&&delete e.dataset.droppable,e.removeEventListener&&Object.entries(this.eventsHandlers).forEach((([t,n])=>{e.removeEventListener(t,n)})))}},watch:{active(){this.active?this.element?.classList.add("active"):this.element?.classList.remove("active")},disabled:{handler(){this.disabled?this.element?.classList.add("disabled"):this.element?.classList.remove("disabled")}},element:{handler(){this.uninstallHandlers(),this.installHandlers()}},selected:{handler(e,t){e&&!t?this.element?.classList.add("selected"):!e&&t&&this.element?.classList.remove("selected")}}},mounted(){this.$nextTick((()=>{this.installHandlers()}))},unmounted(){this.uninstallHandlers()}};const Y=(0,U.Z)(F,[["render",P]]);var K=Y,X=n(2126),J=n(8399),Q=n(2918),ee={mixins:[J.Z],emits:["delete","drag","dragenter","dragleave","dragover","drop","input"],components:{ActionEditor:W.Z,Draggable:z,Droppable:K,ExtensionIcon:X.Z,Modal:Q.Z},props:{context:{type:Object,default:()=>({})},draggable:{type:Boolean,default:!0},value:{type:Object,default:()=>({name:void 0,args:{},extraArgs:[],supportsExtraArgs:!0})},withDelete:{type:Boolean,default:!1},readOnly:{type:Boolean,default:!1}},data(){return{tile:null}},computed:{isNew(){return!this.readOnly&&!this.name?.length},name(){return this.value.name||this.value.action}},methods:{onInput(e){e&&!this.readOnly&&(this.$emit("input",{...this.value,name:e.action,args:e.args,extraArgs:e.extraArgs,supportsExtraArgs:e.supportsExtraArgs}),this.$refs.actionEditor.close())}},mounted(){this.tile=this.$refs.tile}};const te=(0,U.Z)(ee,[["render",M],["__scopeId","data-v-49487886"]]);var ne=te;const ae=e=>((0,a.dD)("data-v-7d0cf109"),e=e(),(0,a.Cn)(),e),ie=ae((()=>(0,a._)("div",{class:"droppable-wrapper"},[(0,a._)("div",{class:"droppable-container"},[(0,a._)("div",{class:"droppable-frame"},[(0,a._)("div",{class:"droppable"})])])],-1))),se=[ie],oe={key:0,class:"spacer top"},re={key:1,class:"spacer bottom"},le=ae((()=>(0,a._)("div",{class:"droppable-wrapper"},[(0,a._)("div",{class:"droppable-container"},[(0,a._)("div",{class:"droppable-frame"},[(0,a._)("div",{class:"droppable"})])])],-1))),de=[le];function ce(e,t,n,s,o,r){const l=(0,a.up)("Droppable");return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["row item list-item",r.itemClass])},[(0,a._)("div",{class:(0,i.C_)(["spacer-wrapper",{hidden:!n.spacerTop}])},[(0,a._)("div",{class:(0,i.C_)(["spacer top",{active:n.active}]),ref:"dropTargetTop"},se,2),(0,a.Wm)(l,(0,a.dG)({element:e.$refs.dropTargetTop,disabled:n.readOnly},(0,a.mx)(r.droppableData.top.on)),null,16,["element","disabled"])],2),n.dragging?((0,a.wg)(),(0,a.iD)("div",oe)):(0,a.kq)("",!0),(0,a.WI)(e.$slots,"default",{},void 0,!0),n.dragging?((0,a.wg)(),(0,a.iD)("div",re)):(0,a.kq)("",!0),(0,a._)("div",{class:(0,i.C_)(["spacer-wrapper",{hidden:!n.spacerBottom}])},[(0,a._)("div",{class:(0,i.C_)(["spacer bottom",{active:n.active}]),ref:"dropTargetBottom"},de,2),(0,a.Wm)(l,(0,a.dG)({element:e.$refs.dropTargetBottom,disabled:n.readOnly},(0,a.mx)(r.droppableData.bottom.on)),null,16,["element","disabled"])],2)],2)}var ue=n(8637),pe={mixins:[ue.Z],emits:["contextmenu","dragend","dragenter","dragleave","dragover","drop"],components:{Droppable:K},props:{active:{type:Boolean,default:!1},className:{type:[String,Object],default:""},dragging:{type:Boolean,default:!1},readOnly:{type:Boolean,default:!1},spacerBottom:{type:Boolean,default:!1},spacerTop:{type:Boolean,default:!0},value:{type:[String,Number,Boolean,Object,Array],required:!0}},computed:{droppableData(){return["bottom","top"].reduce(((e,t)=>(e[t]={on:{dragend:this.onDragEnd,dragenter:this.onDragEnter,dragleave:this.onDragLeave,dragover:this.onDragOver,drop:this.onDrop}},e)),{})},itemClass(){return{dragging:this.dragging,...this.className?.trim?{[this.className]:!0}:this.className||{}}}},methods:{onDragEnd(e){this.$emit("dragend",e)},onDragEnter(e){this.$emit("dragenter",e)},onDragLeave(e){this.$emit("dragleave",e)},onDragOver(e){this.$emit("dragover",e)},onDrop(e){this.$emit("drop",e)}}};const he=(0,U.Z)(pe,[["render",ce],["__scopeId","data-v-7d0cf109"]]);var ge=he,me={mixins:[ue.Z],emits:["contextmenu","delete","drag","dragend","dragenter","dragleave","dragover","drop","input"],components:{ActionTile:ne,ListItem:ge},props:{active:{type:Boolean,default:!1},context:{type:Object,default:()=>({})},readOnly:{type:Boolean,default:!1},spacerBottom:{type:Boolean,default:!1},spacerTop:{type:Boolean,default:!0},value:{type:Object,required:!0}},data(){return{dragging:!1}},computed:{componentsData(){return{on:{dragend:this.onDragEnd,dragover:this.onDragOver,drop:this.onDrop,input:this.onInput}}}},methods:{onDragStart(e){this.readOnly||(this.dragging=!0,this.$emit("drag",e))},onDragEnd(e){e.stopPropagation(),this.dragging=!1,this.$emit("dragend",e)},onDragOver(e){e.stopPropagation(),this.$emit("dragover",e)},onDrop(e){this.readOnly||(e.stopPropagation(),this.dragging=!1,this.$emit("drop",e))},onInput(e){this.$emit("input",e)}}};const ve=(0,U.Z)(me,[["render",C]]);var ye=ve;const fe={class:"add-tile-container"},we={class:"add-tile"},be={class:"icon"},De={class:"name"};function ke(e,t,n,s,o,r){const l=(0,a.up)("Tile");return(0,a.wg)(),(0,a.iD)("div",fe,[(0,a.Wm)(l,{class:"add",draggable:!1,"read-only":!0,onClick:t[0]||(t[0]=t=>e.$emit("click"))},{default:(0,a.w5)((()=>[(0,a._)("div",we,[(0,a._)("span",be,[(0,a._)("i",{class:(0,i.C_)(n.icon)},null,2)]),(0,a._)("span",De,(0,i.zw)(n.title),1)])])),_:1})])}const xe=e=>((0,a.dD)("data-v-9354cf66"),e=e(),(0,a.Cn)(),e),Ce=xe((()=>(0,a._)("i",{class:"icon fas fa-xmark"},null,-1))),_e=[Ce];function $e(e,t,n,o,r,l){const d=(0,a.up)("Draggable"),c=(0,a.up)("Droppable");return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["tile-container",n.className])},[(0,a._)("div",{class:"tile",ref:"tile",onClick:t[1]||(t[1]=t=>e.$emit("click",t))},[n.withDelete?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"delete",title:"Remove",onClick:t[0]||(t[0]=(0,s.iM)((t=>e.$emit("delete")),["stop"]))},_e)):(0,a.kq)("",!0),(0,a.WI)(e.$slots,"default",{},void 0,!0)],512),n.draggable?((0,a.wg)(),(0,a.j4)(d,{key:0,element:r.tile,disabled:n.readOnly,value:n.value,onDrag:t[2]||(t[2]=t=>e.$emit("drag",t)),onDragend:t[3]||(t[3]=t=>e.$emit("dragend",t)),onDrop:t[4]||(t[4]=t=>e.$emit("drop",t))},null,8,["element","disabled","value"])):(0,a.kq)("",!0),n.readOnly?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(c,{key:1,element:r.tile,onDragenter:t[5]||(t[5]=t=>e.$emit("dragenter",t)),onDragleave:t[6]||(t[6]=t=>e.$emit("dragleave",t)),onDragover:t[7]||(t[7]=t=>e.$emit("dragover",t)),onDrop:t[8]||(t[8]=t=>e.$emit("drop",t))},null,8,["element"]))],2)}var Be={emits:["click","delete","drag","dragenter","dragleave","dragover","drop"],components:{Draggable:z,Droppable:K},props:{className:{type:[String,Object],default:""},draggable:{type:Boolean,default:!0},readOnly:{type:Boolean,default:!1},value:{type:[Object,String,Number,Boolean,Array]},withDelete:{type:Boolean,default:!1}},data(){return{tile:void 0}},mounted(){this.tile=this.$refs.tile}};const Ee=(0,U.Z)(Be,[["render",$e],["__scopeId","data-v-9354cf66"]]);var Oe=Ee,Te={emits:["click"],components:{Tile:Oe},props:{icon:{type:String,default:"fas fa-plus"},title:{type:String,required:!0}}};const Ie=(0,U.Z)(Te,[["render",ke],["__scopeId","data-v-2ff09bb6"]]);var Se=Ie;const Ve=(0,a._)("div",{class:"tile-name"},[(0,a._)("span",{class:"icon"},[(0,a._)("i",{class:"fas fa-hand"})]),(0,a._)("span",{class:"name"},[(0,a._)("span",{class:"keyword"},"break")])],-1);function Ae(e,t,n,i,o,r){const l=(0,a.up)("Tile"),d=(0,a.up)("ListItem");return(0,a.wg)(),(0,a.j4)(d,{class:"break-tile",value:"break",active:n.active,"read-only":n.readOnly,"spacer-bottom":n.spacerBottom,"spacer-top":n.spacerTop},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{value:n.value,class:"keyword",draggable:!1,"read-only":n.readOnly,"with-delete":!n.readOnly,onClick:t[0]||(t[0]=(0,s.iM)((()=>{}),["stop"])),onDelete:t[1]||(t[1]=t=>e.$emit("delete"))},{default:(0,a.w5)((()=>[Ve])),_:1},8,["value","read-only","with-delete"])])),_:1},8,["active","read-only","spacer-bottom","spacer-top"])}var Le={emits:["delete"],components:{ListItem:ge,Tile:Oe},props:{value:{type:String,default:"break"},active:{type:Boolean,default:!1},readOnly:{type:Boolean,default:!1},spacerBottom:{type:Boolean,default:!0},spacerTop:{type:Boolean,default:!0}}};const je=(0,U.Z)(Le,[["render",Ae]]);var qe=je;const Me={class:"condition-block"};function We(e,t,n,i,o,r){const l=(0,a.up)("ConditionTile"),d=(0,a.up)("EndBlockTile"),c=(0,a.up)("ActionsBlock");return(0,a.wg)(),(0,a.iD)("div",Me,[(0,a.Wm)(c,{value:n.value,collapsed:n.collapsed,context:e.context,dragging:r.isDragging,"has-else":n.hasElse,"is-inside-loop":n.isInsideLoop,indent:n.indent,"read-only":n.readOnly,onInput:r.onActionsChange,onAddElse:t[1]||(t[1]=t=>e.$emit("add-else")),onDrag:t[2]||(t[2]=t=>e.$emit("drag",t)),onDragend:t[3]||(t[3]=t=>e.$emit("dragend",t)),onDragenter:t[4]||(t[4]=t=>e.$emit("dragenter",t)),onDragleave:t[5]||(t[5]=t=>e.$emit("dragleave",t)),onDragover:t[6]||(t[6]=t=>e.$emit("dragover",t)),onDrop:t[7]||(t[7]=t=>e.$emit("drop",t))},{before:(0,a.w5)((()=>[r.condition&&!n.isElse?((0,a.wg)(),(0,a.j4)(l,(0,a.dG)({key:0,value:r.condition},r.conditionTileConf.props,(0,a.mx)(r.conditionTileConf.on),{onInput:t[0]||(t[0]=(0,s.iM)((()=>{}),["prevent","stop"])),"spacer-top":n.spacerTop,"spacer-bottom":!1}),null,16,["value","spacer-top"])):n.isElse?((0,a.wg)(),(0,a.j4)(l,(0,a.dG)({key:1,value:"else"},r.conditionTileConf.props,(0,a.mx)(r.conditionTileConf.on),{"is-else":!0,"spacer-top":n.spacerTop,"spacer-bottom":!1}),null,16,["spacer-top"])):(0,a.kq)("",!0)])),after:(0,a.w5)((()=>[n.isElse||!n.hasElse?((0,a.wg)(),(0,a.j4)(d,{key:0,value:"end if",icon:"fas fa-question",active:n.active,"spacer-bottom":n.spacerBottom||o.dragging_,onDrop:r.onDrop},null,8,["active","spacer-bottom","onDrop"])):(0,a.kq)("",!0)])),_:1},8,["value","collapsed","context","dragging","has-else","is-inside-loop","indent","read-only","onInput"])])}const Ze=e=>((0,a.dD)("data-v-505af250"),e=e(),(0,a.Cn)(),e),Ne={class:"actions-list-container",ref:"actionsListContainer"},He=Ze((()=>(0,a._)("i",{class:"fas fa-ellipsis-h"},null,-1))),Ue=[He];function Ge(e,t,n,s,o,r){const l=(0,a.up)("ActionsList"),d=(0,a.up)("Droppable");return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["actions-block",{hover:o.hover}])},[(0,a.WI)(e.$slots,"before",{},void 0,!0),(0,a._)("div",Ne,[r.isCollapsed?((0,a.wg)(),(0,a.iD)("button",{key:0,class:"collapse-button",onClick:t[0]||(t[0]=e=>o.collapsed_=!o.collapsed_)},Ue)):(0,a.kq)("",!0),(0,a._)("div",{class:(0,i.C_)(["actions-list",r.actionListClasses])},[(0,a.Wm)(l,{value:n.value[r.key],context:e.context,dragging:n.dragging,"has-else":n.hasElse,indent:n.indent,"is-inside-loop":n.isInsideLoop,parent:n.value,"read-only":n.readOnly,onAddElse:t[1]||(t[1]=t=>e.$emit("add-else")),onCollapse:t[2]||(t[2]=e=>o.collapsed_=!o.collapsed_),onDrag:t[3]||(t[3]=t=>e.$emit("drag",t)),onDragend:t[4]||(t[4]=t=>{e.$emit("dragend",t),o.hover=!1}),onDragenter:t[5]||(t[5]=t=>e.$emit("dragenter",t)),onDragleave:t[6]||(t[6]=t=>{e.$emit("dragleave",t),o.hover=!1}),onDragover:t[7]||(t[7]=t=>e.$emit("dragover",t)),onDrop:t[8]||(t[8]=t=>{e.$emit("drop",t),o.hover=!1}),onInput:t[9]||(t[9]=t=>{e.$emit("input",t),o.hover=!1})},null,8,["value","context","dragging","has-else","indent","is-inside-loop","parent","read-only"])],2)],512),(0,a.WI)(e.$slots,"after",{},void 0,!0),n.readOnly?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(d,{key:0,element:e.$refs.actionsListContainer,onDragenter:r.onDragEnter,onDragleave:r.onDragLeave,onDrop:t[10]||(t[10]=e=>o.hover=!1)},null,8,["element","onDragenter","onDragleave"]))],2)}var ze={name:"ActionsBlock",mixins:[J.Z],emits:["add-else","drag","dragend","dragenter","dragleave","dragover","drop","input"],components:{ActionsList:(0,a.RC)((()=>Promise.resolve().then(n.bind(n,1080)))),Droppable:K},props:{value:{type:Object,required:!0},collapsed:{type:Boolean,default:!1},dragging:{type:Boolean,default:!1},indent:{type:Number,default:0},isInsideLoop:{type:Boolean,default:!1},readOnly:{type:Boolean,default:!1},hasElse:{type:Boolean,default:!1}},computed:{actionListClasses(){return{hidden:this.isCollapsed,fold:this.folding,unfold:this.unfolding}},condition(){return this.getCondition(this.key)},isCollapsed(){const e=this.hover||this.folding||this.unfolding;return!e&&(!!this.collapsed_||this.collapsed)},key(){return this.getKey(this.value)}},data(){return{collapsed_:!1,folding:!1,hover:!1,hoverTimeout:null,unfolding:!1}},watch:{collapsed_(e){e?(this.folding=!0,setTimeout((()=>{this.folding=!1}),300)):(this.unfolding=!0,setTimeout((()=>{this.unfolding=!1}),300))}},methods:{onDragEnter(){this.hoverTimeout||(this.hoverTimeout=setTimeout((()=>{this.hover=!0}),500))},onDragLeave(){this.hoverTimeout&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=null),this.hover=!1}}};const Re=(0,U.Z)(ze,[["render",Ge],["__scopeId","data-v-505af250"]]);var Pe=Re;const Fe=e=>((0,a.dD)("data-v-7d017735"),e=e(),(0,a.Cn)(),e),Ye={key:0,class:"drag-spacer"},Ke={class:"tile-name"},Xe=Fe((()=>(0,a._)("span",{class:"icon"},[(0,a._)("i",{class:"fas fa-question"})],-1))),Je={class:"name"},Qe=Fe((()=>(0,a._)("span",{class:"keyword"},"if",-1))),et=["textContent"],tt=Fe((()=>(0,a._)("div",{class:"tile-name"},[(0,a._)("span",{class:"icon"},[(0,a._)("i",{class:"fas fa-question"})]),(0,a._)("span",{class:"name"},[(0,a._)("span",{class:"keyword"},"else")])],-1))),nt={key:3,class:"condition-editor-container"},at=Fe((()=>(0,a._)("div",{class:"header"}," Condition ",-1)));function it(e,t,n,o,r,l){const d=(0,a.up)("Tile"),c=(0,a.up)("ExpressionEditor"),u=(0,a.up)("Modal"),p=(0,a.up)("ListItem");return(0,a.wg)(),(0,a.j4)(p,(0,a.dG)({class:"condition-tile",value:n.value,active:n.active,"read-only":n.readOnly,"spacer-bottom":n.spacerBottom,"spacer-top":n.spacerTop},(0,a.mx)(l.dragListeners),{onInput:t[3]||(t[3]=t=>e.$emit("input",t))}),{default:(0,a.w5)((()=>[r.dragging&&!n.spacerTop?((0,a.wg)(),(0,a.iD)("div",Ye," ")):(0,a.kq)("",!0),n.isElse?((0,a.wg)(),(0,a.j4)(d,(0,a.dG)({key:2},l.tileConf.props,(0,a.mx)(l.tileConf.on),{draggable:!1,"read-only":!0,onClick:t[1]||(t[1]=t=>e.$emit("click"))}),{default:(0,a.w5)((()=>[tt])),_:1},16)):((0,a.wg)(),(0,a.j4)(d,(0,a.dG)({key:1},l.tileConf.props,(0,a.mx)(l.tileConf.on),{draggable:!n.readOnly,onClick:t[0]||(t[0]=(0,s.iM)((e=>r.showConditionEditor=!0),["stop"]))}),{default:(0,a.w5)((()=>[(0,a._)("div",Ke,[Xe,(0,a._)("span",Je,[Qe,(0,a.Uk)(" [ "),(0,a._)("span",{class:"code",textContent:(0,i.zw)(n.value)},null,8,et),(0,a.Uk)(" ] ")])])])),_:1},16,["draggable"])),r.showConditionEditor&&!n.readOnly?((0,a.wg)(),(0,a.iD)("div",nt,[(0,a.Wm)(u,{title:"Edit Condition",visible:!0,onClose:t[2]||(t[2]=e=>r.showConditionEditor=!1)},{default:(0,a.w5)((()=>[r.showConditionEditor?((0,a.wg)(),(0,a.j4)(c,{key:0,value:n.value,context:e.context,ref:"conditionEditor",onInput:(0,s.iM)(l.onConditionChange,["prevent","stop"])},{default:(0,a.w5)((()=>[at])),_:1},8,["value","context","onInput"])):(0,a.kq)("",!0)])),_:1})])):(0,a.kq)("",!0)])),_:1},16,["value","active","read-only","spacer-bottom","spacer-top"])}const st=e=>((0,a.dD)("data-v-cfcbaedc"),e=e(),(0,a.Cn)(),e),ot={for:"expression"},rt=["disabled"],lt=st((()=>(0,a._)("i",{class:"fas fa-check"},null,-1)));function dt(e,t,n,i,o,r){const l=(0,a.up)("ContextAutocomplete");return(0,a.wg)(),(0,a.iD)("form",{class:"expression-editor",onSubmit:t[0]||(t[0]=(0,s.iM)(((...e)=>r.onSubmit&&r.onSubmit(...e)),["prevent","stop"]))},[(0,a._)("label",ot,[(0,a.WI)(e.$slots,"default",{},void 0,!0),(0,a.Wm)(l,{value:o.newValue,items:e.contextAutocompleteItems,quote:n.quote,onInput:(0,s.iM)(r.onInput,["stop"]),ref:"input"},null,8,["value","items","quote","onInput"])]),(0,a._)("label",null,[(0,a._)("button",{type:"submit",disabled:!o.hasChanges},[lt,(0,a.Uk)(" Save ")],8,rt)])],32)}var ct=n(2782),ut={emits:["input"],mixins:[J.Z],components:{ContextAutocomplete:ct.Z},props:{value:{type:[String,Number,Boolean,Object,Array],default:""},allowEmpty:{type:Boolean,default:!1},placeholder:{type:String,default:""},quote:{type:Boolean,default:!1}},data(){return{hasChanges:!1,newValue:null}},methods:{onSubmit(e){const t=this.newValue?.trim();(t.length||this.allowEmpty)&&(e.target.value=t,this.$emit("input",e))},onInput(e){if(null==e?.detail)return;const t=""+e.detail;t?.trim()?.length?this.hasChanges=t!==this.value:this.hasChanges=this.allowEmpty,this.$nextTick((()=>{this.newValue=t}))}},watch:{value(){this.hasChanges=!1}},mounted(){this.hasChanges=!1,this.newValue=this.value,this.value?.trim?.()?.length||(this.hasChanges=this.allowEmpty),this.$nextTick((()=>{this.textInput?.focus()}))}};const pt=(0,U.Z)(ut,[["render",dt],["__scopeId","data-v-cfcbaedc"]]);var ht=pt,gt={emits:["change","click","delete","drag","dragend","dragenter","dragleave","dragover","drop","input"],mixins:[J.Z],components:{ExpressionEditor:ht,ListItem:ge,Modal:Q.Z,Tile:Oe},props:{value:{type:String,required:!0},active:{type:Boolean,default:!1},isElse:{type:Boolean,default:!1},readOnly:{type:Boolean,default:!1},spacerBottom:{type:Boolean,default:!0},spacerTop:{type:Boolean,default:!0}},computed:{dragListeners(){return this.readOnly?{}:{drag:this.onDragStart,dragend:this.onDragEnd,dragenter:e=>this.$emit("dragenter",e),dragleave:e=>this.$emit("dragleave",e),dragover:e=>this.$emit("dragover",e),drop:this.onDrop}},tileConf(){return{props:{value:this.value,class:"keyword",readOnly:this.readOnly,withDelete:!this.readOnly},on:{...this.dragListeners,delete:()=>this.$emit("delete"),input:this.onInput}}}},data(){return{dragging:!1,showConditionEditor:!1}},methods:{onConditionChange(e){if(this.showConditionEditor=!1,this.readOnly)return;const t=e.target.value?.trim();t?.length&&(e.target.value=t,this.$emit("change",t))},onInput(e){e&&!this.readOnly&&this.$emit("input",e)},onDragStart(e){this.readOnly||(this.dragging=!0,this.$emit("drag",e))},onDragEnd(e){this.dragging=!1,this.$emit("dragend",e)},onDrop(e){this.dragging=!1,this.readOnly||this.$emit("drop",e)}}};const mt=(0,U.Z)(gt,[["render",it],["__scopeId","data-v-7d017735"]]);var vt=mt;const yt={class:"tile-name"},ft={class:"icon"},wt={class:"name"},bt=["textContent"];function Dt(e,t,n,s,o,r){const l=(0,a.up)("Tile"),d=(0,a.up)("ListItem");return(0,a.wg)(),(0,a.j4)(d,{class:"end-block-container",active:n.active,value:{},"read-only":!1,"spacer-bottom":n.spacerBottom,"spacer-top":n.spacerTop,onDragenter:t[0]||(t[0]=t=>e.$emit("dragenter",t)),onDragleave:t[1]||(t[1]=t=>e.$emit("dragleave",t)),onDragover:t[2]||(t[2]=t=>e.$emit("dragover",t)),onDrop:t[3]||(t[3]=t=>e.$emit("drop",t))},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{class:"keyword",draggable:!1,"read-only":!0},{default:(0,a.w5)((()=>[(0,a._)("div",yt,[(0,a._)("span",ft,[(0,a._)("i",{class:(0,i.C_)(n.icon)},null,2)]),(0,a._)("span",wt,[(0,a._)("span",{class:"keyword",textContent:(0,i.zw)(n.value)},null,8,bt)])])])),_:1})])),_:1},8,["active","spacer-bottom","spacer-top"])}var kt={mixins:[J.Z],components:{ListItem:ge,Tile:Oe},props:{value:{type:String,required:!0},icon:{type:String,required:!0},active:{type:Boolean,default:!1},spacerTop:{type:Boolean,default:!1},spacerBottom:{type:Boolean,default:!1}}};const xt=(0,U.Z)(kt,[["render",Dt]]);var Ct=xt,_t={name:"ConditionBlock",mixins:[J.Z],emits:["add-else","delete","drag","dragend","dragenter","dragleave","dragover","drop","input"],components:{ActionsBlock:Pe,ConditionTile:vt,EndBlockTile:Ct},props:{value:{type:Object,required:!0},active:{type:Boolean,default:!1},collapsed:{type:Boolean,default:!1},dragging:{type:Boolean,default:!1},hasElse:{type:Boolean,default:!1},indent:{type:Number,default:0},isElse:{type:Boolean,default:!1},isInsideLoop:{type:Boolean,default:!1},readOnly:{type:Boolean,default:!1},spacerBottom:{type:Boolean,default:!1},spacerTop:{type:Boolean,default:!1}},data(){return{dragging_:!1}},computed:{condition(){return this.getCondition(this.key)},conditionTileConf(){return{props:{active:this.active,context:this.context,readOnly:this.readOnly,spacerBottom:this.spacerBottom,spacerTop:this.spacerTop},on:{change:this.onConditionChange,delete:e=>this.$emit("delete",e),drag:this.onDragStart,dragend:this.onDragEnd,dragenterspacer:e=>this.$emit("dragenter",e),dragleavespacer:e=>this.$emit("dragleave",e),dragover:e=>this.$emit("dragover",e),dragoverspacer:e=>this.$emit("dragoverspacer",e),drop:this.onDrop}}},isDragging(){return this.dragging_||this.dragging},key(){return this.getKey(this.value)}},methods:{onActionsChange(e){this.key&&!this.readOnly&&this.$emit("input",{[this.key]:e})},onConditionChange(e){this.key&&!this.readOnly&&e?.length&&(e=`if \${${e.trim()}}`,this.$emit("input",{[e]:this.value[this.key]}))},onDragStart(e){this.readOnly||(this.dragging_=!0,this.$emit("drag",e))},onDragEnd(e){this.dragging_=!1,this.$emit("dragend",e)},onDrop(e){this.readOnly||(this.dragging_=!1,this.$emit("drop",e))}}};const $t=(0,U.Z)(_t,[["render",We],["__scopeId","data-v-79ae696c"]]);var Bt=$t;const Et=(0,a._)("div",{class:"tile-name"},[(0,a._)("span",{class:"icon"},[(0,a._)("i",{class:"fas fa-rotate"})]),(0,a._)("span",{class:"name"},[(0,a._)("span",{class:"keyword"},"continue")])],-1);function Ot(e,t,n,i,o,r){const l=(0,a.up)("Tile"),d=(0,a.up)("ListItem");return(0,a.wg)(),(0,a.j4)(d,{class:"continue-tile",value:"continue",active:n.active,"read-only":n.readOnly,"spacer-bottom":n.spacerBottom,"spacer-top":n.spacerTop},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{value:n.value,class:"keyword",draggable:!1,"read-only":n.readOnly,"with-delete":!n.readOnly,onClick:t[0]||(t[0]=(0,s.iM)((()=>{}),["stop"])),onDelete:t[1]||(t[1]=t=>e.$emit("delete"))},{default:(0,a.w5)((()=>[Et])),_:1},8,["value","read-only","with-delete"])])),_:1},8,["active","read-only","spacer-bottom","spacer-top"])}var Tt={emits:["delete"],components:{ListItem:ge,Tile:Oe},props:{value:{type:String,default:"continue"},active:{type:Boolean,default:!1},readOnly:{type:Boolean,default:!1},spacerBottom:{type:Boolean,default:!0},spacerTop:{type:Boolean,default:!0}}};const It=(0,U.Z)(Tt,[["render",Ot]]);var St=It;const Vt={class:"loop-block"};function At(e,t,n,i,o,r){const l=(0,a.up)("LoopTile"),d=(0,a.up)("EndBlockTile"),c=(0,a.up)("ActionsBlock");return(0,a.wg)(),(0,a.iD)("div",Vt,[(0,a.Wm)(c,{value:n.value,collapsed:n.collapsed,context:r.context_,dragging:r.isDragging,indent:n.indent,"is-inside-loop":!0,"read-only":n.readOnly,onInput:r.onActionsChange,onDrag:t[1]||(t[1]=t=>e.$emit("drag",t)),onDragend:t[2]||(t[2]=t=>e.$emit("dragend",t)),onDragenter:t[3]||(t[3]=t=>e.$emit("dragenter",t)),onDragleave:t[4]||(t[4]=t=>e.$emit("dragleave",t)),onDragover:t[5]||(t[5]=t=>e.$emit("dragover",t)),onDrop:t[6]||(t[6]=t=>e.$emit("drop",t))},{before:(0,a.w5)((()=>[(0,a.Wm)(l,(0,a.dG)(r.loopTileConf.props,(0,a.mx)(r.loopTileConf.on),{onInput:t[0]||(t[0]=(0,s.iM)((()=>{}),["prevent","stop"])),"spacer-top":n.spacerTop,"spacer-bottom":!1}),null,16,["spacer-top"])])),after:(0,a.w5)((()=>[(0,a.Wm)(d,{value:`end ${n.type}`,icon:"fas fa-arrow-rotate-right",active:n.active,"spacer-bottom":n.spacerBottom||n.dragging,onDrop:r.onDrop},null,8,["value","active","spacer-bottom","onDrop"])])),_:1},8,["value","collapsed","context","dragging","indent","read-only","onInput"])])}const Lt=e=>((0,a.dD)("data-v-54198b35"),e=e(),(0,a.Cn)(),e),jt={key:0,class:"drag-spacer"},qt={class:"tile-name"},Mt=Lt((()=>(0,a._)("span",{class:"icon"},[(0,a._)("i",{class:"fas fa-arrow-rotate-left"})],-1))),Wt={key:0,class:"name"},Zt={class:"keyword"},Nt={key:0},Ht=["textContent"],Ut=Lt((()=>(0,a._)("span",{class:"keyword"}," in ",-1))),Gt=["textContent"],zt={key:1,class:"name"},Rt=Lt((()=>(0,a._)("span",{class:"keyword"},"while",-1))),Pt=["textContent"],Ft={key:1,class:"editor-container"};function Yt(e,t,n,o,r,l){const d=(0,a.up)("Tile"),c=(0,a.up)("LoopEditor"),u=(0,a.up)("ExpressionEditor"),p=(0,a.up)("Modal"),h=(0,a.up)("ListItem");return(0,a.wg)(),(0,a.j4)(h,(0,a.dG)({class:"loop-tile",value:l.value,active:n.active,"read-only":n.readOnly,"spacer-bottom":n.spacerBottom,"spacer-top":n.spacerTop},(0,a.mx)(l.dragListeners),{onInput:t[2]||(t[2]=t=>e.$emit("input",t))}),{default:(0,a.w5)((()=>[r.dragging&&!n.spacerTop?((0,a.wg)(),(0,a.iD)("div",jt," ")):(0,a.kq)("",!0),(0,a.Wm)(d,(0,a.dG)(l.tileConf.props,(0,a.mx)(l.tileConf.on),{draggable:!n.readOnly,onClick:t[0]||(t[0]=(0,s.iM)((e=>r.showLoopEditor=!0),["stop"]))}),{default:(0,a.w5)((()=>[(0,a._)("div",qt,[Mt,"for"===n.type?((0,a.wg)(),(0,a.iD)("span",Wt,[(0,a._)("span",Zt,[(0,a.Uk)("for"),n.async?((0,a.wg)(),(0,a.iD)("span",Nt,"k")):(0,a.kq)("",!0)]),(0,a.Uk)(),(0,a._)("span",{class:"code",textContent:(0,i.zw)(n.iterator)},null,8,Ht),Ut,(0,a.Uk)(" [ "),(0,a._)("span",{class:"code",textContent:(0,i.zw)(n.iterable)},null,8,Gt),(0,a.Uk)(" ] ")])):"while"===n.type?((0,a.wg)(),(0,a.iD)("span",zt,[Rt,(0,a.Uk)(" [ "),(0,a._)("span",{class:"code",textContent:(0,i.zw)(n.condition)},null,8,Pt),(0,a.Uk)(" ] ")])):(0,a.kq)("",!0)])])),_:1},16,["draggable"]),r.showLoopEditor&&!n.readOnly?((0,a.wg)(),(0,a.iD)("div",Ft,[(0,a.Wm)(p,{title:"Edit Loop",visible:!0,onClose:t[1]||(t[1]=e=>r.showLoopEditor=!1)},{default:(0,a.w5)((()=>[r.showLoopEditor&&"for"===n.type?((0,a.wg)(),(0,a.j4)(c,{key:0,iterator:n.iterator,iterable:n.iterable,async:n.async,context:e.context,onChange:l.onLoopChange},{default:(0,a.w5)((()=>[(0,a.Uk)(" Loop ")])),_:1},8,["iterator","iterable","async","context","onChange"])):r.showLoopEditor&&"while"===n.type?((0,a.wg)(),(0,a.j4)(u,{key:1,value:n.condition,context:e.context,onInput:(0,s.iM)(l.onConditionChange,["prevent","stop"])},{default:(0,a.w5)((()=>[(0,a.Uk)(" Loop Condition ")])),_:1},8,["value","context","onInput"])):(0,a.kq)("",!0)])),_:1})])):(0,a.kq)("",!0)])),_:1},16,["value","active","read-only","spacer-bottom","spacer-top"])}const Kt=e=>((0,a.dD)("data-v-f2db70a8"),e=e(),(0,a.Cn)(),e),Xt={for:"iterator"},Jt=["value"],Qt={for:"iterable"},en={class:"async"},tn=["checked"],nn=["disabled"],an=Kt((()=>(0,a._)("i",{class:"fas fa-check"},null,-1)));function sn(e,t,n,i,o,r){const l=(0,a.up)("ContextAutocomplete");return(0,a.wg)(),(0,a.iD)("form",{class:"loop-editor",onSubmit:t[3]||(t[3]=(0,s.iM)(((...e)=>r.onSubmit&&r.onSubmit(...e)),["prevent","stop"]))},[(0,a.Uk)(" for "),(0,a._)("label",Xt,[(0,a._)("input",{type:"text",name:"iterator",autocomplete:"off",autofocus:!0,placeholder:"Iterator",value:o.newValue.iterator,ref:"iterator",onInput:t[0]||(t[0]=(0,s.iM)((e=>r.onInput("iterator",e)),["stop"]))},null,40,Jt)]),(0,a.Uk)(" in "),(0,a._)("label",Qt,[(0,a.Wm)(l,{value:o.newValue.iterable,items:e.contextAutocompleteItems,placeholder:"Iterable",onInput:t[1]||(t[1]=(0,s.iM)((e=>r.onInput("iterable",e)),["stop"])),ref:"iterable"},null,8,["value","items"])]),(0,a._)("label",en,[(0,a._)("input",{class:"checkbox",type:"checkbox",name:"async",ref:"async",checked:n.async,onInput:t[2]||(t[2]=(0,s.iM)((e=>r.onInput("async",e)),["stop"]))},null,40,tn),(0,a.Uk)("  Run in parallel ")]),(0,a._)("label",null,[(0,a._)("button",{type:"submit",disabled:!o.hasChanges},[an,(0,a.Uk)(" Save ")],8,nn)])],32)}var on={emits:["change","input"],mixins:[J.Z],components:{ContextAutocomplete:ct.Z},props:{async:{type:Boolean,default:!1},iterable:{type:String,default:""},iterator:{type:String,default:""}},data(){return{hasChanges:!0,newValue:{iterator:null,iterable:null,async:null}}},methods:{onSubmit(){const e=this.$refs.iterator.value.trim(),t=this.$refs.iterable.value.trim(),n=this.$refs.async.checked;e.length&&t.length&&this.$emit("change",{iterator:e,iterable:t,async:n})},onInput(e,t){const n=""+(t.target?.value||t.detail);n?.trim()?.length?("iterator"===e&&(this.hasChanges=n!==this.iterator),this.hasChanges||"iterable"!==e||(this.hasChanges=n!==this.iterable),this.hasChanges||"async"!==e||(this.hasChanges=n!==this.async)):this.hasChanges=!1,this.$nextTick((()=>{this.newValue[e]=n}))}},watch:{value(){this.hasChanges=!1,this.newValue={iterator:this.iterator,iterable:this.iterable,async:this.async}}},mounted(){this.newValue={iterator:this.iterator,iterable:this.iterable,async:this.async},this.$nextTick((()=>{this.$refs.iterator.focus()}))}};const rn=(0,U.Z)(on,[["render",sn],["__scopeId","data-v-f2db70a8"]]);var ln=rn,dn={mixins:[J.Z],emits:["change","click","delete","drag","dragend","dragenter","dragleave","dragover","drop","input"],components:{ExpressionEditor:ht,LoopEditor:ln,ListItem:ge,Modal:Q.Z,Tile:Oe},props:{active:{type:Boolean,default:!1},async:{type:Boolean,default:!1},condition:{type:String},iterator:{type:String},iterable:{type:String},readOnly:{type:Boolean,default:!1},spacerBottom:{type:Boolean,default:!0},spacerTop:{type:Boolean,default:!0},type:{type:String,required:!0}},computed:{dragListeners(){return this.readOnly?{}:{drag:this.onDragStart,dragend:this.onDragEnd,dragenter:e=>this.$emit("dragenter",e),dragleave:e=>this.$emit("dragleave",e),dragover:e=>this.$emit("dragover",e),drop:this.onDrop}},tileConf(){return{props:{value:this.value,class:"keyword",readOnly:this.readOnly,withDelete:!this.readOnly},on:{...this.dragListeners,delete:()=>this.$emit("delete"),input:this.onInput}}},value(){return`for ${this.iterator} in ${this.iterable}`}},data(){return{dragging:!1,showLoopEditor:!1}},methods:{onConditionChange(e){if(this.showLoopEditor=!1,this.readOnly)return;const t=e.target.value?.trim();t?.length&&(e.target.value=t,this.$emit("change",t))},onLoopChange(e){this.showLoopEditor=!1,this.readOnly||this.$emit("change",e)},onInput(e){e&&!this.readOnly&&this.$emit("input",e)},onDragStart(e){this.readOnly||(this.dragging=!0,this.$emit("drag",e))},onDragEnd(e){this.dragging=!1,this.$emit("dragend",e)},onDrop(e){this.dragging=!1,this.readOnly||this.$emit("drop",e)}}};const cn=(0,U.Z)(dn,[["render",Yt],["__scopeId","data-v-54198b35"]]);var un=cn,pn={name:"LoopBlock",mixins:[J.Z],emits:["delete","drag","dragend","dragenter","dragleave","dragover","drop","input"],components:{ActionsBlock:Pe,LoopTile:un,EndBlockTile:Ct},props:{value:{type:Object,required:!0},type:{type:String,required:!0},active:{type:Boolean,default:!1},async:{type:Boolean,default:!1},collapsed:{type:Boolean,default:!1},dragging:{type:Boolean,default:!1},indent:{type:Number,default:0},isInsideLoop:{type:Boolean,default:!0},readOnly:{type:Boolean,default:!1},spacerBottom:{type:Boolean,default:!1},spacerTop:{type:Boolean,default:!1}},data(){return{dragging_:!1}},computed:{changeHandler(){return"for"===this.type?this.onForChange:"while"===this.type?this.onWhileChange:()=>{}},context_(){const e={...this.context},t=this.loop?.iterator?.trim();return t?.length&&(e[t]={source:"for"}),e},isDragging(){return this.dragging_||this.dragging},key(){return this.getKey(this.value)},loop(){return"for"===this.type?this.getFor(this.key):"while"===this.type?{condition:this.getWhile(this.key)}:{}},loopTileConf(){return{props:{...this.loop,active:this.active,context:this.context_,readOnly:this.readOnly,spacerBottom:this.spacerBottom,spacerTop:this.spacerTop,type:this.type},on:{change:this.changeHandler,delete:e=>this.$emit("delete",e),drag:this.onDragStart,dragend:this.onDragEnd,dragenterspacer:e=>this.$emit("dragenter",e),dragleavespacer:e=>this.$emit("dragleave",e),dragover:e=>this.$emit("dragover",e),dragoverspacer:e=>this.$emit("dragoverspacer",e),drop:this.onDrop}}}},methods:{onActionsChange(e){this.key&&!this.readOnly&&this.$emit("input",{[this.key]:e})},onForChange(e){const t=e?.iterable?.trim(),n=e?.iterator?.trim(),a=e?.async||!1;if(!this.key||this.readOnly||!t?.length||!n?.length)return;const i="for"+(a?"k":"");e=`${i} ${n} in \${${t}}`,this.$emit("input",{[e]:this.value[this.key]})},onWhileChange(e){if(e=e?.trim(),!this.key||this.readOnly||!e?.length)return;const t=`while \${${e}}`;this.$emit("input",{[t]:this.value[this.key]})},onDragStart(e){this.readOnly||(this.dragging_=!0,this.$emit("drag",e))},onDragEnd(e){this.dragging_=!1,this.$emit("dragend",e)},onDrop(e){this.readOnly||(this.dragging_=!1,this.$emit("drop",e))}}};const hn=(0,U.Z)(pn,[["render",At]]);var gn=hn;const mn={class:"tile-name"},vn=(0,a._)("span",{class:"icon"},[(0,a._)("i",{class:"fas fa-angle-right"})],-1),yn={class:"name"},fn=(0,a._)("span",{class:"keyword"},"return",-1),wn=["textContent"],bn={key:0,class:"editor-container"};function Dn(e,t,n,o,r,l){const d=(0,a.up)("Tile"),c=(0,a.up)("ExpressionEditor"),u=(0,a.up)("Modal"),p=(0,a.up)("ListItem");return(0,a.wg)(),(0,a.j4)(p,{class:"return-tile",value:n.value,active:n.active,"read-only":n.readOnly,"spacer-bottom":n.spacerBottom,"spacer-top":n.spacerTop,onInput:t[2]||(t[2]=t=>e.$emit("input",t))},{default:(0,a.w5)((()=>[(0,a.Wm)(d,(0,a.dG)(l.tileConf.props,(0,a.mx)(l.tileConf.on),{onClick:t[0]||(t[0]=(0,s.iM)((e=>r.showExprEditor=!0),["stop"]))}),{default:(0,a.w5)((()=>[(0,a._)("div",mn,[vn,(0,a._)("span",yn,[fn,(0,a.Uk)(),(0,a._)("span",{class:"code",textContent:(0,i.zw)(n.value)},null,8,wn)])])])),_:1},16),r.showExprEditor&&!n.readOnly?((0,a.wg)(),(0,a.iD)("div",bn,[(0,a.Wm)(u,{title:"Edit Return",visible:!0,onClose:t[1]||(t[1]=e=>r.showExprEditor=!1)},{default:(0,a.w5)((()=>[r.showExprEditor?((0,a.wg)(),(0,a.j4)(c,{key:0,value:n.value,"allow-empty":!0,context:e.context,quote:!0,placeholder:"Optional return value",ref:"exprEditor",onInput:(0,s.iM)(l.onExprChange,["prevent","stop"])},{default:(0,a.w5)((()=>[(0,a.Uk)(" Value or Expression ")])),_:1},8,["value","context","onInput"])):(0,a.kq)("",!0)])),_:1})])):(0,a.kq)("",!0)])),_:1},8,["value","active","read-only","spacer-bottom","spacer-top"])}var kn={mixins:[J.Z],emits:["change","click","delete","input"],components:{ExpressionEditor:ht,ListItem:ge,Modal:Q.Z,Tile:Oe},props:{value:{type:[String,Number,Boolean,Object,Array],default:""},active:{type:Boolean,default:!1},readOnly:{type:Boolean,default:!1},spacerBottom:{type:Boolean,default:!0},spacerTop:{type:Boolean,default:!0}},computed:{tileConf(){return{props:{value:this.value,class:"keyword",draggable:!1,readOnly:this.readOnly,withDelete:!this.readOnly},on:{delete:()=>this.$emit("delete"),input:this.onInput}}}},data(){return{showExprEditor:!1}},methods:{onExprChange(e){if(this.showExprEditor=!1,this.readOnly)return;const t=e.target.value?.trim();e.target.value=t,this.$emit("change",t)},onInput(e){e&&!this.readOnly&&this.$emit("input",e)}}};const xn=(0,U.Z)(kn,[["render",Dn]]);var Cn=xn;const _n=e=>((0,a.dD)("data-v-73c595c1"),e=e(),(0,a.Cn)(),e),$n=_n((()=>(0,a._)("div",{class:"tile-name"},[(0,a._)("span",{class:"icon"},[(0,a._)("i",{class:"fas fa-square-root-variable"})]),(0,a._)("span",{class:"name"},[(0,a._)("div",{class:"keyword"},"set")])],-1))),Bn={class:"variables"},En=["textContent"],On=["textContent"],Tn={key:0,class:"editor-container"},In={class:"name"},Sn=["onBlur","onUpdate:modelValue"],Vn={class:"value"},An={class:"variable"},Ln={class:"name"},jn={class:"value"},qn=_n((()=>(0,a._)("div",{class:"buttons"},[(0,a._)("button",{type:"submit",class:"btn btn-primary"}," Save ")],-1)));function Mn(e,t,n,o,r,l){const d=(0,a.up)("Tile"),c=(0,a.up)("ContextAutocomplete"),u=(0,a.up)("Modal"),p=(0,a.up)("ListItem");return(0,a.wg)(),(0,a.j4)(p,(0,a.dG)({class:["set-variables-tile",{active:n.active}],dragging:r.dragging_,value:n.value,active:n.active,"read-only":n.readOnly,"spacer-bottom":n.spacerBottom,"spacer-top":n.spacerTop},(0,a.mx)(l.dragListeners),{onInput:t[8]||(t[8]=t=>e.$emit("input",t))}),{default:(0,a.w5)((()=>[(0,a.Wm)(d,(0,a.dG)(l.tileConf.props,(0,a.mx)(l.tileConf.on),{draggable:!n.readOnly,onClick:t[0]||(t[0]=(0,s.iM)((e=>r.showEditor=!0),["stop"]))}),{default:(0,a.w5)((()=>[$n,(0,a._)("div",Bn,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.value,((e,t)=>((0,a.wg)(),(0,a.iD)("div",{class:"variable",key:t},[(0,a._)("span",{class:"code name",textContent:(0,i.zw)(t)},null,8,En),(0,a.Uk)(" = "),(0,a._)("span",{class:"code value",textContent:(0,i.zw)(e)},null,8,On)])))),128))])])),_:1},16,["draggable"]),r.showEditor&&!n.readOnly?((0,a.wg)(),(0,a.iD)("div",Tn,[(0,a.Wm)(u,{title:"Set Variables",visible:!0,onClose:t[7]||(t[7]=e=>r.showEditor=!1)},{default:(0,a.w5)((()=>[(0,a._)("form",{class:"editor",onSubmit:t[6]||(t[6]=(0,s.iM)(((...e)=>l.onChange&&l.onChange(...e)),["prevent"]))},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.newValue,((n,i)=>((0,a.wg)(),(0,a.iD)("div",{class:"variable",key:i},[(0,a._)("span",In,[(0,a.wy)((0,a._)("input",{type:"text",placeholder:"Variable Name",onBlur:e=>l.onBlur(i),onInput:t[1]||(t[1]=(0,s.iM)((()=>{}),["prevent","stop"])),"onUpdate:modelValue":e=>r.newValue[i][0]=e},null,40,Sn),[[s.nr,r.newValue[i][0]]]),(0,a.Uk)(" = ")]),(0,a._)("span",Vn,[(0,a.Wm)(c,{value:r.newValue[i][1],items:e.contextAutocompleteItems,quote:!0,"select-on-tab":!1,placeholder:"Value",onInput:(0,s.iM)((e=>r.newValue[i][1]=e.detail),["prevent","stop"])},null,8,["value","items","onInput"])])])))),128)),(0,a._)("div",An,[(0,a._)("span",Ln,[(0,a.wy)((0,a._)("input",{type:"text",placeholder:"Variable Name",ref:"newVarName",onInput:t[2]||(t[2]=(0,s.iM)((()=>{}),["prevent","stop"])),"onUpdate:modelValue":t[3]||(t[3]=e=>r.newVariable.name=e)},null,544),[[s.nr,r.newVariable.name]]),(0,a.Uk)(" = ")]),(0,a._)("span",jn,[(0,a.Wm)(c,{value:r.newVariable.value,items:e.contextAutocompleteItems,quote:!0,"select-on-tab":!1,placeholder:"Value",onInput:t[4]||(t[4]=(0,s.iM)((e=>r.newVariable.value=e.detail),["prevent","stop"])),onBlur:t[5]||(t[5]=e=>l.onBlur(null))},null,8,["value","items"])])]),qn],32)])),_:1})])):(0,a.kq)("",!0)])),_:1},16,["class","dragging","value","active","read-only","spacer-bottom","spacer-top"])}var Wn={mixins:[J.Z],emits:["click","delete","drag","dragend","dragenter","dragleave","dragover","drop","input"],components:{ContextAutocomplete:ct.Z,ListItem:ge,Modal:Q.Z,Tile:Oe},props:{active:{type:Boolean,default:!1},dragging:{type:Boolean,default:!1},readOnly:{type:Boolean,default:!1},spacerBottom:{type:Boolean,default:!0},spacerTop:{type:Boolean,default:!0},value:{type:Object,default:()=>({})}},computed:{dragListeners(){return this.readOnly?{}:{drag:this.onDragStart,dragend:this.onDragEnd,dragenter:e=>this.$emit("dragenter",e),dragleave:e=>this.$emit("dragleave",e),dragover:e=>this.$emit("dragover",e),drop:this.onDrop}},tileConf(){return{props:{value:this.value,class:"keyword",readOnly:this.readOnly,withDelete:!this.readOnly},on:{...this.dragListeners,delete:()=>this.$emit("delete"),input:this.onInput}}}},data(){return{dragging_:!1,newValue:[],newVariable:{name:"",value:""},showEditor:!1}},methods:{onChange(){if(this.showEditor=!1,this.readOnly)return;const e=this.newValue;this.newVariable.name?.trim?.()?.length&&e.push([this.newVariable.name,this.newVariable.value]);const t=e.map((([e,t])=>{e=this.sanitizeName(e);try{t=JSON.parse(t)}catch(n){t=t?.trim()}return[e,t]})).reduce(((e,[t,n])=>t?.length?(e[t]=n,e):e),{});Object.keys(t).length&&this.onInput(t)},onInput(e){e&&!this.readOnly&&this.$emit("input",{set:e})},onBlur(e){if(!this.readOnly)if(null!=e){const t=this.sanitizeName(this.newValue[e][0]);t?.length?this.newValue[e][0]=t:this.newValue.splice(e,1)}else{const e=this.sanitizeName(this.newVariable.name),t=this.newVariable.value;e?.length&&(this.newValue.push([e,t]),this.newVariable={name:"",value:""},this.$nextTick((()=>{this.$refs.newVarName?.focus()})))}},onDragStart(e){this.readOnly||(this.dragging_=!0,this.$emit("drag",e))},onDragEnd(e){this.dragging_=!1,this.$emit("dragend",e)},onDrop(e){this.dragging_=!1,this.readOnly||this.$emit("drop",e)},sanitizeName(e){return e?.trim()?.replace(/[^\w_]/g,"_")},syncValue(){this.newValue=Object.entries(this.value)}},watch:{showEditor(e){e?this.$nextTick((()=>{this.$refs.newVarName?.focus()})):this.newVariable={name:"",value:""}},value:{immediate:!0,handler(){this.syncValue()}}},mounted(){this.syncValue(),this.$nextTick((()=>{this.$refs.newVarName?.focus()}))}};const Zn=(0,U.Z)(Wn,[["render",Mn],["__scopeId","data-v-73c595c1"]]);var Nn=Zn,Hn={name:"ActionsList",mixins:[J.Z,ue.Z],emits:["add-else","change","collapse","drag","dragend","dragenter","dragleave","dragover","drop","input","reset","update"],components:{ActionsListItem:ye,ActionTile:ne,AddTile:Se,BreakTile:qe,ConditionBlock:Bt,ContinueTile:St,ListItem:ge,LoopBlock:gn,ReturnTile:Cn,SetVariablesTile:Nn},props:{collapsed:{type:Boolean,default:!1},dragging:{type:Boolean,default:!1},hasElse:{type:Boolean,default:!1},indent:{type:Number,default:0},isInsideLoop:{type:Boolean,default:!1},parent:{type:Object,default:null},readOnly:{type:Boolean,default:!1},value:{type:Object,default:()=>({name:void 0,actions:[]})}},data(){return{collapseAddButtons:!0,newValue:[],dragIndices:void 0,initialValue:void 0,newAction:{},spacerElements:{}}},computed:{collapsedBlocks(){return this.newValue.reduce(((e,t,n)=>this.isActionsBlock(t)?this.isDragging?(this.elses[n]?e[n]=this.dragBlockIndex===n-1:e[n]=this.dragBlockIndex===n,e):(e[n]=this.collapsed,e):e),{})},componentsData(){return this.newValue.map(((e,t)=>{let n={props:{value:e,active:this.isDragging,context:this.contexts[t],isInsideLoop:!!(this.isInsideLoop||this.getFor(e)||this.getWhile(e)),readOnly:this.readOnly,ref:`action-tile-${t}`,spacerBottom:this.visibleBottomSpacers[t],spacerTop:this.visibleTopSpacers[t]},on:{delete:()=>this.deleteAction(t),drag:e=>this.onDragStart(t,e),dragend:e=>this.onDragEnd(e),dragenter:e=>this.onDragEnter(t,e),dragleave:e=>this.onDragLeave(t,e),dragover:e=>this.onDragOver(e),drop:e=>{try{this.onDrop(t,e)}finally{this.isDragging=!1}},input:e=>this.editAction(e,t)}};this.getCondition(e)&&this.newValue[t+1]&&this.isElse(this.newValue[t+1])&&(n.props.hasElse=!0),this.isActionsBlock(e)&&(n.props.indent=this.indent+1);const a=this.getFor(e);a&&(n.props.async=a.async,n.props.type="for");const i=this.getWhile(e);return i&&(n.props.type="while"),this.isSet(e)&&(n.props.value=e.set),n}))},conditions(){return this.newValue?.reduce?.(((e,t,n)=>{const a=this.getCondition(t);return a&&(e[n]={condition:a,actions:t[Object.keys(t)[0]]}),e}),{})||{}},contexts(){const e={...this.context},t=this.newValue?.reduce?.(((t,n,a)=>(t[a]=this.getContext(n,a,e),t)),{})||{},n=Object.keys(t).length;return n>0?(t[n]=this.getContext(null,n,t[n-1]),t[n]={...this.context,...e,...t[n-1],...t[n]}):t[0]={...this.context},t},dragBlockIndex(){if(null!=this.dragIndex&&1===this.dragIndices?.length&&this.dragIndices[0]===this.dragIndex&&this.isActionsBlock(this.newValue[this.dragIndex]))return this.dragIndex},isDragging:{get(){return this.dragging||(this.dragIndices?.length||0)>0},set(e){e||(this.dragIndices=null)}},elses(){return this.newValue?.reduce?.(((e,t,n)=>(this.isElse(t)&&this.conditions[n-1]&&(e[n]=t[Object.keys(t)[0]]),e)),{})||{}},fors(){return this.newValue?.reduce?.(((e,t,n)=>(this.getFor(t)&&(e[n]=t),e)),{})||{}},whiles(){return this.newValue?.reduce?.(((e,t,n)=>(this.getWhile(t)&&(e[n]=t),e)),{})||{}},loops(){return[...Object.keys(this.fors),...Object.keys(this.whiles)].reduce(((e,t)=>(e[t]=this.newValue[t],e)),{})},sets(){return this.newValue?.reduce?.(((e,t,n)=>(this.isSet(t)&&(e[n]=t),e)),{})||{}},hasChanges(){return this.newStringValue!==this.stringValue},stringValue(){return JSON.stringify(this.value)},newStringValue(){return JSON.stringify(this.newValue)},dragIndex(){if(this.isDragging)return this.dragIndices?.[0]},breakIndex(){return this.getTileIndex((e=>this.isBreak(e)))},continueIndex(){return this.getTileIndex((e=>this.isContinue(e)))},returnIndex(){return this.getTileIndex((e=>this.isReturn(e)))},returnValue(){if(null==this.returnIndex)return"";const e=this.newValue[this.returnIndex];if(null==e)return"";let t=null;return t=Array.isArray(e)?1===e.length?e[0].match(/^return\s*(.*)$/)?.[1]:e:e.return,t||""},showAddButtons(){return 0===this.indent&&0===this.newValue.length||!this.collapseAddButtons},showAddButtonsExpander(){return!this.readOnly&&(this.newValue?.length>0||this.indent>0)&&Object.entries(this.visibleAddButtons).filter((([e,t])=>t&&"action"!=e)).length>1},stopIndex(){return null!=this.breakIndex?this.breakIndex:null!=this.continueIndex?this.continueIndex:null!=this.returnIndex?this.returnIndex:null},allowAddButtons(){return!this.readOnly&&!this.collapsed&&null==this.stopIndex},visibleActions(){return this.newValue.reduce(((e,t,n)=>(null!=this.stopIndex&&n>this.stopIndex||(this.conditions[n]||this.elses[n]||this.fors[n]||this.whiles[n]||this.isAction(t)||this.isBreak(t)||this.isContinue(t)||this.isReturn(t)||this.isSet(t))&&(e[n]=t),e)),{})},visibleAddButtons(){return{action:this.allowAddButtons,return:this.allowAddButtons,condition:this.allowAddButtons,for:this.allowAddButtons,while:this.allowAddButtons,set:this.allowAddButtons,else:this.allowAddButtons&&this.parent&&this.getCondition(this.parent)&&!this.hasElse,break:this.allowAddButtons&&this.isInsideLoop,continue:this.allowAddButtons&&this.isInsideLoop}},visibleTopSpacers(){const e=this.dragIndex;return this.newValue.reduce(((t,n,a)=>(t[a]=!this.isElse(n)&&(null==e||e>a||e===a&&this.dragIndices.length>1),t)),{})},visibleBottomSpacers(){const e=this.dragIndex;return this.newValue.reduce(((t,n,a)=>(t[a]=null!=e&&(e<a||e===a&&this.dragIndices.length>1)||null==e&&a===this.newValue.length-1,t)),{})}},methods:{onDragStart(e,t){this.readOnly||(t=Array.isArray(t)?[e,...t]:[e],this.dragIndices=t,this.$emit("drag",t))},onDragEnd(){this.isDragging=!1,this.$emit("dragend")},onDragEnter(e,t){this.isDragging&&!this.readOnly&&(t.stopPropagation?.(),this.$emit("dragenter",e))},onDragLeave(e,t){this.isDragging&&!this.readOnly&&(t.stopPropagation?.(),this.$emit("dragleave",e))},onDragOver(e){this.$emit("dragover",e)},onDrop(e,t){if(!this.isDragging||null==t||null==e||this.readOnly)return;t.stopPropagation?.();let n=[];if(n=t.detail?.length?[e,...t.detail]:[e],t=new CustomEvent("drop",{bubbles:!1,cancelable:!0,detail:n}),this.indent>0)return void this.$emit("drop",t);const a=this.dragIndices.slice(-1)[0];e=t.detail.slice(-1)[0];const i=this.getParentBlock(this.dragIndices),s=this.getParentBlock(n);if(!i||!s)return;const o=i?.[a],r=s?.[e];if(!o)return;const l=this.getCondition(o)&&this.isElse(i[a+1])?2:1;this.isElse(r)&&(e+=1),s.splice(e,0,...i.splice(a,l)),this.$emit("input",this.newValue)},onCollapse(){this.$emit("collapse")},getContext(e,t,n){const a={...n||this.context||{}};t>0&&(a.output={source:"action",action:this.newValue[t-1]}),this.isSet(e)&&Object.keys(e.set).forEach((e=>{e?.length&&(n[e]={source:"local"})}));const i=this.getFor(e)?.iterator;return i?.length&&(n[i]={source:"for"}),a},getParentBlock(e){e=[...e];let t=this.newValue;while(t&&e.length>1)if(t=t[e.shift()],t){const e=this.getKey(t);e&&(t=t[e])}return t},editAction(e,t){e?.target&&e.stopPropagation?e.stopPropagation?.():(this.newValue[t]=e,this.$emit("input",this.newValue))},addAction(e){this.newValue.push({...e,action:e.name||e.action})},addCondition(){this.newValue.push({"if ${True}":[]}),this.selectLastExprEditor()},addForLoop(){this.newValue.push({"for _ in ${range(10)}":[]}),this.selectLastExprEditor()},addWhileLoop(){this.newValue.push({"while ${True}":[]}),this.selectLastExprEditor()},addBreak(){this.newValue.push("break")},addContinue(){this.newValue.push("continue")},addSet(){this.newValue.push({set:{}}),this.selectLastExprEditor()},addReturn(){this.newValue.push({return:null}),this.selectLastExprEditor()},editReturn(e){this.newValue[this.returnIndex]={return:e?.length?e:null}},selectLastExprEditor(){this.$nextTick((()=>{const e=this.$refs["action-tile-"+(this.newValue.length-1)]?.[0];if(!e)return;const t=e.$el?.querySelector(".tile");t&&(t.click(),this.$nextTick((()=>{const t=e.$el?.querySelector(".editor-container");if(!t)return;const n=t.querySelector('input[type="text"]');n&&(n.value="",n.focus())})))}))},addElse(){this.newValue.push({else:[]})},deleteAction(e){const t=this.getCondition(this.newValue[e])&&this.isElse(this.newValue?.[e+1])?2:1,n=this.$refs[`action-tile-${e}`]?.[0]?.$el;n?(n.classList.add("shrink"),setTimeout((()=>{n.classList.remove("shrink"),this.newValue.splice(e,t)}),300)):this.newValue.splice(e,t)},getTileIndex(e){const t=this.newValue?.reduce?.(((t,n,a)=>t>=0?t:e(n)?a:t),-1);return t>=0?t:null},syncSpacers(){this.$nextTick((()=>{this.spacerElements=Object.keys(this.newValue).reduce(((e,t)=>(e[t]=this.$refs[`dropTarget_${t}`]?.[0],e)),{})}))},syncValue(){this.value&&this.hasChanges&&(this.newValue=this.value)}},watch:{newValue:{deep:!0,handler(e){this.$emit("input",e),this.syncSpacers()}},dragIndices(){this.syncSpacers()},value:{immediate:!0,deep:!0,handler(){this.syncValue()}}},mounted(){this.syncValue(),this.syncSpacers()},updated(){this.hasChanges&&this.$emit("update",this.newValue)}};const Un=(0,U.Z)(Hn,[["render",x],["__scopeId","data-v-74ca2010"]]);var Gn=Un},2544:function(e,t,n){n.d(t,{Z:function(){return h}});var a=n(6252),i=n(9963);const s=e=>((0,a.dD)("data-v-0bc64e95"),e=e(),(0,a.Cn)(),e),o=s((()=>(0,a._)("i",{class:"fas fa-clipboard"},null,-1))),r=[o];function l(e,t,n,s,o,l){return(0,a.wg)(),(0,a.iD)("button",{class:"copy-button",ref:"copyButton",title:"Copy to clipboard",onClick:t[0]||(t[0]=(0,i.iM)(((...e)=>l.copy&&l.copy(...e)),["prevent"])),onInput:t[1]||(t[1]=(0,i.iM)(((...e)=>l.copy&&l.copy(...e)),["prevent"]))},r,544)}var d=n(8637),c={name:"CopyButton",emits:["input","click"],mixins:[d.Z],props:{text:{type:String}},methods:{async copy(e){this.text?.length&&await this.copyToClipboard(this.text),this.$emit(e.type,e)}}},u=n(3744);const p=(0,u.Z)(c,[["render",l],["__scopeId","data-v-0bc64e95"]]);var h=p},2126:function(e,t,n){n.d(t,{Z:function(){return p}});var a=n(6252),i=n(3577);const s=["href"],o=["src","alt","title"],r=["src","alt","title"];function l(e,t,n,l,d,c){return(0,a.wg)(),(0,a.iD)("div",{class:"extension-icon",style:(0,i.j5)({width:`${n.size}`,height:`${n.size}`})},[n.withDocsLink?((0,a.wg)(),(0,a.iD)("a",{key:0,href:c.docsUrl,target:"_blank"},[(0,a._)("img",{src:c.iconUrl,alt:c.extensionName,title:c.extensionName},null,8,o)],8,s)):((0,a.wg)(),(0,a.iD)("img",{key:1,src:c.iconUrl,alt:c.extensionName,title:c.extensionName},null,8,r))],4)}var d={props:{name:{type:String,required:!0},size:{type:String,default:"1.75em"},withDocsLink:{type:Boolean,default:!1}},computed:{iconUrl(){return`https://static.platypush.tech/icons/${this.extensionName}-64.png`},extensionType(){return"backend"==this.name.split(".")[0]?"backend":"plugin"},extensionName(){const e=this.name.split(".");return e.length<1?this.name:("backend"==e[0]&&e.shift(),e.join("."))},docsUrl(){return`https://docs.platypush.tech/platypush/${this.extensionType}s/${this.extensionName}.html`}}},c=n(3744);const u=(0,c.Z)(d,[["render",l],["__scopeId","data-v-0353c248"]]);var p=u}}]);
//# sourceMappingURL=1019.43351d3d.js.map