"use strict";(self["webpackChunkplatypush"]=self["webpackChunkplatypush"]||[]).push([[2018],{2544:function(e,n,t){t.d(n,{Z:function(){return g}});var s=t(6252),i=t(9963);const l=e=>((0,s.dD)("data-v-0bc64e95"),e=e(),(0,s.Cn)(),e),o=l((()=>(0,s._)("i",{class:"fas fa-clipboard"},null,-1))),a=[o];function c(e,n,t,l,o,c){return(0,s.wg)(),(0,s.iD)("button",{class:"copy-button",ref:"copyButton",title:"Copy to clipboard",onClick:n[0]||(n[0]=(0,i.iM)(((...e)=>c.copy&&c.copy(...e)),["prevent"])),onInput:n[1]||(n[1]=(0,i.iM)(((...e)=>c.copy&&c.copy(...e)),["prevent"]))},a,544)}var r=t(8637),u={name:"CopyButton",emits:["input","click"],mixins:[r.Z],props:{text:{type:String}},methods:{async copy(e){this.text?.length&&await this.copyToClipboard(this.text),this.$emit(e.type,e)}}},d=t(3744);const h=(0,d.Z)(u,[["render",c],["__scopeId","data-v-0bc64e95"]]);var g=h},2126:function(e,n,t){t.d(n,{Z:function(){return h}});var s=t(6252),i=t(3577);const l=["href"],o=["src","alt","title"],a=["src","alt","title"];function c(e,n,t,c,r,u){return(0,s.wg)(),(0,s.iD)("div",{class:"extension-icon",style:(0,i.j5)({width:`${t.size}`,height:`${t.size}`})},[t.withDocsLink?((0,s.wg)(),(0,s.iD)("a",{key:0,href:u.docsUrl,target:"_blank"},[(0,s._)("img",{src:u.iconUrl,alt:u.extensionName,title:u.extensionName},null,8,o)],8,l)):((0,s.wg)(),(0,s.iD)("img",{key:1,src:u.iconUrl,alt:u.extensionName,title:u.extensionName},null,8,a))],4)}var r={props:{name:{type:String,required:!0},size:{type:String,default:"1.75em"},withDocsLink:{type:Boolean,default:!1}},computed:{iconUrl(){return`https://static.platypush.tech/icons/${this.extensionName}-64.png`},extensionType(){return"backend"==this.name.split(".")[0]?"backend":"plugin"},extensionName(){const e=this.name.split(".");return e.length<1?this.name:("backend"==e[0]&&e.shift(),e.join("."))},docsUrl(){return`https://docs.platypush.tech/platypush/${this.extensionType}s/${this.extensionName}.html`}}},u=t(3744);const d=(0,u.Z)(r,[["render",c],["__scopeId","data-v-0353c248"]]);var h=d},2018:function(e,n,t){t.r(n),t.d(n,{default:function(){return qe}});var s=t(6252),i=t(9963),l=t(3577);const o={class:"row plugin extensions-container"},a={class:"filter-container"},c=["disabled"],r={class:"items"},u={key:0,class:"extension"},d=["data-name","onClick"],h={class:"name"},g={key:0,class:"enabled icon",title:"Enabled"},p={key:0,class:"enabled icon fas fa-circle-check"},f={key:0,class:"extension-body-container until tablet"},m={key:0,class:"extension-body-container from desktop"};function x(e,n,t,x,b,k){const y=(0,s.up)("Loading"),_=(0,s.up)("ExtensionIcon"),w=(0,s.up)("Extension");return(0,s.wg)(),(0,s.iD)("div",o,[b.loading?((0,s.wg)(),(0,s.j4)(y,{key:0})):(0,s.kq)("",!0),(0,s._)("header",null,[(0,s._)("div",a,[(0,s.wy)((0,s._)("input",{type:"text",ref:"filter",placeholder:"Extension name","onUpdate:modelValue":n[0]||(n[0]=e=>b.filter=e),disabled:b.loading},null,8,c),[[i.nr,b.filter]])])]),(0,s._)("main",null,[(0,s._)("div",r,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(k.extensionNames,(e=>((0,s.wg)(),(0,s.iD)("div",{class:"extension-container",key:e},[k.matchesFilter(e)?((0,s.wg)(),(0,s.iD)("div",u,[(0,s._)("div",{class:(0,l.C_)(["item",{selected:e===b.selectedExtension}]),"data-name":e,onClick:n=>k.onClick(e,!1)},[(0,s.Wm)(_,{name:e,size:"1.75em"},null,8,["name"]),(0,s._)("span",h,(0,l.zw)(k.extensions[e].name),1),k.enabledExtensions[e]?((0,s.wg)(),(0,s.iD)("span",g,[k.enabledExtensions[e]?((0,s.wg)(),(0,s.iD)("i",p)):(0,s.kq)("",!0)])):(0,s.kq)("",!0)],10,d),b.selectedExtension&&e===b.selectedExtension?((0,s.wg)(),(0,s.iD)("div",f,[(0,s.Wm)(w,{extension:k.extensions[b.selectedExtension],config:k.enabledExtensions[b.selectedExtension],"config-file":b.configFile},null,8,["extension","config","config-file"])])):(0,s.kq)("",!0)])):(0,s.kq)("",!0)])))),128))]),b.selectedExtension?((0,s.wg)(),(0,s.iD)("div",m,[(0,s.Wm)(w,{extension:k.extensions[b.selectedExtension],config:k.enabledExtensions[b.selectedExtension],"config-file":b.configFile},null,8,["extension","config","config-file"])])):(0,s.kq)("",!0)])])}const b=e=>((0,s.dD)("data-v-3fa6b036"),e=e(),(0,s.Cn)(),e),k={class:"extension"},y=b((()=>(0,s._)("span",{class:"from tablet"},"Documentation",-1))),_=b((()=>(0,s._)("span",{class:"from tablet"},"Install",-1))),w=b((()=>(0,s._)("span",{class:"from tablet"},"Configuration",-1))),C={class:"extension-body"};function v(e,n,t,i,l,o){const a=(0,s.up)("Tab"),c=(0,s.up)("Tabs"),r=(0,s.up)("Doc"),u=(0,s.up)("Config"),d=(0,s.up)("Install");return(0,s.wg)(),(0,s.iD)("div",k,[(0,s._)("header",null,[(0,s.Wm)(c,null,{default:(0,s.w5)((()=>[(0,s.Wm)(a,{selected:"doc"===l.selectedTab,"icon-class":"fas fa-book",onInput:n[0]||(n[0]=e=>l.selectedTab="doc")},{default:(0,s.w5)((()=>[y])),_:1},8,["selected"]),(0,s.Wm)(a,{selected:"install"===l.selectedTab,"icon-class":"fas fa-download",onInput:n[1]||(n[1]=e=>l.selectedTab="install")},{default:(0,s.w5)((()=>[_])),_:1},8,["selected"]),(0,s.Wm)(a,{selected:"config"===l.selectedTab,"icon-class":"fas fa-square-check",onInput:n[2]||(n[2]=e=>l.selectedTab="config")},{default:(0,s.w5)((()=>[w])),_:1},8,["selected"])])),_:1})]),(0,s._)("div",C,["doc"===l.selectedTab?((0,s.wg)(),(0,s.j4)(r,{key:0,extension:t.extension},null,8,["extension"])):"config"===l.selectedTab?((0,s.wg)(),(0,s.j4)(u,{key:1,extension:t.extension,config:t.config,"config-file":t.configFile},null,8,["extension","config","config-file"])):"install"===l.selectedTab?((0,s.wg)(),(0,s.j4)(d,{key:2,extension:t.extension},null,8,["extension"])):(0,s.kq)("",!0)])])}var D=t(8735),E=t(3176);const $={key:0,class:"config-container current"},q=["innerHTML"],I=["innerHTML"];function T(e,n,t,i,o,a){const c=(0,s.up)("CopyButton");return(0,s.wg)(),(0,s.iD)(s.HY,null,[a.highlightedCurrentConfig?((0,s.wg)(),(0,s.iD)("div",$,[(0,s.Wm)(c,{text:o.curYamlConfig},null,8,["text"]),(0,s._)("pre",null,[(0,s._)("code",{class:"config-snippet",innerHTML:a.highlightedCurrentConfig},null,8,q)])])):(0,s.kq)("",!0),(0,s._)("div",{class:(0,l.C_)(["config-container snippet",{fullscreen:!a.highlightedCurrentConfig}])},[(0,s.Wm)(c,{text:t.extension.config_snippet},null,8,["text"]),(0,s._)("pre",null,[(0,s._)("code",{class:"config-snippet",innerHTML:a.highlightedConfigSnippet},null,8,I)])],2)],64)}t(8783),t(3465);var O=t(637),j=t(2544),Z=t(8637),L={name:"Extension",mixins:[Z.Z],components:{CopyButton:j.Z},props:{extension:{type:Object,required:!0},config:{type:Object},configFile:{type:String}},data(){return{curYamlConfig:null}},computed:{highlightedConfigSnippet(){return O.Z.highlight(`# Configuration template. You can add it to ${this.configFile}\n`+this.extension.config_snippet,{language:"yaml"}).value.trim()},highlightedCurrentConfig(){return this.curYamlConfig?O.Z.highlight("yaml","# Currently loaded configuration\n"+this.curYamlConfig).value.trim():null}},methods:{async loadCurrentConfig(){this.config?this.curYamlConfig=await this.request("utils.to_yaml",{obj:{[this.extension.name]:this.config}}):this.curYamlConfig=null}},mounted(){this.loadCurrentConfig(),this.$watch("config",this.loadCurrentConfig)}},U=t(3744);const W=(0,U.Z)(L,[["render",T],["__scopeId","data-v-4634d8cb"]]);var F=W;const N=e=>((0,s.dD)("data-v-49986d05"),e=e(),(0,s.Cn)(),e),R={class:"doc"},z=["href"],H=["textContent"],B=["innerHTML"],M={key:0,class:"actions"},S=N((()=>(0,s._)("h3",null,[(0,s._)("i",{class:"icon fas fa-play"}),(0,s.Uk)("   Actions ")],-1))),Y=["href"],P={key:1,class:"events"},A=N((()=>(0,s._)("h3",null,[(0,s._)("i",{class:"icon fas fa-flag"}),(0,s.Uk)("   Events ")],-1))),K=["href"];function V(e,n,t,i,o,a){const c=(0,s.up)("ExtensionIcon");return(0,s.wg)(),(0,s.iD)("section",R,[(0,s._)("header",null,[(0,s._)("h2",null,[(0,s._)("a",{class:"title",href:t.extension.doc_url,target:"_blank"},[(0,s.Wm)(c,{name:t.extension.name,size:"2em","with-docs-link":""},null,8,["name"]),(0,s._)("span",{class:"name",textContent:(0,l.zw)(t.extension.name)},null,8,H)],8,z)])]),o.doc?((0,s.wg)(),(0,s.iD)("article",{key:0,onClick:n[0]||(n[0]=(...e)=>a.onDocClick&&a.onDocClick(...e))},[(0,s._)("div",{class:"doc-content",innerHTML:o.doc},null,8,B),Object.keys(t.extension.actions||{}).length>0?((0,s.wg)(),(0,s.iD)("div",M,[S,(0,s._)("ul",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.actionNames,(e=>((0,s.wg)(),(0,s.iD)("li",{class:"action",key:e},[(0,s._)("a",{href:`/#execute?action=${t.extension.name}.${e}`},(0,l.zw)(t.extension.name)+"."+(0,l.zw)(e),9,Y)])))),128))])])):(0,s.kq)("",!0),Object.keys(t.extension.events||{}).length>0?((0,s.wg)(),(0,s.iD)("div",P,[A,(0,s._)("ul",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.eventNames,(e=>((0,s.wg)(),(0,s.iD)("li",{class:"event",key:e},[(0,s._)("a",{href:t.extension.events[e].doc_url,target:"_blank"},(0,l.zw)(e),9,K)])))),128))])])):(0,s.kq)("",!0)])):(0,s.kq)("",!0)])}var G=t(2126),J=t(5250),Q={name:"Doc",mixins:[Z.Z],components:{ExtensionIcon:G.Z},props:{extension:{type:Object,required:!0}},data(){return{doc:null,localPageRegex:new RegExp("^/?#.*$")}},computed:{actionNames(){return Object.keys(this.extension.actions).sort()},eventNames(){return Object.keys(this.extension.events).sort()}},methods:{async parseDoc(){return this.extension.doc?.length?await this.request("utils.rst_to_html",{text:this.extension.doc}):null},refreshDoc(){this.parseDoc().then((e=>this.doc=e))},onDocClick(e){if("a"!==e.target.tagName.toLowerCase())return!0;e.preventDefault();const n=e.target.getAttribute("href");if(!n)return!0;if(n.match(this.localPageRegex))return window.location.href=n,!0;const t=n.match(/^https:\/\/docs\.platypush\.tech\/platypush\/(plugins|backend)\/([\w.]+)\.html#?.*$/);if(!t)return e.preventDefault(),window.open(n,"_blank"),!0;let[s,i]=t.slice(1);"backend"===s&&(i=`backend.${i}`),J.$.emit("update:extension",i),e.preventDefault()}},mounted(){this.refreshDoc(),this.$watch("extension.doc",this.refreshDoc)}};const X=(0,U.Z)(Q,[["render",V],["__scopeId","data-v-49986d05"]]);var ee=X;const ne=e=>((0,s.dD)("data-v-5e00060c"),e=e(),(0,s.Cn)(),e),te={class:"install-container"},se={class:"top"},ie=ne((()=>(0,s._)("header",null,[(0,s._)("h2",null,"Dependencies")],-1))),le={class:"body"},oe={class:"container install-cmd-container"},ae=["innerHTML"],ce={key:0,class:"buttons install-btn"},re=["disabled"],ue=ne((()=>(0,s._)("i",{class:"fas fa-download"},null,-1))),de={key:0,class:"bottom"},he=ne((()=>(0,s._)("header",null,[(0,s._)("h2",null,"Output")],-1))),ge={class:"body"},pe={class:"container install-output",ref:"installOutput"},fe=["textContent"],me={key:0,class:"loading-container"};function xe(e,n,t,i,o,a){const c=(0,s.up)("CopyButton"),r=(0,s.up)("Loading"),u=(0,s.up)("RestartButton");return(0,s.wg)(),(0,s.iD)("div",te,[(0,s._)("section",se,[ie,(0,s._)("div",le,[(0,s._)("div",oe,[a.installCmd?((0,s.wg)(),(0,s.j4)(c,{key:0,text:a.installCmd},null,8,["text"])):(0,s.kq)("",!0),(0,s._)("pre",null,[o.loading?((0,s.wg)(),(0,s.j4)(r,{key:0})):((0,s.wg)(),(0,s.iD)("code",{key:1,innerHTML:a.highlightedInstallCmd},null,8,ae))])]),a.installCmd?((0,s.wg)(),(0,s.iD)("div",ce,[o.installDone?((0,s.wg)(),(0,s.j4)(u,{key:0})):(0,s.kq)("",!0),(0,s._)("button",{type:"button",class:"btn btn-default",disabled:o.installRunning,onClick:n[0]||(n[0]=(...e)=>a.installExtension&&a.installExtension(...e))},[ue,(0,s.Uk)(" Install ")],8,re)])):(0,s.kq)("",!0)])]),o.installRunning||o.installOutput?((0,s.wg)(),(0,s.iD)("section",de,[he,(0,s._)("div",ge,[(0,s._)("div",pe,[(0,s.Wm)(c,{text:o.installOutput},null,8,["text"]),(0,s._)("pre",null,[(0,s._)("code",{textContent:(0,l.zw)(o.installOutput)},null,8,fe),o.installRunning?((0,s.wg)(),(0,s.iD)("div",me,[(0,s.Uk)("\n            "),(0,s.Wm)(r),(0,s.Uk)("\n          ")])):(0,s.kq)("",!0)])],512)])])):(0,s.kq)("",!0)])}var be=t(6791),ke=t(2717),ye={name:"Install",mixins:[Z.Z],emit:["install-start","install-end"],components:{CopyButton:j.Z,Loading:be.Z,RestartButton:ke.Z},props:{extension:{type:Object,required:!0}},data(){return{installRunning:!1,installDone:!1,installOutput:null,installCmds:[],pendingCommands:0,error:null,loading:!1}},computed:{installCmd(){return this.installCmds.length?this.installCmds.join("\n").trim():null},highlightedInstallCmd(){return O.Z.highlight(this.installCmd?this.installCmds.map((e=>`$ ${e}`)).join("\n").trim():"# No extra installation steps required",{language:"bash"}).value}},methods:{wsProcess(e){try{const n="https:"===window.location.protocol?"wss":"ws",t=`${n}://${location.host}${e}`,s=new WebSocket(t);s.onmessage=this.onMessage,s.onerror=this.onError,s.onclose=this.onClose}catch(n){this.notify({error:!0,title:"Websocket initialization error",text:n.toString()}),console.error("Websocket initialization error"),console.error(n),this.error=n,this.installRunning=!1}},onMessage(e){this.installOutput||(this.installOutput=""),this.installOutput+=e.data},onClose(){this.installRunning=!1,this.$emit("install-end",this.extension),this.error||(this.installDone=!0),this.notify({title:"Extension installed",html:`Extension <b>${this.extension.name}</b> installed successfully`,image:{iconClass:"fas fa-check"}})},onError(e){this.notify({error:!0,title:"Websocket error",text:e.toString()}),console.error("Websocket error"),console.error(e),this.error=e,this.installRunning=!1},installExtension(){if(!this.installCmd)return;this.error=null,this.installRunning=!0,this.installOutput="",this.$emit("install-start",this.extension);const e=this.installCmds.join(";\n");this.request("shell.exec",{cmd:e,ws:!0}).then((e=>{this.wsProcess(e.ws_path)})).catch((e=>{this.error=e,this.installRunning=!1,this.$emit("install-end",this.extension)}))},async refreshInstallCmds(){this.loading=!0;try{this.installCmds=await this.request("application.get_install_commands",{extension:this.extension.name})}finally{this.loading=!1}}},mounted(){this.refreshInstallCmds(),this.$watch("extension.name",(()=>{this.refreshInstallCmds()})),this.$watch("installOutput",(()=>{this.$nextTick((()=>{this.$refs.installOutput.focus(),this.$refs.installOutput.scrollTop=this.$refs.installOutput.scrollHeight}))}))}};const _e=(0,U.Z)(ye,[["render",xe],["__scopeId","data-v-5e00060c"]]);var we=_e,Ce={name:"Extension",components:{Config:F,Doc:ee,Install:we,Tab:D.Z,Tabs:E.Z},props:{extension:{type:Object,required:!0},config:{type:Object},configFile:{type:String}},data(){return{selectedTab:"doc"}}};const ve=(0,U.Z)(Ce,[["render",v],["__scopeId","data-v-3fa6b036"]]);var De=ve,Ee={name:"Extensions",mixins:[Z.Z],components:{Extension:De,ExtensionIcon:G.Z,Loading:be.Z},data(){return{loading:!1,plugins:{},backends:{},enabledPlugins:{},enabledBackends:{},filter:"",selectedExtension:null,configFile:null,config:{}}},computed:{extensions(){const e={};return Object.entries(this.plugins).forEach((([n,t])=>{e[n]={...t,name:n}})),Object.entries(this.backends).forEach((([n,t])=>{n=`backend.${n}`,e[n]={...t,name:n}})),e},enabledExtensions(){return[this.enabledPlugins,this.enabledBackends].reduce(((e,n)=>(Object.entries(n).forEach((([n,t])=>{e[n]=t})),e)),{})},extensionNames(){return Object.keys(this.extensions).sort()}},methods:{onClick(e,n=!0,t=!0){this.selectedExtension===e?this.selectedExtension=null:this.onInput(e,n,t)},onInput(e,n=!0,t=!0){n&&(this.filter=e);const s=e?.toLowerCase()?.trim();if(s?.length&&this.extensions[s]){this.selectedExtension=s,t&&this.setUrlArgs({extension:s});const e=this.$el.querySelector(`.extensions-container .item[data-name="${s}"]`);e&&e.scrollIntoView({behavior:"smooth"})}else this.selectedExtension=null,t&&this.setUrlArgs({})},matchesFilter(e){return!this.filter||e.includes(this.filter.toLowerCase())},async loadExtensions(){this.loading=!0;let[e,n]=[[],[]];try{[this.plugins,this.backends,e,n,this.config]=await Promise.all([this.request("inspect.get_all_plugins"),this.request("inspect.get_all_backends"),this.request("inspect.get_enabled_plugins"),this.request("inspect.get_enabled_backends"),this.request("inspect.get_config")])}finally{this.loading=!1}this.enabledPlugins=e.reduce(((e,n)=>(e[n]=this.config[n]||{},e)),{}),this.enabledBackends=n.reduce(((e,n)=>(n=`backend.${n}`,e[n]=this.config[n]||{},e)),{}),this.loadExtensionFromUrl(),this.$watch("$route.hash",(()=>this.loadExtensionFromUrl()))},async loadConfigFile(){this.configFile=await this.request("config.get_config_file")},loadExtensionFromUrl(){const e=this.getUrlArgs().extension;e&&this.$nextTick((()=>this.onInput(e,!1,!1)))}},mounted(){this.loadConfigFile(),this.loadExtensions(),J.$.on("update:extension",(e=>this.onInput(e,!1))),this.$nextTick((()=>this.$refs.filter.focus()))}};const $e=(0,U.Z)(Ee,[["render",x],["__scopeId","data-v-74d75ec7"]]);var qe=$e}}]);
//# sourceMappingURL=2018.e1049da7.js.map