"use strict";(self["webpackChunkplatypush"]=self["webpackChunkplatypush"]||[]).push([[8010,3862],{4904:function(e,t,n){n.d(t,{Z:function(){return k}});var s=n(6252),o=n(9963),a=n(3577);const i={class:"dropdown-container"},r=["title"],l=["textContent"],d={class:"body-container hidden",ref:"dropdownContainer"};function c(e,t,n,c,u,p){const h=(0,s.up)("DropdownBody");return(0,s.wg)(),(0,s.iD)("div",i,[(0,s._)("button",{title:n.title,ref:"button",onClick:t[0]||(t[0]=(0,o.iM)((e=>p.toggle(e)),["stop"]))},[n.iconClass?((0,s.wg)(),(0,s.iD)("i",{key:0,class:(0,a.C_)(["icon",n.iconClass])},null,2)):(0,s.kq)("",!0),n.text?((0,s.wg)(),(0,s.iD)("span",{key:1,class:"text",textContent:(0,a.zw)(n.text)},null,8,l)):(0,s.kq)("",!0)],8,r),(0,s._)("div",d,[(0,s.Wm)(h,{id:n.id,keepOpenOnItemClick:n.keepOpenOnItemClick,ref:"dropdown",onClick:p.onClick},{default:(0,s.w5)((()=>[(0,s.WI)(e.$slots,"default",{},void 0,!0)])),_:3},8,["id","keepOpenOnItemClick","onClick"])],512)])}const u=["id"];function p(e,t,n,o,a,i){return(0,s.wg)(),(0,s.iD)("div",{class:"dropdown",id:n.id,onClick:t[0]||(t[0]=t=>e.$emit("click",t))},[(0,s.WI)(e.$slots,"default",{},void 0,!0)],8,u)}var h={emits:["click"],props:{id:{type:String},keepOpenOnItemClick:{type:Boolean,default:!1}}},f=n(3744);const g=(0,f.Z)(h,[["render",p],["__scopeId","data-v-14579c63"]]);var m=g,w=n(5250),y={components:{DropdownBody:m},emits:["click"],props:{id:{type:String},iconClass:{default:"fa fa-ellipsis-h"},text:{type:String},title:{type:String},keepOpenOnItemClick:{type:Boolean,default:!1}},data(){return{visible:!1}},computed:{buttonStyle(){return this.$refs.button?getComputedStyle(this.$refs.button):{}},buttonWidth(){return parseFloat(this.buttonStyle.width||0)},buttonHeight(){return parseFloat(this.buttonStyle.height||0)}},methods:{documentClickHndl(e){if(!this.visible)return;let t=e.target;while(t){if(t.classList.contains("dropdown"))return;t=t.parentElement}this.close()},getDropdownWidth(){const e=this.$refs.dropdown?.$el;return e?parseFloat(getComputedStyle(e).width):0},getDropdownHeight(){const e=this.$refs.dropdown?.$el;return e?parseFloat(getComputedStyle(e).height):0},onClick(e){return this.keepOpenOnItemClick||this.close(),"A"===e.target.tagName?(e.preventDefault(),!1):e.defaultPrevented?(e.stopPropagation(),!1):void 0},close(){this.visible=!1,document.removeEventListener("click",this.documentClickHndl),w.$.emit("dropdown-close")},open(){document.addEventListener("click",this.documentClickHndl);const e=this.$refs.dropdown?.$el;e.parentElement||this.$el.appendChild(e),this.visible=!0,this.$refs.dropdownContainer.classList.remove("hidden"),this.$nextTick((()=>{const e=this.$refs.button.getBoundingClientRect(),t={left:e.left+window.scrollX,top:e.top+window.scrollY},n={left:t.left,top:t.top+this.buttonHeight},s=this.getDropdownWidth(),o=this.getDropdownHeight();n.left+s>(window.innerWidth+window.scrollX)/2&&(n.left-=s-this.buttonWidth),n.top+o>(window.innerHeight+window.scrollY)/2&&(n.top-=o+this.buttonHeight-10);const a=this.$refs.dropdown.$el;a.classList.add("fade-in"),a.style.top=`${n.top}px`,a.style.left=`${n.left}px`,w.$.emit("dropdown-open",this.$refs.dropdown),this.$refs.dropdownContainer.classList.add("hidden")}))},toggle(e){e.stopPropagation(),this.$emit("click"),this.visible?this.close():this.open()},onKeyUp(e){e.stopPropagation(),"Escape"===e.key&&this.close()}},mounted(){document.body.addEventListener("keyup",this.onKeyUp)},unmounted(){document.body.removeEventListener("keyup",this.onKeyUp)}};const b=(0,f.Z)(y,[["render",c],["__scopeId","data-v-f096e0a0"]]);var k=b},7597:function(e,t,n){n.d(t,{Z:function(){return f}});var s=n(6252),o=n(3577);const a=["title"],i={key:0,class:"col-2 icon"},r=["textContent"];function l(e,t,n,l,d,c){const u=(0,s.up)("Icon");return(0,s.wg)(),(0,s.iD)("div",{class:(0,o.C_)(["row item",{...c.itemClass_,disabled:n.disabled}]),title:n.hoverText,onClick:t[0]||(t[0]=(...e)=>c.clicked&&c.clicked(...e))},[n.iconClass?.length||n.iconUrl?.length?((0,s.wg)(),(0,s.iD)("div",i,[(0,s.Wm)(u,{class:(0,o.C_)(n.iconClass),url:n.iconUrl},null,8,["class","url"])])):(0,s.kq)("",!0),(0,s._)("div",{class:(0,o.C_)(["text",{"col-10":null!=n.iconClass}]),textContent:(0,o.zw)(n.text)},null,10,r)],10,a)}var d=n(657),c=n(5250),u={components:{Icon:d.Z},emits:["click","input"],props:{iconClass:{type:String},iconUrl:{type:String},text:{type:String},hoverText:{type:String,default:null},disabled:{type:Boolean,default:!1},itemClass:{}},computed:{itemClass_(){return"string"===typeof this.itemClass?{[this.itemClass]:!0}:this.itemClass}},methods:{clicked(e){if(this.$parent.keepOpenOnItemClick||c.$.emit("dropdown-close"),this.disabled)return e.stopPropagation(),e.preventDefault(),!1;this.$emit("input",e)}}},p=n(3744);const h=(0,p.Z)(u,[["render",l],["__scopeId","data-v-2babe09c"]]);var f=h},2797:function(e,t,n){n.d(t,{Z:function(){return u}});var s=n(6252),o=n(3577);const a=["title"];function i(e,t,n,i,r,l){const d=(0,s.up)("Icon");return(0,s.wg)(),(0,s.iD)("div",{class:(0,o.C_)(["floating-btn",l.className])},[(0,s._)("button",{type:"button",class:"btn btn-primary",title:n.title,onClick:t[0]||(t[0]=t=>e.$emit("click",t))},[(0,s.Wm)(d,{class:(0,o.C_)(n.iconClass),url:n.iconUrl},null,8,["class","url"])],8,a)],2)}var r=n(657),l={name:"FloatingButton",components:{Icon:r.Z},emits:["click"],props:{iconClass:{type:String},iconUrl:{type:String},class:{type:String},title:{type:String}},computed:{className(){return this.class}}},d=n(3744);const c=(0,d.Z)(l,[["render",i],["__scopeId","data-v-f812ef1c"]]);var u=c},657:function(e,t,n){n.d(t,{Z:function(){return u}});var s=n(6252),o=n(3577);const a={class:"icon-container"},i=["src","alt"];function r(e,t,n,r,l,d){return(0,s.wg)(),(0,s.iD)("div",a,[n.url?.length?((0,s.wg)(),(0,s.iD)("img",{key:0,class:"icon",src:n.url,alt:n.alt},null,8,i)):d.className?.length?((0,s.wg)(),(0,s.iD)("i",{key:1,class:(0,o.C_)(["icon",d.className]),style:(0,o.j5)({color:n.color})},null,6)):(0,s.kq)("",!0)])}var l={props:{class:{type:String},url:{type:String},color:{type:String,default:""},alt:{type:String,default:""}},computed:{className(){return this.class}}},d=n(3744);const c=(0,d.Z)(l,[["render",r],["__scopeId","data-v-706a3bd1"]]);var u=c},2717:function(e,t,n){n.d(t,{Z:function(){return h}});var s=n(6252);const o=e=>((0,s.dD)("data-v-2edff8b7"),e=e(),(0,s.Cn)(),e),a={class:"restart-btn-container"},i=o((()=>(0,s._)("i",{class:"fas fa-redo-alt"},null,-1)));function r(e,t,n,o,r,l){const d=(0,s.up)("ConfirmDialog");return(0,s.wg)(),(0,s.iD)("div",a,[(0,s.Wm)(d,{ref:"modal",onInput:l.restart},{default:(0,s.w5)((()=>[(0,s.Uk)(" Are you sure that you want to restart the application? ")])),_:1},8,["onInput"]),(0,s._)("button",{class:"btn btn-default restart-btn",onClick:t[0]||(t[0]=(...e)=>l.showDialog&&l.showDialog(...e)),onTouch:t[1]||(t[1]=(...e)=>l.showDialog&&l.showDialog(...e))},[i,(0,s.Uk)("   Restart Application ")],32)])}var l=n(7833),d=n(8637),c={name:"RestartButton",components:{ConfirmDialog:l.Z},mixins:[d.Z],methods:{showDialog(){this.$refs.modal.show()},async restart(){await this.request("application.restart")}}},u=n(3744);const p=(0,u.Z)(c,[["render",r],["__scopeId","data-v-2edff8b7"]]);var h=p},7514:function(e,t,n){n.d(t,{Z:function(){return f}});var s=n(6252),o=n(3577),a=n(9963);const i=e=>((0,s.dD)("data-v-eff375b6"),e=e(),(0,s.Cn)(),e),r=["checked","id"],l=i((()=>(0,s._)("div",{class:"switch"},[(0,s._)("div",{class:"dot"})],-1))),d={class:"label"};function c(e,t,n,i,c,u){return(0,s.wg)(),(0,s.iD)("div",{class:(0,o.C_)(["power-switch",{disabled:n.disabled}]),onClick:t[0]||(t[0]=(0,a.iM)(((...e)=>u.onInput&&u.onInput(...e)),["stop"]))},[(0,s._)("input",{type:"checkbox",checked:n.value,id:n.id},null,8,r),(0,s._)("label",null,[l,(0,s._)("span",d,[(0,s.WI)(e.$slots,"default",{},void 0,!0)])])],2)}var u={name:"ToggleSwitch",emits:["input"],props:{id:{type:String},value:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},methods:{onInput(e){if(this.disabled)return!1;this.$emit("input",e)}}},p=n(3744);const h=(0,p.Z)(u,[["render",c],["__scopeId","data-v-eff375b6"]]);var f=h},8010:function(e,t,n){n.r(t),n.d(t,{default:function(){return bt}});var s=n(6252);const o={class:"settings-container"};function a(e,t,n,a,i,r){const l=(0,s.up)("Application"),d=(0,s.up)("Users"),c=(0,s.up)("Token");return(0,s.wg)(),(0,s.iD)("div",o,[(0,s._)("main",null,["application"===n.selectedPanel?((0,s.wg)(),(0,s.j4)(l,{key:0})):(0,s.kq)("",!0),"users"===n.selectedPanel&&i.currentUser?((0,s.wg)(),(0,s.j4)(d,{key:1,"session-token":i.sessionToken,"current-user":i.currentUser},null,8,["session-token","current-user"])):"tokens"===n.selectedPanel&&i.currentUser?((0,s.wg)(),(0,s.j4)(c,{key:2,"session-token":i.sessionToken,"current-user":i.currentUser},null,8,["session-token","current-user"])):(0,s.kq)("",!0)])])}const i={class:"app-container"},r={class:"btn-container"},l={class:"btn-container"};function d(e,t,n,o,a,d){const c=(0,s.up)("RestartButton"),u=(0,s.up)("StopButton");return(0,s.wg)(),(0,s.iD)("div",i,[(0,s._)("div",r,[(0,s.Wm)(c)]),(0,s._)("div",l,[(0,s.Wm)(u)])])}var c=n(2717);const u=e=>((0,s.dD)("data-v-1eab04fa"),e=e(),(0,s.Cn)(),e),p={class:"stop-btn-container"},h=u((()=>(0,s._)("br",null,null,-1))),f=u((()=>(0,s._)("br",null,null,-1))),g=u((()=>(0,s._)("span",{class:"text-danger"}," This will stop the application and you will not be able to restart it through the Web interface! ",-1))),m=u((()=>(0,s._)("i",{class:"fas fa-stop"},null,-1)));function w(e,t,n,o,a,i){const r=(0,s.up)("ConfirmDialog");return(0,s.wg)(),(0,s.iD)("div",p,[(0,s.Wm)(r,{ref:"modal",onInput:i.stop},{default:(0,s.w5)((()=>[(0,s.Uk)(" Are you sure that you want to stop the application? "),h,f,g])),_:1},8,["onInput"]),(0,s._)("button",{class:"btn btn-default stop-btn",onClick:t[0]||(t[0]=(...e)=>i.showDialog&&i.showDialog(...e)),onTouch:t[1]||(t[1]=(...e)=>i.showDialog&&i.showDialog(...e))},[m,(0,s.Uk)("   Stop Application ")],32)])}var y=n(7833),b=n(8637),k={name:"StopButton",components:{ConfirmDialog:y.Z},mixins:[b.Z],methods:{showDialog(){this.$refs.modal.show()},async stop(){await this.request("application.stop")}}},_=n(3744);const C=(0,_.Z)(k,[["render",w],["__scopeId","data-v-1eab04fa"]]);var v=C,O={name:"Application",components:{RestartButton:c.Z,StopButton:v}};const D=(0,_.Z)(O,[["render",d],["__scopeId","data-v-40365cea"]]);var T=D,U=n(3577),x=n(9963);const S={class:"token-container"},$={class:"token-container"},q=(0,s._)("label",null,[(0,s.Uk)(" This is your generated token. Treat it carefully and do not share it with untrusted parties."),(0,s._)("br"),(0,s.Uk)(" Also, make sure to save it - it WILL NOT be displayed again. ")],-1),I=["textContent"],Z={class:"token-container"},P=(0,s._)("label",null," This is your current session token. It will be invalidated once you log out of the current session. ",-1),A=["textContent"],M={class:"body"},W=(0,s.uE)('<div class="description"><p> Platypush provides two types of tokens: <ul><li><b>JWT tokens</b> are bearer-only, and they contain encrypted authentication information.<br> They can be used as permanent or time-based tokens to authenticate with the Platypush API. </li><li><b>Session tokens</b> are randomly generated tokens stored on the application database. A session token generated in this session will expire when you log out of it. </li></ul></p><p>Generate a JWT authentication token that can be used for API calls to the <code>/execute</code> endpoint.</p><br><p>You can include the token in your requests in any of the following ways:</p><ul><li>Specify it on the <code>Authorization: Bearer</code> header;</li><li>Specify it on the <code>X-Token</code> header;</li><li> Specify it as a URL parameter: <code>http://site:8008/execute?token=...</code> for a JWT token and <code>...?session_token=...</code> for a session token; </li><li>Specify it on the body of your JSON request: <code>{&quot;type&quot;:&quot;request&quot;, &quot;action&quot;, &quot;...&quot;, &quot;token&quot;:&quot;...&quot;}</code> for a JWT token, or <code>&quot;session_token&quot;</code> for a session token. </li></ul><p>Confirm your credentials in order to generate a new JWT token.</p><p><i>Show session token</i> will instead show the token cookie associated to the current session. </p></div>',1),F={class:"form-container"},R=(0,s._)("span",null,"Username",-1),E=["value"],B=(0,s._)("label",null,[(0,s._)("span",null,"Confirm password"),(0,s._)("span",null,[(0,s._)("input",{type:"password",name:"password"})])],-1),L=(0,s._)("label",null,[(0,s._)("span",null,"Token validity in days"),(0,s._)("span",null,[(0,s._)("input",{type:"text",name:"validityDays"})]),(0,s._)("span",{class:"note"},[(0,s.Uk)(" Decimal values are also supported - e.g. "),(0,s._)("i",null,"0.5"),(0,s.Uk)(" means half a day (12 hours). An empty or zero value means that the token has no expiry date. ")])],-1),j=(0,s._)("label",null,[(0,s._)("input",{type:"submit",class:"btn btn-primary",value:"Generate JWT token"})],-1);function z(e,t,n,o,a,i){const r=(0,s.up)("Loading"),l=(0,s.up)("Modal");return(0,s.wg)(),(0,s.iD)("div",S,[a.loading?((0,s.wg)(),(0,s.j4)(r,{key:0})):(0,s.kq)("",!0),(0,s.Wm)(l,{ref:"tokenModal"},{default:(0,s.w5)((()=>[(0,s._)("div",$,[q,(0,s._)("textarea",{class:"token",textContent:(0,U.zw)(a.token),onFocus:t[0]||(t[0]=(...e)=>i.onTokenSelect&&i.onTokenSelect(...e))},null,40,I)])])),_:1},512),(0,s.Wm)(l,{ref:"sessionTokenModal"},{default:(0,s.w5)((()=>[(0,s._)("div",Z,[P,(0,s._)("textarea",{class:"token",textContent:(0,U.zw)(n.sessionToken),onFocus:t[1]||(t[1]=(...e)=>i.onTokenSelect&&i.onTokenSelect(...e))},null,40,A)])])),_:1},512),(0,s._)("div",M,[W,(0,s._)("div",F,[(0,s._)("form",{onSubmit:t[3]||(t[3]=(0,x.iM)(((...e)=>i.generateToken&&i.generateToken(...e)),["prevent"])),ref:"generateTokenForm"},[(0,s._)("label",null,[R,(0,s._)("span",null,[(0,s._)("input",{type:"text",name:"username",value:n.currentUser.username,disabled:""},null,8,E)])]),B,L,j,(0,s._)("label",null,[(0,s._)("input",{type:"button",class:"btn btn-default",value:"Show session token",onClick:t[2]||(t[2]=(0,x.iM)((t=>e.$refs.sessionTokenModal.show()),["stop"]))})])],544)])])])}var H=n(7066),N=n(6791),Y=n(5166),Q={name:"Token",components:{Modal:Y.Z,Loading:N.Z},mixins:[b.Z],props:{currentUser:{type:Object,required:!0},sessionToken:{type:String,required:!0}},data(){return{loading:!1,token:null}},methods:{async generateToken(e){const t=this.currentUser.username,n=e.target.password.value;let s=e.target.validityDays?.length?parseInt(e.target.validityDays.value):0;s||(s=null),this.loading=!0;try{this.token=(await H.Z.post("/auth",{username:t,password:n,expiry_days:s})).data.token,this.token?.length&&this.$refs.tokenModal.show()}catch(o){console.error(o.toString()),this.notify({text:o.toString(),error:!0})}finally{this.loading=!1}},onTokenSelect(e){e.target.select(),document.execCommand("copy"),this.notify({text:"Token copied to clipboard",image:{iconClass:"fa fa-check"}})}}};const J=(0,_.Z)(Q,[["render",z]]);var K=J;const X=["disabled"],G=["disabled"],V=["disabled"],ee=["disabled"],te=["value"],ne=["disabled"],se=["disabled"],oe=["disabled"],ae=["disabled"],ie={class:"body"},re={class:"users-list"},le=["onClick"],de=["textContent"],ce={class:"actions pull-right col-4"};function ue(e,t,n,o,a,i){const r=(0,s.up)("Loading"),l=(0,s.up)("Modal"),d=(0,s.up)("Otp"),c=(0,s.up)("DropdownItem"),u=(0,s.up)("Dropdown"),p=(0,s.up)("FloatingButton"),h=(0,s.up)("ConfirmDialog");return(0,s.wg)(),(0,s.iD)(s.HY,null,[a.loading?((0,s.wg)(),(0,s.j4)(r,{key:0})):(0,s.kq)("",!0),(0,s.Wm)(l,{ref:"addUserModal",title:"Add User"},{default:(0,s.w5)((()=>[(0,s._)("form",{action:"#",method:"POST",ref:"addUserForm",onSubmit:t[0]||(t[0]=(...e)=>i.createUser&&i.createUser(...e))},[(0,s._)("label",null,[(0,s._)("input",{type:"text",name:"username",placeholder:"Username",disabled:a.commandRunning},null,8,X)]),(0,s._)("label",null,[(0,s._)("input",{type:"password",name:"password",placeholder:"Password",disabled:a.commandRunning},null,8,G)]),(0,s._)("label",null,[(0,s._)("input",{type:"password",name:"confirm_password",placeholder:"Confirm password",disabled:a.commandRunning},null,8,V)]),(0,s._)("label",null,[(0,s._)("input",{type:"submit",class:"btn btn-primary",value:"Create User",disabled:a.commandRunning},null,8,ee)])],544)])),_:1},512),(0,s.Wm)(l,{ref:"changePasswordModal",title:"Change Password"},{default:(0,s.w5)((()=>[(0,s._)("form",{action:"#",method:"POST",ref:"changePasswordForm",onSubmit:t[1]||(t[1]=(...e)=>i.changePassword&&i.changePassword(...e))},[(0,s._)("label",null,[(0,s._)("input",{type:"text",name:"username",placeholder:"Username",value:a.selectedUser,disabled:"disabled"},null,8,te)]),(0,s._)("label",null,[(0,s._)("input",{type:"password",name:"password",placeholder:"Current password",disabled:a.commandRunning},null,8,ne)]),(0,s._)("label",null,[(0,s._)("input",{type:"password",name:"new_password",placeholder:"New password",disabled:a.commandRunning},null,8,se)]),(0,s._)("label",null,[(0,s._)("input",{type:"password",name:"confirm_new_password",placeholder:"Confirm new password",disabled:a.commandRunning},null,8,oe)]),(0,s._)("label",null,[(0,s._)("input",{type:"submit",class:"btn btn-primary",value:"Change Password",disabled:a.commandRunning},null,8,ae)])],544)])),_:1},512),(0,s.Wm)(l,{title:"Two-factor Authentication",visible:a.showOtpModal,onClose:t[2]||(t[2]=e=>a.showOtpModal=!1)},{default:(0,s.w5)((()=>[a.showOtpModal?((0,s.wg)(),(0,s.j4)(d,{key:0})):(0,s.kq)("",!0)])),_:1},8,["visible"]),(0,s._)("div",ie,[(0,s._)("ul",re,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.users,(n=>((0,s.wg)(),(0,s.iD)("li",{key:n.user_id,class:"item user",onClick:e=>a.selectedUser=n.username},[(0,s._)("div",{class:"name col-8",textContent:(0,U.zw)(n.username)},null,8,de),(0,s._)("div",ce,[(0,s.Wm)(u,{title:"User Actions","icon-class":"fa fa-ellipsis"},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{text:"Change Password",disabled:a.commandRunning,"icon-class":"fa fa-key",onInput:e=>i.showChangePasswordModal(n)},null,8,["disabled","onInput"]),(0,s.Wm)(c,{text:"Set Up 2FA",disabled:a.commandRunning||!i.supports2fa,"icon-class":"fa fa-lock",title:i.mfaTitle,onInput:t[3]||(t[3]=e=>a.showOtpModal=!0)},null,8,["disabled","title"]),(0,s.Wm)(c,{text:"Delete User",disabled:a.commandRunning,"icon-class":"fa fa-trash","item-class":"text-danger",onInput:t=>{a.selectedUser=n.username,e.$refs.deleteUserDialog.show()}},null,8,["disabled","onInput"])])),_:2},1024)])],8,le)))),128))]),(0,s.Wm)(p,{"icon-class":"fa fa-plus",text:"Add User",onClick:i.showAddUserModal},null,8,["onClick"]),(0,s.Wm)(h,{ref:"deleteUserDialog",onInput:t[4]||(t[4]=e=>i.deleteUser(a.selectedUser))},{default:(0,s.w5)((()=>[(0,s.Uk)(" Are you sure that you want to remove the user "+(0,U.zw)(a.selectedUser)+"? ",1)])),_:1},512)])],64)}n(560);var pe=n(4904);const he=e=>((0,s.dD)("data-v-24d32b46"),e=e(),(0,s.Cn)(),e),fe={class:"otp-config-container"},ge={key:1,class:"otp-config"},me={class:"title"},we=he((()=>(0,s._)("p",{class:"description"}," Two-factor authentication adds an extra layer of security to your account. When enabled, you will need to enter a code from your authenticator app in addition to your password. ",-1))),ye={key:0,class:"current-otp-config"},be={class:"header"},ke=he((()=>(0,s._)("h4",null,"2FA Configuration",-1))),_e=["disabled"],Ce=he((()=>(0,s._)("i",{class:"fas fa-save"},null,-1))),ve=he((()=>(0,s._)("div",{class:"description"},[(0,s._)("p",null,"Scan the QR code with your authenticator app to add this account."),(0,s._)("p",null,"Alternatively, you can add either the secret or the provisioning URL to your password manager or authenticator app.")],-1))),Oe={key:0,class:"section qrcode-container"},De=["src"],Te={key:1,class:"section secret-container"},Ue=he((()=>(0,s._)("h4",null,"Secret",-1))),xe=["value"],Se={key:2,class:"section uri-container"},$e=he((()=>(0,s._)("h4",null,"Provisioning URL",-1))),qe=["value"],Ie={key:3,class:"section backup-codes"},Ze={class:"header"},Pe=he((()=>(0,s._)("h4",null,"Backup Codes",-1))),Ae=["disabled"],Me=he((()=>(0,s._)("i",{class:"fas fa-sync"},null,-1))),We={key:0,class:"description"},Fe=he((()=>(0,s._)("p",null," Backup Codes are one-time use codes that can be used to access your account in case you lose access to your authenticator app. ",-1))),Re=he((()=>(0,s._)("p",null,"Make sure to store them in a safe place.",-1))),Ee=he((()=>(0,s._)("p",null,[(0,s._)("b",null," Take note of these codes NOW! You will not be able to see them again! ")],-1))),Be=[Fe,Re,Ee],Le=["value"],je={class:"confirm-modal"},ze={key:0,class:"dialog"},He=he((()=>(0,s._)("p",null,"Are you sure you want to enable Two-Factor Authentication?",-1))),Ne=he((()=>(0,s._)("p",null,"Make sure to save the secret and backup codes in a safe place.",-1))),Ye=he((()=>(0,s._)("p",null," In order to enable Two-Factor Authentication, you will need to enter your password and a code from your authenticator app. ",-1))),Qe=[He,Ne,Ye],Je={key:1,class:"dialog"},Ke=he((()=>(0,s._)("p",null,"Are you sure you want to disable Two-Factor Authentication?",-1))),Xe=he((()=>(0,s._)("p",null," You will no longer need to enter a code from your authenticator app. You will still need to enter your password to log in, but your account may be less secure. ",-1))),Ge=he((()=>(0,s._)("p",null," In order to disable Two-Factor Authentication, you will need to enter your password. ",-1))),Ve=[Ke,Xe,Ge],et=["disabled"],tt=["disabled"],nt=["disabled"],st={class:"buttons"},ot=["disabled"],at=he((()=>(0,s._)("i",{class:"fas fa-check"},null,-1))),it=he((()=>(0,s._)("i",{class:"fas fa-times"},null,-1)));function rt(e,t,n,o,a,i){const r=(0,s.up)("Loading"),l=(0,s.up)("ToggleSwitch"),d=(0,s.up)("ConfirmDialog"),c=(0,s.up)("Modal");return(0,s.wg)(),(0,s.iD)("div",fe,[a.initializing?((0,s.wg)(),(0,s.j4)(r,{key:0})):((0,s.wg)(),(0,s.iD)("div",ge,[(0,s._)("div",me,[(0,s._)("h3",null,"Two-Factor Authentication "+(0,U.zw)(i.otpEnabled?"Enabled":"Disabled"),1),(0,s.Wm)(l,{value:i.toggleOn,disabled:a.refreshing,onInput:t[0]||(t[0]=e=>i.currentOtpConfig?.otp_secret?.length?i.startOtpDisable():i.startOtpSetup())},null,8,["value","disabled"])]),we,i.currentOtpConfig?.otp_secret?.length?((0,s.wg)(),(0,s.iD)("div",ye,[(0,s._)("div",be,[ke,i.hasChanges&&i.temporaryOtpEnabled?((0,s.wg)(),(0,s.iD)("button",{key:0,class:"btn btn-primary",disabled:a.refreshing,onClick:t[1]||(t[1]=(...t)=>e.$refs.confirmModal.open&&e.$refs.confirmModal.open(...t))},[Ce,(0,s.Uk)(" Save ")],8,_e)):(0,s.kq)("",!0)]),ve,i.currentOtpConfig.qrcode?((0,s.wg)(),(0,s.iD)("div",Oe,[(0,s._)("img",{class:"qrcode",src:`data:image/png;base64,${i.currentOtpConfig.qrcode}`,alt:"QR Code"},null,8,De)])):(0,s.kq)("",!0),i.currentOtpConfig.otp_secret?((0,s.wg)(),(0,s.iD)("div",Te,[Ue,(0,s._)("input",{type:"text",value:i.currentOtpConfig.otp_secret,readonly:"",onFocus:t[2]||(t[2]=t=>e.copyToClipboard(t.target.value))},null,40,xe)])):(0,s.kq)("",!0),i.currentOtpConfig.otp_uri?((0,s.wg)(),(0,s.iD)("div",Se,[$e,(0,s._)("input",{type:"text",value:i.currentOtpConfig.otp_uri,readonly:"",onFocus:t[3]||(t[3]=t=>e.copyToClipboard(t.target.value))},null,40,qe)])):(0,s.kq)("",!0),i.otpEnabled?((0,s.wg)(),(0,s.iD)("div",Ie,[(0,s._)("div",Ze,[Pe,(0,s._)("button",{class:"btn btn-primary",disabled:a.refreshing,onClick:t[4]||(t[4]=(...t)=>e.$refs.confirmRefreshCodes.open&&e.$refs.confirmRefreshCodes.open(...t))},[Me,(0,s.Uk)(" Regenerate ")],8,Ae)]),a.backupCodes?.length?((0,s.wg)(),(0,s.iD)("div",We,Be)):(0,s.kq)("",!0),a.backupCodes?.length?((0,s.wg)(),(0,s.iD)("textarea",{key:1,value:a.backupCodes.join("\n"),readonly:"",onFocus:t[5]||(t[5]=t=>e.copyToClipboard(t.target.value))},null,40,Le)):(0,s.kq)("",!0)])):(0,s.kq)("",!0)])):(0,s.kq)("",!0)])),a.refreshing?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(d,{key:2,ref:"confirmRefreshCodes",onInput:i.refreshCodes},{default:(0,s.w5)((()=>[(0,s.Uk)(" Are you sure you want to regenerate the backup codes? ")])),_:1},8,["onInput"])),(0,s.Wm)(c,{title:"Confirm 2FA Setup",ref:"confirmModal",onOpen:i.onConfirmModalOpen},{default:(0,s.w5)((()=>[(0,s._)("div",je,[i.temporaryOtpEnabled?((0,s.wg)(),(0,s.iD)("div",ze,Qe)):((0,s.wg)(),(0,s.iD)("div",Je,Ve)),(0,s._)("form",{disabled:a.refreshing,onSubmit:t[7]||(t[7]=(0,x.iM)((e=>i.otpEnabled?i.disableOtp():i.enableOtp()),["prevent"]))},[(0,s._)("input",{type:"password",placeholder:"Password",required:"",disabled:a.refreshing,ref:"password"},null,8,tt),i.temporaryOtpEnabled?((0,s.wg)(),(0,s.iD)("input",{key:0,type:"text",placeholder:"Authenticator Code",required:"",disabled:a.refreshing,ref:"code"},null,8,nt)):(0,s.kq)("",!0),(0,s._)("div",st,[(0,s._)("button",{class:"btn btn-primary",disabled:a.refreshing,type:"submit"},[at,(0,s.Uk)(" Confirm "),a.refreshing?((0,s.wg)(),(0,s.j4)(r,{key:0})):(0,s.kq)("",!0)],8,ot),(0,s._)("button",{class:"btn btn-default",onClick:t[6]||(t[6]=(...t)=>e.$refs.confirmModal.close&&e.$refs.confirmModal.close(...t))},[it,(0,s.Uk)(" Cancel ")])])],40,et)])])),_:1},8,["onOpen"])])}var lt=n(7514),dt={mixins:[b.Z],components:{ConfirmDialog:y.Z,Loading:N.Z,Modal:Y.Z,ToggleSwitch:lt.Z},data(){return{backupCodes:[],initializing:!1,otpConfig:null,refreshing:!1,temporaryOtpConfig:null}},computed:{currentOtpConfig(){return this.otpEnabled?this.otpConfig:this.temporaryOtpConfig},hasChanges(){return!this.otpEnabled&&null!=this.temporaryOtpConfig||this.otpEnabled&&(null==this.temporaryOtpConfig||this.temporaryOtpConfig?.otp_secret!=this.otpConfig?.otp_secret)},otpEnabled(){return!!this?.otpConfig?.otp_secret?.length},temporaryOtpDisabled(){return this.hasChanges&&null==this.temporaryOtpConfig?.otp_secret},temporaryOtpEnabled(){return this.hasChanges&&null!=this.temporaryOtpConfig?.otp_secret},toggleOn(){return this.otpEnabled||this.temporaryOtpEnabled}},methods:{getErrorMessage(e){return e.response?.data?.message||e.response?.data?.error||e.message||e.response?.statusText||e.toString()},onError(e){console.error(e),e=this.getErrorMessage(e),this.notify({error:!0,title:"Error while setting up Two-Factor Authentication",text:e,image:{iconClass:"fas fa-exclamation-triangle"}})},async getOtpConfig(){this.initializing=!0;try{this.otpConfig=(await H.Z.get("/otp/config")).data,this.temporaryOtpConfig=this.otpConfig}catch(e){this.onError(e)}finally{this.initializing=!1}},async startOtpSetup(){this.refreshing=!0;try{this.temporaryOtpConfig=(await H.Z.post("/otp/config",{dry_run:!0})).data}finally{this.refreshing=!1}},async enableOtp(){this.refreshing=!0;try{const e=await H.Z.post("/otp/config",{otp_secret:this.temporaryOtpConfig.otp_secret,password:this.$refs.password.value,code:this.$refs.code.value});this.backupCodes=e.data?.backup_codes||[],await this.getOtpConfig(),this.$refs.confirmModal.close(),this.notify({title:"Two-Factor Authentication enabled",text:"Two-Factor Authentication has been enabled for your account",image:{iconClass:"fas fa-shield-alt"}})}catch(e){this.onError(e)}finally{this.refreshing=!1}},async startOtpDisable(){this.temporaryOtpConfig=null,this.$refs.confirmModal.open()},async disableOtp(){this.refreshing=!0;try{await H.Z.delete("/otp/config",{headers:{"Content-Type":"application/json"},data:{password:this.$refs.password.value}}),await this.getOtpConfig(),this.$refs.confirmModal.close(),this.notify({title:"Two-Factor Authentication disabled",text:"Two-Factor Authentication has been disabled for your account",image:{iconClass:"fas fa-shield-alt"}})}catch(e){this.onError(e)}finally{this.refreshing=!1}},async refreshCodes(){this.refreshing=!0;try{const e=await H.Z.post("/otp/refresh-codes");this.backupCodes=e.data?.backup_codes||[],this.notify({title:"Backup codes regenerated",text:"Take note of these codes NOW! You will not be able to see them again!",image:{iconClass:"fas fa-shield-alt"}})}catch(e){this.onError(e)}finally{this.refreshing=!1}},onConfirmModalOpen(){this.$nextTick((()=>{this.$refs.password.value="",this.$refs.code&&(this.$refs.code.value=""),this.$refs.password.focus()}))}},async mounted(){await this.getOtpConfig()}};const ct=(0,_.Z)(dt,[["render",rt],["__scopeId","data-v-24d32b46"]]);var ut=ct,pt=n(7597),ht=n(2797),ft={name:"Users",components:{ConfirmDialog:y.Z,Dropdown:pe.Z,DropdownItem:pt.Z,FloatingButton:ht.Z,Loading:N.Z,Modal:Y.Z,Otp:ut},mixins:[b.Z],props:{sessionToken:{type:String,required:!0},currentUser:{type:Object,required:!0}},data(){return{users:[],commandRunning:!1,loading:!1,selectedUser:null,hasOtpPlugin:!1,hasQrcodePlugin:!1,showOtpModal:!1}},computed:{supports2fa(){return this.hasOtpPlugin&&this.hasQrcodePlugin},mfaTitle(){if(this.supports2fa)return"";const e=[];return this.hasOtpPlugin||e.push("otp"),this.hasQrcodePlugin||e.push("qrcode"),"The following plugin(s) are missing: "+e.join(", ")}},methods:{async testOtp(){this.commandRunning=!0,this.hasOtpPlugin=!1,this.hasQrcodePlugin=!1;try{this.hasOtpPlugin=!0;const e=await this.request("otp.generate_secret",{},1e4,!1);if("string"===typeof e&&e.length){const e=await this.request("qrcode.generate",{content:"test"},1e4,!1);e?.data?.length&&(this.hasQrcodePlugin=!0)}}catch(e){this.hasOtpPlugin||console.info("otp plugin not found. Enable/configure it to use 2FA"),this.hasQrcodePlugin||console.info("qrcode plugin not found. Enable/configure it to use 2FA")}finally{this.commandRunning=!1}},async refresh(){this.loading=!0;try{this.users=await this.request("user.get_users")}finally{this.loading=!1}},async createUser(e){e.preventDefault();const t=[...this.$refs.addUserForm.querySelectorAll("input[name]")].reduce(((e,t)=>(e[t.name]=t.value,e)),{});if(t.password===t.confirm_password){this.commandRunning=!0;try{await this.request("user.create_user",{username:t.username,password:t.password,session_token:this.sessionToken})}finally{this.commandRunning=!1}this.notify({text:"User "+t.username+" created",image:{iconClass:"fas fa-check"}}),this.$refs.addUserModal.close(),await this.refresh()}else this.notify({title:"Unable to create user",text:"Please check that the passwords match",error:!0,image:{iconClass:"fas fa-times"}})},async changePassword(e){e.preventDefault();const t=[...this.$refs.changePasswordForm.querySelectorAll("input[name]")].reduce(((e,t)=>(e[t.name]=t.value,e)),{});if(t.new_password!==t.confirm_new_password)return void this.notify({title:"Unable to update password",text:"Please check that the passwords match",error:!0,image:{iconClass:"fas fa-times"}});this.commandRunning=!0;let n=!1;try{n=await this.request("user.update_password",{username:t.username,old_password:t.password,new_password:t.new_password})}finally{this.commandRunning=!1}n?(this.$refs.changePasswordModal.close(),this.notify({text:"Password successfully updated",image:{iconClass:"fas fa-check"}})):this.notify({title:"Unable to update password",text:"The current password is incorrect",error:!0,image:{iconClass:"fas fa-times"}})},async deleteUser(e){this.commandRunning=!0;try{await this.request("user.delete_user",{username:e,session_token:this.sessionToken})}finally{this.commandRunning=!1}this.notify({text:`User ${e} removed`,image:{iconClass:"fas fa-check"}}),this.selectedUser=null,await this.refresh()},showAddUserModal(){this.$refs.addUserModal.show(),this.$nextTick((()=>{this.$refs.addUserForm.reset(),this.$refs.addUserForm.username.focus()}))},showChangePasswordModal(e){this.$refs.changePasswordModal.show(),this.$nextTick((()=>{this.$refs.changePasswordForm.password.focus(),this.selectedUser=e.username}))}},async mounted(){await this.refresh(),await this.testOtp(),this.supports2fa||this.notify({title:"Two-factor Authentication not available",text:this.mfaTitle,error:!0,image:{iconClass:"fas fa-exclamation-triangle"}})}};const gt=(0,_.Z)(ft,[["render",ue],["__scopeId","data-v-dbc28730"]]);var mt=gt,wt={name:"Settings",components:{Application:T,Users:mt,Token:K},mixins:[b.Z],props:{selectedPanel:{type:String}},data(){return{currentUser:null,sessionToken:null}},methods:{async refresh(){this.sessionToken=this.getCookies()["session_token"],this.currentUser=await this.request("user.get_user_by_session",{session_token:this.sessionToken})}},mounted(){this.refresh()}};const yt=(0,_.Z)(wt,[["render",a]]);var bt=yt}}]);
//# sourceMappingURL=8010.c9b590a2.js.map